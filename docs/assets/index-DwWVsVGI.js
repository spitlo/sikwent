(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();const Ja={context:void 0,registry:void 0},Ka=(s,e)=>s===e,Bt=Symbol("solid-proxy"),_i=Symbol("solid-track"),gs={equals:Ka};let Zr=Qr;const Mt=1,_s=2,Xr={owned:null,cleanups:null,context:null,owner:null};var ae=null;let fi=null,ec=null,ie=null,Se=null,pt=null,Js=0;function cn(s,e){const t=ie,n=ae,i=s.length===0,r=e===void 0?n:e,a=i?Xr:{owned:null,cleanups:null,context:r?r.context:null,owner:r},o=i?s:()=>s(()=>gt(()=>ei(a)));ae=a,ie=null;try{return Qt(o,!0)}finally{ie=t,ae=n}}function Sn(s,e){e=e?Object.assign({},gs,e):gs;const t={value:s,observers:null,observerSlots:null,comparator:e.equals||void 0},n=i=>(typeof i=="function"&&(i=i(t.value)),Yr(t,i));return[Hr.bind(t),n]}function kt(s,e,t){const n=Ii(s,e,!1,Mt);Kn(n)}function Ks(s,e,t){Zr=oc;const n=Ii(s,e,!1,Mt);(!t||!t.render)&&(n.user=!0),pt?pt.push(n):Kn(n)}function ys(s,e,t){t=t?Object.assign({},gs,t):gs;const n=Ii(s,e,!0,0);return n.observers=null,n.observerSlots=null,n.comparator=t.equals||void 0,Kn(n),Hr.bind(n)}function tc(s){return Qt(s,!1)}function gt(s){if(ie===null)return s();const e=ie;ie=null;try{return s()}finally{ie=e}}function nc(s){Ks(()=>gt(s))}function $t(s){return ae===null||(ae.cleanups===null?ae.cleanups=[s]:ae.cleanups.push(s)),s}function yi(){return ie}function Mi(){return ae}function sc(s,e){const t=ae,n=ie;ae=s,ie=null;try{return Qt(e,!0)}catch(i){Ri(i)}finally{ae=t,ie=n}}function Hr(){if(this.sources&&this.state)if(this.state===Mt)Kn(this);else{const s=Se;Se=null,Qt(()=>ws(this),!1),Se=s}if(ie){const s=this.observers?this.observers.length:0;ie.sources?(ie.sources.push(this),ie.sourceSlots.push(s)):(ie.sources=[this],ie.sourceSlots=[s]),this.observers?(this.observers.push(ie),this.observerSlots.push(ie.sources.length-1)):(this.observers=[ie],this.observerSlots=[ie.sources.length-1])}return this.value}function Yr(s,e,t){let n=s.value;return(!s.comparator||!s.comparator(n,e))&&(s.value=e,s.observers&&s.observers.length&&Qt(()=>{for(let i=0;i<s.observers.length;i+=1){const r=s.observers[i],a=fi&&fi.running;a&&fi.disposed.has(r),(a?!r.tState:!r.state)&&(r.pure?Se.push(r):pt.push(r),r.observers&&Jr(r)),a||(r.state=Mt)}if(Se.length>1e6)throw Se=[],new Error},!1)),e}function Kn(s){if(!s.fn)return;ei(s);const e=Js;ic(s,s.value,e)}function ic(s,e,t){let n;const i=ae,r=ie;ie=ae=s;try{n=s.fn(e)}catch(a){return s.pure&&(s.state=Mt,s.owned&&s.owned.forEach(ei),s.owned=null),s.updatedAt=t+1,Ri(a)}finally{ie=r,ae=i}(!s.updatedAt||s.updatedAt<=t)&&(s.updatedAt!=null&&"observers"in s?Yr(s,n):s.value=n,s.updatedAt=t)}function Ii(s,e,t,n=Mt,i){const r={fn:s,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:ae,context:ae?ae.context:null,pure:t};return ae===null||ae!==Xr&&(ae.owned?ae.owned.push(r):ae.owned=[r]),r}function vs(s){if(s.state===0)return;if(s.state===_s)return ws(s);if(s.suspense&&gt(s.suspense.inFallback))return s.suspense.effects.push(s);const e=[s];for(;(s=s.owner)&&(!s.updatedAt||s.updatedAt<Js);)s.state&&e.push(s);for(let t=e.length-1;t>=0;t--)if(s=e[t],s.state===Mt)Kn(s);else if(s.state===_s){const n=Se;Se=null,Qt(()=>ws(s,e[0]),!1),Se=n}}function Qt(s,e){if(Se)return s();let t=!1;e||(Se=[]),pt?t=!0:pt=[],Js++;try{const n=s();return rc(t),n}catch(n){t||(pt=null),Se=null,Ri(n)}}function rc(s){if(Se&&(Qr(Se),Se=null),s)return;const e=pt;pt=null,e.length&&Qt(()=>Zr(e),!1)}function Qr(s){for(let e=0;e<s.length;e++)vs(s[e])}function oc(s){let e,t=0;for(e=0;e<s.length;e++){const n=s[e];n.user?s[t++]=n:vs(n)}for(e=0;e<t;e++)vs(s[e])}function ws(s,e){s.state=0;for(let t=0;t<s.sources.length;t+=1){const n=s.sources[t];if(n.sources){const i=n.state;i===Mt?n!==e&&(!n.updatedAt||n.updatedAt<Js)&&vs(n):i===_s&&ws(n,e)}}}function Jr(s){for(let e=0;e<s.observers.length;e+=1){const t=s.observers[e];t.state||(t.state=_s,t.pure?Se.push(t):pt.push(t),t.observers&&Jr(t))}}function ei(s){let e;if(s.sources)for(;s.sources.length;){const t=s.sources.pop(),n=s.sourceSlots.pop(),i=t.observers;if(i&&i.length){const r=i.pop(),a=t.observerSlots.pop();n<i.length&&(r.sourceSlots[a]=n,i[n]=r,t.observerSlots[n]=a)}}if(s.owned){for(e=s.owned.length-1;e>=0;e--)ei(s.owned[e]);s.owned=null}if(s.cleanups){for(e=s.cleanups.length-1;e>=0;e--)s.cleanups[e]();s.cleanups=null}s.state=0}function ac(s){return s instanceof Error?s:new Error(typeof s=="string"?s:"Unknown error",{cause:s})}function Ri(s,e=ae){throw ac(s)}const cc=Symbol("fallback");function fr(s){for(let e=0;e<s.length;e++)s[e]()}function lc(s,e,t={}){let n=[],i=[],r=[],a=0,o=e.length>1?[]:null;return $t(()=>fr(r)),()=>{let c=s()||[],l,u;return c[_i],gt(()=>{let d=c.length,f,p,m,g,y,T,x,C,_;if(d===0)a!==0&&(fr(r),r=[],n=[],i=[],a=0,o&&(o=[])),t.fallback&&(n=[cc],i[0]=cn(w=>(r[0]=w,t.fallback())),a=1);else if(a===0){for(i=new Array(d),u=0;u<d;u++)n[u]=c[u],i[u]=cn(h);a=d}else{for(m=new Array(d),g=new Array(d),o&&(y=new Array(d)),T=0,x=Math.min(a,d);T<x&&n[T]===c[T];T++);for(x=a-1,C=d-1;x>=T&&C>=T&&n[x]===c[C];x--,C--)m[C]=i[x],g[C]=r[x],o&&(y[C]=o[x]);for(f=new Map,p=new Array(C+1),u=C;u>=T;u--)_=c[u],l=f.get(_),p[u]=l===void 0?-1:l,f.set(_,u);for(l=T;l<=x;l++)_=n[l],u=f.get(_),u!==void 0&&u!==-1?(m[u]=i[l],g[u]=r[l],o&&(y[u]=o[l]),u=p[u],f.set(_,u)):r[l]();for(u=T;u<d;u++)u in m?(i[u]=m[u],r[u]=g[u],o&&(o[u]=y[u],o[u](u))):i[u]=cn(h);i=i.slice(0,a=d),n=c.slice(0)}return i});function h(d){if(r[u]=d,o){const[f,p]=Sn(u);return o[u]=p,e(c[u],f)}return e(c[u])}}}function Ke(s,e){return gt(()=>s(e||{}))}const uc=s=>`Stale read from <${s}>.`;function mr(s){const e="fallback"in s&&{fallback:()=>s.fallback};return ys(lc(()=>s.each,s.children,e||void 0))}function Kr(s){const e=s.keyed,t=ys(()=>s.when,void 0,{equals:(n,i)=>e?n===i:!n==!i});return ys(()=>{const n=t();if(n){const i=s.children;return typeof i=="function"&&i.length>0?gt(()=>i(e?n:()=>{if(!gt(t))throw uc("Show");return s.when})):i}return s.fallback},void 0,void 0)}const hc=void 0;function dc(s,e,t){let n=t.length,i=e.length,r=n,a=0,o=0,c=e[i-1].nextSibling,l=null;for(;a<i||o<r;){if(e[a]===t[o]){a++,o++;continue}for(;e[i-1]===t[r-1];)i--,r--;if(i===a){const u=r<n?o?t[o-1].nextSibling:t[r-o]:c;for(;o<r;)s.insertBefore(t[o++],u)}else if(r===o)for(;a<i;)(!l||!l.has(e[a]))&&e[a].remove(),a++;else if(e[a]===t[r-1]&&t[o]===e[i-1]){const u=e[--i].nextSibling;s.insertBefore(t[o++],e[a++].nextSibling),s.insertBefore(t[--r],u),e[i]=t[r]}else{if(!l){l=new Map;let h=o;for(;h<r;)l.set(t[h],h++)}const u=l.get(e[a]);if(u!=null)if(o<u&&u<r){let h=a,d=1,f;for(;++h<i&&h<r&&!((f=l.get(e[h]))==null||f!==u+d);)d++;if(d>u-o){const p=e[a];for(;o<u;)s.insertBefore(t[o++],p)}else s.replaceChild(t[o++],e[a++])}else a++;else e[a++].remove()}}}const gr="_$DX_DELEGATE";function pc(s,e,t,n={}){let i;return cn(r=>{i=r,e===document?s():me(e,s(),e.firstChild?null:void 0,t)},n.owner),()=>{i(),e.textContent=""}}function He(s,e,t){let n;const i=()=>{const a=document.createElement("template");return a.innerHTML=s,t?a.content.firstChild.firstChild:a.content.firstChild},r=e?()=>gt(()=>document.importNode(n||(n=i()),!0)):()=>(n||(n=i())).cloneNode(!0);return r.cloneNode=r,r}function Vi(s,e=window.document){const t=e[gr]||(e[gr]=new Set);for(let n=0,i=s.length;n<i;n++){const r=s[n];t.has(r)||(t.add(r),e.addEventListener(r,mc))}}function eo(s,e){e==null?s.removeAttribute("class"):s.className=e}function vi(s,e,t,n){if(n)Array.isArray(t)?(s[`$$${e}`]=t[0],s[`$$${e}Data`]=t[1]):s[`$$${e}`]=t;else if(Array.isArray(t)){const i=t[0];s.addEventListener(e,t[0]=r=>i.call(s,t[1],r))}else s.addEventListener(e,t)}function fc(s,e,t){return gt(()=>s(e,t))}function me(s,e,t,n){if(t!==void 0&&!n&&(n=[]),typeof e!="function")return bs(s,e,n,t);kt(i=>bs(s,e(),i,t),n)}function mc(s){const e=`$$${s.type}`;let t=s.composedPath&&s.composedPath()[0]||s.target;for(s.target!==t&&Object.defineProperty(s,"target",{configurable:!0,value:t}),Object.defineProperty(s,"currentTarget",{configurable:!0,get(){return t||document}});t;){const n=t[e];if(n&&!t.disabled){const i=t[`${e}Data`];if(i!==void 0?n.call(t,i,s):n.call(t,s),s.cancelBubble)return}t=t._$host||t.parentNode||t.host}}function bs(s,e,t,n,i){for(;typeof t=="function";)t=t();if(e===t)return t;const r=typeof e,a=n!==void 0;if(s=a&&t[0]&&t[0].parentNode||s,r==="string"||r==="number")if(r==="number"&&(e=e.toString()),a){let o=t[0];o&&o.nodeType===3?o.data!==e&&(o.data=e):o=document.createTextNode(e),t=sn(s,t,n,o)}else t!==""&&typeof t=="string"?t=s.firstChild.data=e:t=s.textContent=e;else if(e==null||r==="boolean")t=sn(s,t,n);else{if(r==="function")return kt(()=>{let o=e();for(;typeof o=="function";)o=o();t=bs(s,o,t,n)}),()=>t;if(Array.isArray(e)){const o=[],c=t&&Array.isArray(t);if(wi(o,e,t,i))return kt(()=>t=bs(s,o,t,n,!0)),()=>t;if(o.length===0){if(t=sn(s,t,n),a)return t}else c?t.length===0?_r(s,o,n):dc(s,t,o):(t&&sn(s),_r(s,o));t=o}else if(e.nodeType){if(Array.isArray(t)){if(a)return t=sn(s,t,n,e);sn(s,t,null,e)}else t==null||t===""||!s.firstChild?s.appendChild(e):s.replaceChild(e,s.firstChild);t=e}}return t}function wi(s,e,t,n){let i=!1;for(let r=0,a=e.length;r<a;r++){let o=e[r],c=t&&t[s.length],l;if(!(o==null||o===!0||o===!1))if((l=typeof o)=="object"&&o.nodeType)s.push(o);else if(Array.isArray(o))i=wi(s,o,c)||i;else if(l==="function")if(n){for(;typeof o=="function";)o=o();i=wi(s,Array.isArray(o)?o:[o],Array.isArray(c)?c:[c])||i}else s.push(o),i=!0;else{const u=String(o);c&&c.nodeType===3&&c.data===u?s.push(c):s.push(document.createTextNode(u))}}return i}function _r(s,e,t=null){for(let n=0,i=e.length;n<i;n++)s.insertBefore(e[n],t)}function sn(s,e,t,n){if(t===void 0)return s.textContent="";const i=n||document.createTextNode("");if(e.length){let r=!1;for(let a=e.length-1;a>=0;a--){const o=e[a];if(i!==o){const c=o.parentNode===s;!r&&!a?c?s.replaceChild(i,o):s.insertBefore(i,t):c&&o.remove()}else r=!0}}else s.insertBefore(i,t);return[i]}const gc="http://www.w3.org/2000/svg";function _c(s,e=!1){return e?document.createElementNS(gc,s):document.createElement(s)}function yc(s){const{useShadow:e}=s,t=document.createTextNode(""),n=()=>s.mount||document.body,i=Mi();let r,a=!!Ja.context;return Ks(()=>{r||(r=sc(i,()=>ys(()=>s.children)));const o=n();if(o instanceof HTMLHeadElement){const[c,l]=Sn(!1),u=()=>l(!0);cn(h=>me(o,()=>c()?h():r(),null)),$t(u)}else{const c=_c(s.isSVG?"g":"div",s.isSVG),l=e&&c.attachShadow?c.attachShadow({mode:"open"}):c;Object.defineProperty(c,"_$host",{get(){return t.parentNode},configurable:!0}),me(l,r),o.appendChild(c),s.ref&&s.ref(c),$t(()=>o.removeChild(c))}},void 0,{render:!a}),t}const to="14.7.77",yr=(s,e,t)=>({endTime:e,insertTime:t,type:"exponentialRampToValue",value:s}),vr=(s,e,t)=>({endTime:e,insertTime:t,type:"linearRampToValue",value:s}),bi=(s,e)=>({startTime:e,type:"setValue",value:s}),no=(s,e,t)=>({duration:t,startTime:e,type:"setValueCurve",values:s}),so=(s,e,{startTime:t,target:n,timeConstant:i})=>n+(e-n)*Math.exp((t-s)/i),an=s=>s.type==="exponentialRampToValue",Ts=s=>s.type==="linearRampToValue",Ct=s=>an(s)||Ts(s),Fi=s=>s.type==="setValue",lt=s=>s.type==="setValueCurve",xs=(s,e,t,n)=>{const i=s[e];return i===void 0?n:Ct(i)||Fi(i)?i.value:lt(i)?i.values[i.values.length-1]:so(t,xs(s,e-1,i.startTime,n),i)},wr=(s,e,t,n,i)=>t===void 0?[n.insertTime,i]:Ct(t)?[t.endTime,t.value]:Fi(t)?[t.startTime,t.value]:lt(t)?[t.startTime+t.duration,t.values[t.values.length-1]]:[t.startTime,xs(s,e-1,t.startTime,i)],Ti=s=>s.type==="cancelAndHold",xi=s=>s.type==="cancelScheduledValues",St=s=>Ti(s)||xi(s)?s.cancelTime:an(s)||Ts(s)?s.endTime:s.startTime,br=(s,e,t,{endTime:n,value:i})=>t===i?i:0<t&&0<i||t<0&&i<0?t*(i/t)**((s-e)/(n-e)):0,Tr=(s,e,t,{endTime:n,value:i})=>t+(s-e)/(n-e)*(i-t),vc=(s,e)=>{const t=Math.floor(e),n=Math.ceil(e);return t===n?s[t]:(1-(e-t))*s[t]+(1-(n-e))*s[n]},wc=(s,{duration:e,startTime:t,values:n})=>{const i=(s-t)/e*(n.length-1);return vc(n,i)},us=s=>s.type==="setTarget";class bc{constructor(e){this._automationEvents=[],this._currenTime=0,this._defaultValue=e}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(e){const t=St(e);if(Ti(e)||xi(e)){const n=this._automationEvents.findIndex(r=>xi(e)&&lt(r)?r.startTime+r.duration>=t:St(r)>=t),i=this._automationEvents[n];if(n!==-1&&(this._automationEvents=this._automationEvents.slice(0,n)),Ti(e)){const r=this._automationEvents[this._automationEvents.length-1];if(i!==void 0&&Ct(i)){if(r!==void 0&&us(r))throw new Error("The internal list is malformed.");const a=r===void 0?i.insertTime:lt(r)?r.startTime+r.duration:St(r),o=r===void 0?this._defaultValue:lt(r)?r.values[r.values.length-1]:r.value,c=an(i)?br(t,a,o,i):Tr(t,a,o,i),l=an(i)?yr(c,t,this._currenTime):vr(c,t,this._currenTime);this._automationEvents.push(l)}if(r!==void 0&&us(r)&&this._automationEvents.push(bi(this.getValue(t),t)),r!==void 0&&lt(r)&&r.startTime+r.duration>t){const a=t-r.startTime,o=(r.values.length-1)/r.duration,c=Math.max(2,1+Math.ceil(a*o)),l=a/(c-1)*o,u=r.values.slice(0,c);if(l<1)for(let h=1;h<c;h+=1){const d=l*h%1;u[h]=r.values[h-1]*(1-d)+r.values[h]*d}this._automationEvents[this._automationEvents.length-1]=no(u,r.startTime,a)}}}else{const n=this._automationEvents.findIndex(a=>St(a)>t),i=n===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[n-1];if(i!==void 0&&lt(i)&&St(i)+i.duration>t)return!1;const r=an(e)?yr(e.value,e.endTime,this._currenTime):Ts(e)?vr(e.value,t,this._currenTime):e;if(n===-1)this._automationEvents.push(r);else{if(lt(e)&&t+e.duration>St(this._automationEvents[n]))return!1;this._automationEvents.splice(n,0,r)}}return!0}flush(e){const t=this._automationEvents.findIndex(n=>St(n)>e);if(t>1){const n=this._automationEvents.slice(t-1),i=n[0];us(i)&&n.unshift(bi(xs(this._automationEvents,t-2,i.startTime,this._defaultValue),i.startTime)),this._automationEvents=n}}getValue(e){if(this._automationEvents.length===0)return this._defaultValue;const t=this._automationEvents.findIndex(a=>St(a)>e),n=this._automationEvents[t],i=(t===-1?this._automationEvents.length:t)-1,r=this._automationEvents[i];if(r!==void 0&&us(r)&&(n===void 0||!Ct(n)||n.insertTime>e))return so(e,xs(this._automationEvents,i-1,r.startTime,this._defaultValue),r);if(r!==void 0&&Fi(r)&&(n===void 0||!Ct(n)))return r.value;if(r!==void 0&&lt(r)&&(n===void 0||!Ct(n)||r.startTime+r.duration>e))return e<r.startTime+r.duration?wc(e,r):r.values[r.values.length-1];if(r!==void 0&&Ct(r)&&(n===void 0||!Ct(n)))return r.value;if(n!==void 0&&an(n)){const[a,o]=wr(this._automationEvents,i,r,n,this._defaultValue);return br(e,a,o,n)}if(n!==void 0&&Ts(n)){const[a,o]=wr(this._automationEvents,i,r,n,this._defaultValue);return Tr(e,a,o,n)}return this._defaultValue}}const Tc=s=>({cancelTime:s,type:"cancelAndHold"}),xc=s=>({cancelTime:s,type:"cancelScheduledValues"}),Sc=(s,e)=>({endTime:e,type:"exponentialRampToValue",value:s}),Cc=(s,e)=>({endTime:e,type:"linearRampToValue",value:s}),kc=(s,e,t)=>({startTime:e,target:s,timeConstant:t,type:"setTarget"}),Ac=()=>new DOMException("","AbortError"),Nc=s=>(e,t,[n,i,r],a)=>{s(e[i],[t,n,r],o=>o[0]===t&&o[1]===n,a)},Oc=s=>(e,t,n)=>{const i=[];for(let r=0;r<n.numberOfInputs;r+=1)i.push(new Set);s.set(e,{activeInputs:i,outputs:new Set,passiveInputs:new WeakMap,renderer:t})},Dc=s=>(e,t)=>{s.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:t})},dn=new WeakSet,io=new WeakMap,Pi=new WeakMap,ro=new WeakMap,qi=new WeakMap,ti=new WeakMap,oo=new WeakMap,Si=new WeakMap,Ci=new WeakMap,ki=new WeakMap,ao={construct(){return ao}},Ec=s=>{try{const e=new Proxy(s,ao);new e}catch{return!1}return!0},xr=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,Sr=(s,e)=>{const t=[];let n=s.replace(/^[\s]+/,""),i=n.match(xr);for(;i!==null;){const r=i[1].slice(1,-1),a=i[0].replace(/([\s]+)?;?$/,"").replace(r,new URL(r,e).toString());t.push(a),n=n.slice(i[0].length).replace(/^[\s]+/,""),i=n.match(xr)}return[t.join(";"),n]},Cr=s=>{if(s!==void 0&&!Array.isArray(s))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},kr=s=>{if(!Ec(s))throw new TypeError("The given value for processorCtor should be a constructor.");if(s.prototype===null||typeof s.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},Mc=(s,e,t,n,i,r,a,o,c,l,u,h,d)=>{let f=0;return(p,m,g={credentials:"omit"})=>{const y=u.get(p);if(y!==void 0&&y.has(m))return Promise.resolve();const T=l.get(p);if(T!==void 0){const _=T.get(m);if(_!==void 0)return _}const x=r(p),C=x.audioWorklet===void 0?i(m).then(([_,w])=>{const[b,v]=Sr(_,w),O=`${b};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${v}
})})(window,'_AWGS')`;return t(O)}).then(()=>{const _=d._AWGS.pop();if(_===void 0)throw new SyntaxError;n(x.currentTime,x.sampleRate,()=>_(class{},void 0,(w,b)=>{if(w.trim()==="")throw e();const v=Ci.get(x);if(v!==void 0){if(v.has(w))throw e();kr(b),Cr(b.parameterDescriptors),v.set(w,b)}else kr(b),Cr(b.parameterDescriptors),Ci.set(x,new Map([[w,b]]))},x.sampleRate,void 0,void 0))}):Promise.all([i(m),Promise.resolve(s(h,h))]).then(([[_,w],b])=>{const v=f+1;f=v;const[O,N]=Sr(_,w),E=`${O};((AudioWorkletProcessor,registerProcessor)=>{${N}
})(${b?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${b?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${b?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${v}',class extends AudioWorkletProcessor{process(){return !1}})`,P=new Blob([E],{type:"application/javascript; charset=utf-8"}),R=URL.createObjectURL(P);return x.audioWorklet.addModule(R,g).then(()=>{if(o(x))return x;const V=a(x);return V.audioWorklet.addModule(R,g).then(()=>V)}).then(V=>{if(c===null)throw new SyntaxError;try{new c(V,`__sac${v}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(R))});return T===void 0?l.set(p,new Map([[m,C]])):T.set(m,C),C.then(()=>{const _=u.get(p);_===void 0?u.set(p,new Set([m])):_.add(m)}).finally(()=>{const _=l.get(p);_!==void 0&&_.delete(m)}),C}},Ze=(s,e)=>{const t=s.get(e);if(t===void 0)throw new Error("A value with the given key could not be found.");return t},ni=(s,e)=>{const t=Array.from(s).filter(e);if(t.length>1)throw Error("More than one element was found.");if(t.length===0)throw Error("No element was found.");const[n]=t;return s.delete(n),n},co=(s,e,t,n)=>{const i=Ze(s,e),r=ni(i,a=>a[0]===t&&a[1]===n);return i.size===0&&s.delete(e),r},es=s=>Ze(oo,s),pn=s=>{if(dn.has(s))throw new Error("The AudioNode is already stored.");dn.add(s),es(s).forEach(e=>e(!0))},lo=s=>"port"in s,ts=s=>{if(!dn.has(s))throw new Error("The AudioNode is not stored.");dn.delete(s),es(s).forEach(e=>e(!1))},Ai=(s,e)=>{!lo(s)&&e.every(t=>t.size===0)&&ts(s)},Ic=(s,e,t,n,i,r,a,o,c,l,u,h,d)=>{const f=new WeakMap;return(p,m,g,y,T)=>{const{activeInputs:x,passiveInputs:C}=r(m),{outputs:_}=r(p),w=o(p),b=v=>{const O=c(m),N=c(p);if(v){const A=co(C,p,g,y);s(x,p,A,!1),!T&&!h(p)&&t(N,O,g,y),d(m)&&pn(m)}else{const A=n(x,p,g,y);e(C,y,A,!1),!T&&!h(p)&&i(N,O,g,y);const k=a(m);if(k===0)u(m)&&Ai(m,x);else{const M=f.get(m);M!==void 0&&clearTimeout(M),f.set(m,setTimeout(()=>{u(m)&&Ai(m,x)},k*1e3))}}};return l(_,[m,g,y],v=>v[0]===m&&v[1]===g&&v[2]===y,!0)?(w.add(b),u(p)?s(x,p,[g,y,b],!0):e(C,y,[p,g,b],!0),!0):!1}},Rc=s=>(e,t,[n,i,r],a)=>{const o=e.get(n);o===void 0?e.set(n,new Set([[i,t,r]])):s(o,[i,t,r],c=>c[0]===i&&c[1]===t,a)},Vc=s=>(e,t)=>{const n=s(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});t.connect(n).connect(e.destination);const i=()=>{t.removeEventListener("ended",i),t.disconnect(n),n.disconnect()};t.addEventListener("ended",i)},Fc=s=>(e,t)=>{s(e).add(t)},Pc={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},qc=(s,e,t,n,i,r)=>class extends s{constructor(o,c){const l=i(o),u={...Pc,...c},h=n(l,u),d=r(l)?e():null;super(o,!1,h,d),this._nativeAnalyserNode=h}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(o){this._nativeAnalyserNode.fftSize=o}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(o){const c=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=o,!(o>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=c,t()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(o){const c=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=o,!(this._nativeAnalyserNode.maxDecibels>o))throw this._nativeAnalyserNode.minDecibels=c,t()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(o){this._nativeAnalyserNode.smoothingTimeConstant=o}getByteFrequencyData(o){this._nativeAnalyserNode.getByteFrequencyData(o)}getByteTimeDomainData(o){this._nativeAnalyserNode.getByteTimeDomainData(o)}getFloatFrequencyData(o){this._nativeAnalyserNode.getFloatFrequencyData(o)}getFloatTimeDomainData(o){this._nativeAnalyserNode.getFloatTimeDomainData(o)}},Ce=(s,e)=>s.context===e,Lc=(s,e,t)=>()=>{const n=new WeakMap,i=async(r,a)=>{let o=e(r);if(!Ce(o,a)){const l={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,fftSize:o.fftSize,maxDecibels:o.maxDecibels,minDecibels:o.minDecibels,smoothingTimeConstant:o.smoothingTimeConstant};o=s(a,l)}return n.set(a,o),await t(r,a,o),o};return{render(r,a){const o=n.get(a);return o!==void 0?Promise.resolve(o):i(r,a)}}},Ss=s=>{try{s.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},it=()=>new DOMException("","IndexSizeError"),Li=s=>{s.getChannelData=(e=>t=>{try{return e.call(s,t)}catch(n){throw n.code===12?it():n}})(s.getChannelData)},Wc={numberOfChannels:1},jc=(s,e,t,n,i,r,a,o)=>{let c=null;return class uo{constructor(u){if(i===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:h,numberOfChannels:d,sampleRate:f}={...Wc,...u};c===null&&(c=new i(1,1,44100));const p=n!==null&&e(r,r)?new n({length:h,numberOfChannels:d,sampleRate:f}):c.createBuffer(d,h,f);if(p.numberOfChannels===0)throw t();return typeof p.copyFromChannel!="function"?(a(p),Li(p)):e(Ss,()=>Ss(p))||o(p),s.add(p),p}static[Symbol.hasInstance](u){return u!==null&&typeof u=="object"&&Object.getPrototypeOf(u)===uo.prototype||s.has(u)}}},De=-34028234663852886e22,Ae=-De,ft=s=>dn.has(s),Bc={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},$c=(s,e,t,n,i,r,a,o)=>class extends s{constructor(l,u){const h=r(l),d={...Bc,...u},f=i(h,d),p=a(h),m=p?e():null;super(l,!1,f,m),this._audioBufferSourceNodeRenderer=m,this._isBufferNullified=!1,this._isBufferSet=d.buffer!==null,this._nativeAudioBufferSourceNode=f,this._onended=null,this._playbackRate=t(this,p,f.playbackRate,Ae,De)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(l){if(this._nativeAudioBufferSourceNode.buffer=l,l!==null){if(this._isBufferSet)throw n();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(l){this._nativeAudioBufferSourceNode.loop=l}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(l){this._nativeAudioBufferSourceNode.loopEnd=l}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(l){this._nativeAudioBufferSourceNode.loopStart=l}get onended(){return this._onended}set onended(l){const u=typeof l=="function"?o(this,l):null;this._nativeAudioBufferSourceNode.onended=u;const h=this._nativeAudioBufferSourceNode.onended;this._onended=h!==null&&h===u?l:h}get playbackRate(){return this._playbackRate}start(l=0,u=0,h){if(this._nativeAudioBufferSourceNode.start(l,u,h),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=h===void 0?[l,u]:[l,u,h]),this.context.state!=="closed"){pn(this);const d=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",d),ft(this)&&ts(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",d)}}stop(l=0){this._nativeAudioBufferSourceNode.stop(l),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=l)}},Uc=(s,e,t,n,i)=>()=>{const r=new WeakMap;let a=null,o=null;const c=async(l,u)=>{let h=t(l);const d=Ce(h,u);if(!d){const f={buffer:h.buffer,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,loop:h.loop,loopEnd:h.loopEnd,loopStart:h.loopStart,playbackRate:h.playbackRate.value};h=e(u,f),a!==null&&h.start(...a),o!==null&&h.stop(o)}return r.set(u,h),d?await s(u,l.playbackRate,h.playbackRate):await n(u,l.playbackRate,h.playbackRate),await i(l,u,h),h};return{set start(l){a=l},set stop(l){o=l},render(l,u){const h=r.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}},Gc=s=>"playbackRate"in s,zc=s=>"frequency"in s&&"gain"in s,Zc=s=>"offset"in s,Xc=s=>!("frequency"in s)&&"gain"in s,Hc=s=>"detune"in s&&"frequency"in s,Yc=s=>"pan"in s,Ne=s=>Ze(io,s),ns=s=>Ze(ro,s),Ni=(s,e)=>{const{activeInputs:t}=Ne(s);t.forEach(i=>i.forEach(([r])=>{e.includes(s)||Ni(r,[...e,s])}));const n=Gc(s)?[s.playbackRate]:lo(s)?Array.from(s.parameters.values()):zc(s)?[s.Q,s.detune,s.frequency,s.gain]:Zc(s)?[s.offset]:Xc(s)?[s.gain]:Hc(s)?[s.detune,s.frequency]:Yc(s)?[s.pan]:[];for(const i of n){const r=ns(i);r!==void 0&&r.activeInputs.forEach(([a])=>Ni(a,e))}ft(s)&&ts(s)},ho=s=>{Ni(s.destination,[])},Qc=s=>s===void 0||typeof s=="number"||typeof s=="string"&&(s==="balanced"||s==="interactive"||s==="playback"),Jc=(s,e,t,n,i,r,a,o,c)=>class extends s{constructor(u={}){if(c===null)throw new Error("Missing the native AudioContext constructor.");let h;try{h=new c(u)}catch(p){throw p.code===12&&p.message==="sampleRate is not in range"?t():p}if(h===null)throw n();if(!Qc(u.latencyHint))throw new TypeError(`The provided value '${u.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(u.sampleRate!==void 0&&h.sampleRate!==u.sampleRate)throw t();super(h,2);const{latencyHint:d}=u,{sampleRate:f}=h;if(this._baseLatency=typeof h.baseLatency=="number"?h.baseLatency:d==="balanced"?512/f:d==="interactive"||d===void 0?256/f:d==="playback"?1024/f:Math.max(2,Math.min(128,Math.round(d*f/128)))*128/f,this._nativeAudioContext=h,c.name==="webkitAudioContext"?(this._nativeGainNode=h.createGain(),this._nativeOscillatorNode=h.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(h.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,h.state==="running"){this._state="suspended";const p=()=>{this._state==="suspended"&&(this._state=null),h.removeEventListener("statechange",p)};h.addEventListener("statechange",p)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw e()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),ho(this)}))}createMediaElementSource(u){return new i(this,{mediaElement:u})}createMediaStreamDestination(){return new r(this)}createMediaStreamSource(u){return new a(this,{mediaStream:u})}createMediaStreamTrackSource(u){return new o(this,{mediaStreamTrack:u})}resume(){return this._state==="suspended"?new Promise((u,h)=>{const d=()=>{this._nativeAudioContext.removeEventListener("statechange",d),this._nativeAudioContext.state==="running"?u():this.resume().then(u,h)};this._nativeAudioContext.addEventListener("statechange",d)}):this._nativeAudioContext.resume().catch(u=>{throw u===void 0||u.code===15?e():u})}suspend(){return this._nativeAudioContext.suspend().catch(u=>{throw u===void 0?e():u})}},Kc=(s,e,t,n,i,r,a,o)=>class extends s{constructor(l,u){const h=r(l),d=a(h),f=i(h,u,d),p=d?e(o):null;super(l,!1,f,p),this._isNodeOfNativeOfflineAudioContext=d,this._nativeAudioDestinationNode=f}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(l){if(this._isNodeOfNativeOfflineAudioContext)throw n();if(l>this._nativeAudioDestinationNode.maxChannelCount)throw t();this._nativeAudioDestinationNode.channelCount=l}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(l){if(this._isNodeOfNativeOfflineAudioContext)throw n();this._nativeAudioDestinationNode.channelCountMode=l}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},el=s=>{const e=new WeakMap,t=async(n,i)=>{const r=i.destination;return e.set(i,r),await s(n,i,r),r};return{render(n,i){const r=e.get(i);return r!==void 0?Promise.resolve(r):t(n,i)}}},tl=(s,e,t,n,i,r,a,o)=>(c,l)=>{const u=l.listener,h=()=>{const _=new Float32Array(1),w=e(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),b=a(l);let v=!1,O=[0,0,-1,0,1,0],N=[0,0,0];const A=()=>{if(v)return;v=!0;const P=n(l,256,9,0);P.onaudioprocess=({inputBuffer:R})=>{const V=[r(R,_,0),r(R,_,1),r(R,_,2),r(R,_,3),r(R,_,4),r(R,_,5)];V.some((q,B)=>q!==O[B])&&(u.setOrientation(...V),O=V);const $=[r(R,_,6),r(R,_,7),r(R,_,8)];$.some((q,B)=>q!==N[B])&&(u.setPosition(...$),N=$)},w.connect(P)},k=P=>R=>{R!==O[P]&&(O[P]=R,u.setOrientation(...O))},M=P=>R=>{R!==N[P]&&(N[P]=R,u.setPosition(...N))},E=(P,R,V)=>{const $=t(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:R});$.connect(w,0,P),$.start(),Object.defineProperty($.offset,"defaultValue",{get(){return R}});const q=s({context:c},b,$.offset,Ae,De);return o(q,"value",B=>()=>B.call(q),B=>j=>{try{B.call(q,j)}catch(K){if(K.code!==9)throw K}A(),b&&V(j)}),q.cancelAndHoldAtTime=(B=>b?()=>{throw i()}:(...j)=>{const K=B.apply(q,j);return A(),K})(q.cancelAndHoldAtTime),q.cancelScheduledValues=(B=>b?()=>{throw i()}:(...j)=>{const K=B.apply(q,j);return A(),K})(q.cancelScheduledValues),q.exponentialRampToValueAtTime=(B=>b?()=>{throw i()}:(...j)=>{const K=B.apply(q,j);return A(),K})(q.exponentialRampToValueAtTime),q.linearRampToValueAtTime=(B=>b?()=>{throw i()}:(...j)=>{const K=B.apply(q,j);return A(),K})(q.linearRampToValueAtTime),q.setTargetAtTime=(B=>b?()=>{throw i()}:(...j)=>{const K=B.apply(q,j);return A(),K})(q.setTargetAtTime),q.setValueAtTime=(B=>b?()=>{throw i()}:(...j)=>{const K=B.apply(q,j);return A(),K})(q.setValueAtTime),q.setValueCurveAtTime=(B=>b?()=>{throw i()}:(...j)=>{const K=B.apply(q,j);return A(),K})(q.setValueCurveAtTime),q};return{forwardX:E(0,0,k(0)),forwardY:E(1,0,k(1)),forwardZ:E(2,-1,k(2)),positionX:E(6,0,M(0)),positionY:E(7,0,M(1)),positionZ:E(8,0,M(2)),upX:E(3,0,k(3)),upY:E(4,1,k(4)),upZ:E(5,0,k(5))}},{forwardX:d,forwardY:f,forwardZ:p,positionX:m,positionY:g,positionZ:y,upX:T,upY:x,upZ:C}=u.forwardX===void 0?h():u;return{get forwardX(){return d},get forwardY(){return f},get forwardZ(){return p},get positionX(){return m},get positionY(){return g},get positionZ(){return y},get upX(){return T},get upY(){return x},get upZ(){return C}}},Cs=s=>"context"in s,ss=s=>Cs(s[0]),Jt=(s,e,t,n)=>{for(const i of s)if(t(i)){if(n)return!1;throw Error("The set contains at least one similar element.")}return s.add(e),!0},Ar=(s,e,[t,n],i)=>{Jt(s,[e,t,n],r=>r[0]===e&&r[1]===t,i)},Nr=(s,[e,t,n],i)=>{const r=s.get(e);r===void 0?s.set(e,new Set([[t,n]])):Jt(r,[t,n],a=>a[0]===t,i)},Cn=s=>"inputs"in s,ks=(s,e,t,n)=>{if(Cn(e)){const i=e.inputs[n];return s.connect(i,t,0),[i,t,0]}return s.connect(e,t,n),[e,t,n]},po=(s,e,t)=>{for(const n of s)if(n[0]===e&&n[1]===t)return s.delete(n),n;return null},nl=(s,e,t)=>ni(s,n=>n[0]===e&&n[1]===t),fo=(s,e)=>{if(!es(s).delete(e))throw new Error("Missing the expected event listener.")},mo=(s,e,t)=>{const n=Ze(s,e),i=ni(n,r=>r[0]===t);return n.size===0&&s.delete(e),i},As=(s,e,t,n)=>{Cn(e)?s.disconnect(e.inputs[n],t,0):s.disconnect(e,t,n)},ne=s=>Ze(Pi,s),Vn=s=>Ze(qi,s),Ut=s=>Si.has(s),fs=s=>!dn.has(s),Or=(s,e)=>new Promise(t=>{if(e!==null)t(!0);else{const n=s.createScriptProcessor(256,1,1),i=s.createGain(),r=s.createBuffer(1,2,44100),a=r.getChannelData(0);a[0]=1,a[1]=1;const o=s.createBufferSource();o.buffer=r,o.loop=!0,o.connect(n).connect(s.destination),o.connect(i),o.disconnect(i),n.onaudioprocess=c=>{const l=c.inputBuffer.getChannelData(0);Array.prototype.some.call(l,u=>u===1)?t(!0):t(!1),o.stop(),n.onaudioprocess=null,o.disconnect(n),n.disconnect(s.destination)},o.start()}}),mi=(s,e)=>{const t=new Map;for(const n of s)for(const i of n){const r=t.get(i);t.set(i,r===void 0?1:r+1)}t.forEach((n,i)=>e(i,n))},Ns=s=>"context"in s,sl=s=>{const e=new Map;s.connect=(t=>(n,i=0,r=0)=>{const a=Ns(n)?t(n,i,r):t(n,i),o=e.get(n);return o===void 0?e.set(n,[{input:r,output:i}]):o.every(c=>c.input!==r||c.output!==i)&&o.push({input:r,output:i}),a})(s.connect.bind(s)),s.disconnect=(t=>(n,i,r)=>{if(t.apply(s),n===void 0)e.clear();else if(typeof n=="number")for(const[a,o]of e){const c=o.filter(l=>l.output!==n);c.length===0?e.delete(a):e.set(a,c)}else if(e.has(n))if(i===void 0)e.delete(n);else{const a=e.get(n);if(a!==void 0){const o=a.filter(c=>c.output!==i&&(c.input!==r||r===void 0));o.length===0?e.delete(n):e.set(n,o)}}for(const[a,o]of e)o.forEach(c=>{Ns(a)?s.connect(a,c.output,c.input):s.connect(a,c.output)})})(s.disconnect)},il=(s,e,t,n)=>{const{activeInputs:i,passiveInputs:r}=ns(e),{outputs:a}=Ne(s),o=es(s),c=l=>{const u=ne(s),h=Vn(e);if(l){const d=mo(r,s,t);Ar(i,s,d,!1),!n&&!Ut(s)&&u.connect(h,t)}else{const d=nl(i,s,t);Nr(r,d,!1),!n&&!Ut(s)&&u.disconnect(h,t)}};return Jt(a,[e,t],l=>l[0]===e&&l[1]===t,!0)?(o.add(c),ft(s)?Ar(i,s,[t,c],!0):Nr(r,[s,t,c],!0),!0):!1},rl=(s,e,t,n)=>{const{activeInputs:i,passiveInputs:r}=Ne(e),a=po(i[n],s,t);return a===null?[co(r,s,t,n)[2],!1]:[a[2],!0]},ol=(s,e,t)=>{const{activeInputs:n,passiveInputs:i}=ns(e),r=po(n,s,t);return r===null?[mo(i,s,t)[1],!1]:[r[2],!0]},Wi=(s,e,t,n,i)=>{const[r,a]=rl(s,t,n,i);if(r!==null&&(fo(s,r),a&&!e&&!Ut(s)&&As(ne(s),ne(t),n,i)),ft(t)){const{activeInputs:o}=Ne(t);Ai(t,o)}},ji=(s,e,t,n)=>{const[i,r]=ol(s,t,n);i!==null&&(fo(s,i),r&&!e&&!Ut(s)&&ne(s).disconnect(Vn(t),n))},al=(s,e)=>{const t=Ne(s),n=[];for(const i of t.outputs)ss(i)?Wi(s,e,...i):ji(s,e,...i),n.push(i[0]);return t.outputs.clear(),n},cl=(s,e,t)=>{const n=Ne(s),i=[];for(const r of n.outputs)r[1]===t&&(ss(r)?Wi(s,e,...r):ji(s,e,...r),i.push(r[0]),n.outputs.delete(r));return i},ll=(s,e,t,n,i)=>{const r=Ne(s);return Array.from(r.outputs).filter(a=>a[0]===t&&(n===void 0||a[1]===n)&&(i===void 0||a[2]===i)).map(a=>(ss(a)?Wi(s,e,...a):ji(s,e,...a),r.outputs.delete(a),a[0]))},ul=(s,e,t,n,i,r,a,o,c,l,u,h,d,f,p,m)=>class extends l{constructor(y,T,x,C){super(x),this._context=y,this._nativeAudioNode=x;const _=u(y);h(_)&&t(Or,()=>Or(_,m))!==!0&&sl(x),Pi.set(this,x),oo.set(this,new Set),y.state!=="closed"&&T&&pn(this),s(this,C,x)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(y){this._nativeAudioNode.channelCount=y}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(y){this._nativeAudioNode.channelCountMode=y}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(y){this._nativeAudioNode.channelInterpretation=y}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(y,T=0,x=0){if(T<0||T>=this._nativeAudioNode.numberOfOutputs)throw i();const C=u(this._context),_=p(C);if(d(y)||f(y))throw r();if(Cs(y)){const v=ne(y);try{const N=ks(this._nativeAudioNode,v,T,x),A=fs(this);(_||A)&&this._nativeAudioNode.disconnect(...N),this.context.state!=="closed"&&!A&&fs(y)&&pn(y)}catch(N){throw N.code===12?r():N}if(e(this,y,T,x,_)){const N=c([this],y);mi(N,n(_))}return y}const w=Vn(y);if(w.name==="playbackRate"&&w.maxValue===1024)throw a();try{this._nativeAudioNode.connect(w,T),(_||fs(this))&&this._nativeAudioNode.disconnect(w,T)}catch(v){throw v.code===12?r():v}if(il(this,y,T,_)){const v=c([this],y);mi(v,n(_))}}disconnect(y,T,x){let C;const _=u(this._context),w=p(_);if(y===void 0)C=al(this,w);else if(typeof y=="number"){if(y<0||y>=this.numberOfOutputs)throw i();C=cl(this,w,y)}else{if(T!==void 0&&(T<0||T>=this.numberOfOutputs)||Cs(y)&&x!==void 0&&(x<0||x>=y.numberOfInputs))throw i();if(C=ll(this,w,y,T,x),C.length===0)throw r()}for(const b of C){const v=c([this],b);mi(v,o)}}},hl=(s,e,t,n,i,r,a,o,c,l,u,h,d)=>(f,p,m,g=null,y=null)=>{const T=m.value,x=new bc(T),C=p?n(x):null,_={get defaultValue(){return T},get maxValue(){return g===null?m.maxValue:g},get minValue(){return y===null?m.minValue:y},get value(){return m.value},set value(w){m.value=w,_.setValueAtTime(w,f.context.currentTime)},cancelAndHoldAtTime(w){if(typeof m.cancelAndHoldAtTime=="function")C===null&&x.flush(f.context.currentTime),x.add(i(w)),m.cancelAndHoldAtTime(w);else{const b=Array.from(x).pop();C===null&&x.flush(f.context.currentTime),x.add(i(w));const v=Array.from(x).pop();m.cancelScheduledValues(w),b!==v&&v!==void 0&&(v.type==="exponentialRampToValue"?m.exponentialRampToValueAtTime(v.value,v.endTime):v.type==="linearRampToValue"?m.linearRampToValueAtTime(v.value,v.endTime):v.type==="setValue"?m.setValueAtTime(v.value,v.startTime):v.type==="setValueCurve"&&m.setValueCurveAtTime(v.values,v.startTime,v.duration))}return _},cancelScheduledValues(w){return C===null&&x.flush(f.context.currentTime),x.add(r(w)),m.cancelScheduledValues(w),_},exponentialRampToValueAtTime(w,b){if(w===0)throw new RangeError;if(!Number.isFinite(b)||b<0)throw new RangeError;const v=f.context.currentTime;return C===null&&x.flush(v),Array.from(x).length===0&&(x.add(l(T,v)),m.setValueAtTime(T,v)),x.add(a(w,b)),m.exponentialRampToValueAtTime(w,b),_},linearRampToValueAtTime(w,b){const v=f.context.currentTime;return C===null&&x.flush(v),Array.from(x).length===0&&(x.add(l(T,v)),m.setValueAtTime(T,v)),x.add(o(w,b)),m.linearRampToValueAtTime(w,b),_},setTargetAtTime(w,b,v){return C===null&&x.flush(f.context.currentTime),x.add(c(w,b,v)),m.setTargetAtTime(w,b,v),_},setValueAtTime(w,b){return C===null&&x.flush(f.context.currentTime),x.add(l(w,b)),m.setValueAtTime(w,b),_},setValueCurveAtTime(w,b,v){const O=w instanceof Float32Array?w:new Float32Array(w);if(h!==null&&h.name==="webkitAudioContext"){const N=b+v,A=f.context.sampleRate,k=Math.ceil(b*A),M=Math.floor(N*A),E=M-k,P=new Float32Array(E);for(let V=0;V<E;V+=1){const $=(O.length-1)/v*((k+V)/A-b),q=Math.floor($),B=Math.ceil($);P[V]=q===B?O[q]:(1-($-q))*O[q]+(1-(B-$))*O[B]}C===null&&x.flush(f.context.currentTime),x.add(u(P,b,v)),m.setValueCurveAtTime(P,b,v);const R=M/A;R<N&&d(_,P[P.length-1],R),d(_,O[O.length-1],N)}else C===null&&x.flush(f.context.currentTime),x.add(u(O,b,v)),m.setValueCurveAtTime(O,b,v);return _}};return t.set(_,m),e.set(_,f),s(_,C),_},dl=s=>({replay(e){for(const t of s)if(t.type==="exponentialRampToValue"){const{endTime:n,value:i}=t;e.exponentialRampToValueAtTime(i,n)}else if(t.type==="linearRampToValue"){const{endTime:n,value:i}=t;e.linearRampToValueAtTime(i,n)}else if(t.type==="setTarget"){const{startTime:n,target:i,timeConstant:r}=t;e.setTargetAtTime(i,n,r)}else if(t.type==="setValue"){const{startTime:n,value:i}=t;e.setValueAtTime(i,n)}else if(t.type==="setValueCurve"){const{duration:n,startTime:i,values:r}=t;e.setValueCurveAtTime(r,i,n)}else throw new Error("Can't apply an unknown automation.")}});class go{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,t=null){return this._map.forEach((n,i)=>e.call(t,n,i,this))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const pl={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},fl=(s,e,t,n,i,r,a,o,c,l,u,h,d,f)=>class extends e{constructor(m,g,y){var T;const x=o(m),C=c(x),_=u({...pl,...y});d(_);const w=Ci.get(x),b=w?.get(g),v=C||x.state!=="closed"?x:(T=a(x))!==null&&T!==void 0?T:x,O=i(v,C?null:m.baseLatency,l,g,b,_),N=C?n(g,_,b):null;super(m,!0,O,N);const A=[];O.parameters.forEach((M,E)=>{const P=t(this,C,M);A.push([E,P])}),this._nativeAudioWorkletNode=O,this._onprocessorerror=null,this._parameters=new go(A),C&&s(x,this);const{activeInputs:k}=r(this);h(O,k)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(m){const g=typeof m=="function"?f(this,m):null;this._nativeAudioWorkletNode.onprocessorerror=g;const y=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=y!==null&&y===g?m:y}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function Os(s,e,t,n,i){if(typeof s.copyFromChannel=="function")e[t].byteLength===0&&(e[t]=new Float32Array(128)),s.copyFromChannel(e[t],n,i);else{const r=s.getChannelData(n);if(e[t].byteLength===0)e[t]=r.slice(i,i+128);else{const a=new Float32Array(r.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);e[t].set(a)}}}const _o=(s,e,t,n,i)=>{typeof s.copyToChannel=="function"?e[t].byteLength!==0&&s.copyToChannel(e[t],n,i):e[t].byteLength!==0&&s.getChannelData(n).set(e[t],i)},Ds=(s,e)=>{const t=[];for(let n=0;n<s;n+=1){const i=[],r=typeof e=="number"?e:e[n];for(let a=0;a<r;a+=1)i.push(new Float32Array(128));t.push(i)}return t},ml=(s,e)=>{const t=Ze(ki,s),n=ne(e);return Ze(t,n)},gl=async(s,e,t,n,i,r,a)=>{const o=e===null?Math.ceil(s.context.length/128)*128:e.length,c=n.channelCount*n.numberOfInputs,l=i.reduce((g,y)=>g+y,0),u=l===0?null:t.createBuffer(l,o,t.sampleRate);if(r===void 0)throw new Error("Missing the processor constructor.");const h=Ne(s),d=await ml(t,s),f=Ds(n.numberOfInputs,n.channelCount),p=Ds(n.numberOfOutputs,i),m=Array.from(s.parameters.keys()).reduce((g,y)=>({...g,[y]:new Float32Array(128)}),{});for(let g=0;g<o;g+=128){if(n.numberOfInputs>0&&e!==null)for(let y=0;y<n.numberOfInputs;y+=1)for(let T=0;T<n.channelCount;T+=1)Os(e,f[y],T,T,g);r.parameterDescriptors!==void 0&&e!==null&&r.parameterDescriptors.forEach(({name:y},T)=>{Os(e,m,y,c+T,g)});for(let y=0;y<n.numberOfInputs;y+=1)for(let T=0;T<i[y];T+=1)p[y][T].byteLength===0&&(p[y][T]=new Float32Array(128));try{const y=f.map((x,C)=>h.activeInputs[C].size===0?[]:x),T=a(g/t.sampleRate,t.sampleRate,()=>d.process(y,p,m));if(u!==null)for(let x=0,C=0;x<n.numberOfOutputs;x+=1){for(let _=0;_<i[x];_+=1)_o(u,p[x],_,C+_,g);C+=i[x]}if(!T)break}catch(y){s.dispatchEvent(new ErrorEvent("processorerror",{colno:y.colno,filename:y.filename,lineno:y.lineno,message:y.message}));break}}return u},_l=(s,e,t,n,i,r,a,o,c,l,u,h,d,f,p,m)=>(g,y,T)=>{const x=new WeakMap;let C=null;const _=async(w,b)=>{let v=u(w),O=null;const N=Ce(v,b),A=Array.isArray(y.outputChannelCount)?y.outputChannelCount:Array.from(y.outputChannelCount);if(h===null){const k=A.reduce((R,V)=>R+V,0),M=i(b,{channelCount:Math.max(1,k),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,k)}),E=[];for(let R=0;R<w.numberOfOutputs;R+=1)E.push(n(b,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:A[R]}));const P=a(b,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1});P.connect=e.bind(null,E),P.disconnect=c.bind(null,E),O=[M,E,P]}else N||(v=new h(b,g));if(x.set(b,O===null?v:O[2]),O!==null){if(C===null){if(T===void 0)throw new Error("Missing the processor constructor.");if(d===null)throw new Error("Missing the native OfflineAudioContext constructor.");const V=w.channelCount*w.numberOfInputs,$=T.parameterDescriptors===void 0?0:T.parameterDescriptors.length,q=V+$;C=gl(w,q===0?null:await(async()=>{const j=new d(q,Math.ceil(w.context.length/128)*128,b.sampleRate),K=[],Re=[];for(let se=0;se<y.numberOfInputs;se+=1)K.push(a(j,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1})),Re.push(i(j,{channelCount:y.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:y.channelCount}));const Ve=await Promise.all(Array.from(w.parameters.values()).map(async se=>{const ke=r(j,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:se.value});return await f(j,se,ke.offset),ke})),U=n(j,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,V+$)});for(let se=0;se<y.numberOfInputs;se+=1){K[se].connect(Re[se]);for(let ke=0;ke<y.channelCount;ke+=1)Re[se].connect(U,ke,se*y.channelCount+ke)}for(const[se,ke]of Ve.entries())ke.connect(U,0,V+se),ke.start(0);return U.connect(j.destination),await Promise.all(K.map(se=>p(w,j,se))),m(j)})(),b,y,A,T,l)}const k=await C,M=t(b,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[E,P,R]=O;k!==null&&(M.buffer=k,M.start(0)),M.connect(E);for(let V=0,$=0;V<w.numberOfOutputs;V+=1){const q=P[V];for(let B=0;B<A[V];B+=1)E.connect(q,$+B,B);$+=A[V]}return R}if(N)for(const[k,M]of w.parameters.entries())await s(b,M,v.parameters.get(k));else for(const[k,M]of w.parameters.entries())await f(b,M,v.parameters.get(k));return await p(w,b,v),v};return{render(w,b){o(b,w);const v=x.get(b);return v!==void 0?Promise.resolve(v):_(w,b)}}},yl=(s,e,t,n,i,r,a,o,c,l,u,h,d,f,p,m,g,y,T,x)=>class extends p{constructor(_,w){super(_,w),this._nativeContext=_,this._audioWorklet=s===void 0?void 0:{addModule:(b,v)=>s(this,b,v)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new i(this)}createBuffer(_,w,b){return new t({length:w,numberOfChannels:_,sampleRate:b})}createBufferSource(){return new n(this)}createChannelMerger(_=6){return new r(this,{numberOfInputs:_})}createChannelSplitter(_=6){return new a(this,{numberOfOutputs:_})}createConstantSource(){return new o(this)}createConvolver(){return new c(this)}createDelay(_=1){return new u(this,{maxDelayTime:_})}createDynamicsCompressor(){return new h(this)}createGain(){return new d(this)}createIIRFilter(_,w){return new f(this,{feedback:w,feedforward:_})}createOscillator(){return new m(this)}createPanner(){return new g(this)}createPeriodicWave(_,w,b={disableNormalization:!1}){return new y(this,{...b,imag:w,real:_})}createStereoPanner(){return new T(this)}createWaveShaper(){return new x(this)}decodeAudioData(_,w,b){return l(this._nativeContext,_).then(v=>(typeof w=="function"&&w(v),v),v=>{throw typeof b=="function"&&b(v),v})}},vl={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},wl=(s,e,t,n,i,r,a,o)=>class extends s{constructor(l,u){const h=r(l),d={...vl,...u},f=i(h,d),p=a(h),m=p?t():null;super(l,!1,f,m),this._Q=e(this,p,f.Q,Ae,De),this._detune=e(this,p,f.detune,1200*Math.log2(Ae),-1200*Math.log2(Ae)),this._frequency=e(this,p,f.frequency,l.sampleRate/2,0),this._gain=e(this,p,f.gain,40*Math.log10(Ae),De),this._nativeBiquadFilterNode=f,o(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(l){this._nativeBiquadFilterNode.type=l}getFrequencyResponse(l,u,h){try{this._nativeBiquadFilterNode.getFrequencyResponse(l,u,h)}catch(d){throw d.code===11?n():d}if(l.length!==u.length||u.length!==h.length)throw n()}},bl=(s,e,t,n,i)=>()=>{const r=new WeakMap,a=async(o,c)=>{let l=t(o);const u=Ce(l,c);if(!u){const h={Q:l.Q.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,detune:l.detune.value,frequency:l.frequency.value,gain:l.gain.value,type:l.type};l=e(c,h)}return r.set(c,l),u?(await s(c,o.Q,l.Q),await s(c,o.detune,l.detune),await s(c,o.frequency,l.frequency),await s(c,o.gain,l.gain)):(await n(c,o.Q,l.Q),await n(c,o.detune,l.detune),await n(c,o.frequency,l.frequency),await n(c,o.gain,l.gain)),await i(o,c,l),l};return{render(o,c){const l=r.get(c);return l!==void 0?Promise.resolve(l):a(o,c)}}},Tl=(s,e)=>(t,n)=>{const i=e.get(t);if(i!==void 0)return i;const r=s.get(t);if(r!==void 0)return r;try{const a=n();return a instanceof Promise?(s.set(t,a),a.catch(()=>!1).then(o=>(s.delete(t),e.set(t,o),o))):(e.set(t,a),a)}catch{return e.set(t,!1),!1}},xl={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},Sl=(s,e,t,n,i)=>class extends s{constructor(a,o){const c=n(a),l={...xl,...o},u=t(c,l),h=i(c)?e():null;super(a,!1,u,h)}},Cl=(s,e,t)=>()=>{const n=new WeakMap,i=async(r,a)=>{let o=e(r);if(!Ce(o,a)){const l={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,numberOfInputs:o.numberOfInputs};o=s(a,l)}return n.set(a,o),await t(r,a,o),o};return{render(r,a){const o=n.get(a);return o!==void 0?Promise.resolve(o):i(r,a)}}},kl={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},Al=(s,e,t,n,i,r)=>class extends s{constructor(o,c){const l=n(o),u=r({...kl,...c}),h=t(l,u),d=i(l)?e():null;super(o,!1,h,d)}},Nl=(s,e,t)=>()=>{const n=new WeakMap,i=async(r,a)=>{let o=e(r);if(!Ce(o,a)){const l={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,numberOfOutputs:o.numberOfOutputs};o=s(a,l)}return n.set(a,o),await t(r,a,o),o};return{render(r,a){const o=n.get(a);return o!==void 0?Promise.resolve(o):i(r,a)}}},Ol=s=>(e,t,n)=>s(t,e,n),Dl=s=>(e,t,n=0,i=0)=>{const r=e[n];if(r===void 0)throw s();return Ns(t)?r.connect(t,0,i):r.connect(t,0)},El=s=>(e,t)=>{const n=s(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=e.createBuffer(1,2,44100);return n.buffer=i,n.loop=!0,n.connect(t),n.start(),()=>{n.stop(),n.disconnect(t)}},Ml={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},Il=(s,e,t,n,i,r,a)=>class extends s{constructor(c,l){const u=i(c),h={...Ml,...l},d=n(u,h),f=r(u),p=f?t():null;super(c,!1,d,p),this._constantSourceNodeRenderer=p,this._nativeConstantSourceNode=d,this._offset=e(this,f,d.offset,Ae,De),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?a(this,c):null;this._nativeConstantSourceNode.onended=l;const u=this._nativeConstantSourceNode.onended;this._onended=u!==null&&u===l?c:u}start(c=0){if(this._nativeConstantSourceNode.start(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=c),this.context.state!=="closed"){pn(this);const l=()=>{this._nativeConstantSourceNode.removeEventListener("ended",l),ft(this)&&ts(this)};this._nativeConstantSourceNode.addEventListener("ended",l)}}stop(c=0){this._nativeConstantSourceNode.stop(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=c)}},Rl=(s,e,t,n,i)=>()=>{const r=new WeakMap;let a=null,o=null;const c=async(l,u)=>{let h=t(l);const d=Ce(h,u);if(!d){const f={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,offset:h.offset.value};h=e(u,f),a!==null&&h.start(a),o!==null&&h.stop(o)}return r.set(u,h),d?await s(u,l.offset,h.offset):await n(u,l.offset,h.offset),await i(l,u,h),h};return{set start(l){a=l},set stop(l){o=l},render(l,u){const h=r.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}},Vl=s=>e=>(s[0]=e,s[0]),Fl={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},Pl=(s,e,t,n,i,r)=>class extends s{constructor(o,c){const l=n(o),u={...Fl,...c},h=t(l,u),f=i(l)?e():null;super(o,!1,h,f),this._isBufferNullified=!1,this._nativeConvolverNode=h,u.buffer!==null&&r(this,u.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(o){if(this._nativeConvolverNode.buffer=o,o===null&&this._nativeConvolverNode.buffer!==null){const c=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=c.createBuffer(1,1,c.sampleRate),this._isBufferNullified=!0,r(this,0)}else this._isBufferNullified=!1,r(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(o){this._nativeConvolverNode.normalize=o}},ql=(s,e,t)=>()=>{const n=new WeakMap,i=async(r,a)=>{let o=e(r);if(!Ce(o,a)){const l={buffer:o.buffer,channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,disableNormalization:!o.normalize};o=s(a,l)}return n.set(a,o),Cn(o)?await t(r,a,o.inputs[0]):await t(r,a,o),o};return{render(r,a){const o=n.get(a);return o!==void 0?Promise.resolve(o):i(r,a)}}},Ll=(s,e)=>(t,n,i)=>{if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(t,n,i)}catch(r){throw r.name==="SyntaxError"?s():r}},Wl=()=>new DOMException("","DataCloneError"),Dr=s=>{const{port1:e,port2:t}=new MessageChannel;return new Promise(n=>{const i=()=>{t.onmessage=null,e.close(),t.close(),n()};t.onmessage=()=>i();try{e.postMessage(s,[s])}catch{}finally{i()}})},jl=(s,e,t,n,i,r,a,o,c,l,u)=>(h,d)=>{const f=a(h)?h:r(h);if(i.has(d)){const p=t();return Promise.reject(p)}try{i.add(d)}catch{}return e(c,()=>c(f))?f.decodeAudioData(d).then(p=>(Dr(d).catch(()=>{}),e(o,()=>o(p))||u(p),s.add(p),p)):new Promise((p,m)=>{const g=async()=>{try{await Dr(d)}catch{}},y=T=>{m(T),g()};try{f.decodeAudioData(d,T=>{typeof T.copyFromChannel!="function"&&(l(T),Li(T)),s.add(T),g().then(()=>p(T))},T=>{y(T===null?n():T)})}catch(T){y(T)}})},Bl=(s,e,t,n,i,r,a,o)=>(c,l)=>{const u=e.get(c);if(u===void 0)throw new Error("Missing the expected cycle count.");const h=r(c.context),d=o(h);if(u===l){if(e.delete(c),!d&&a(c)){const f=n(c),{outputs:p}=t(c);for(const m of p)if(ss(m)){const g=n(m[0]);s(f,g,m[1],m[2])}else{const g=i(m[0]);f.connect(g,m[1])}}}else e.set(c,u-l)},$l={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},Ul=(s,e,t,n,i,r,a)=>class extends s{constructor(c,l){const u=i(c),h={...$l,...l},d=n(u,h),f=r(u),p=f?t(h.maxDelayTime):null;super(c,!1,d,p),this._delayTime=e(this,f,d.delayTime),a(this,h.maxDelayTime)}get delayTime(){return this._delayTime}},Gl=(s,e,t,n,i)=>r=>{const a=new WeakMap,o=async(c,l)=>{let u=t(c);const h=Ce(u,l);if(!h){const d={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,delayTime:u.delayTime.value,maxDelayTime:r};u=e(l,d)}return a.set(l,u),h?await s(l,c.delayTime,u.delayTime):await n(l,c.delayTime,u.delayTime),await i(c,l,u),u};return{render(c,l){const u=a.get(l);return u!==void 0?Promise.resolve(u):o(c,l)}}},zl=s=>(e,t,n,i)=>s(e[i],r=>r[0]===t&&r[1]===n),Zl=s=>(e,t)=>{s(e).delete(t)},Xl=s=>"delayTime"in s,Hl=(s,e,t)=>function n(i,r){const a=Cs(r)?r:t(s,r);if(Xl(a))return[];if(i[0]===a)return[i];if(i.includes(a))return[];const{outputs:o}=e(a);return Array.from(o).map(c=>n([...i,a],c[0])).reduce((c,l)=>c.concat(l),[])},hs=(s,e,t)=>{const n=e[t];if(n===void 0)throw s();return n},Yl=s=>(e,t=void 0,n=void 0,i=0)=>t===void 0?e.forEach(r=>r.disconnect()):typeof t=="number"?hs(s,e,t).disconnect():Ns(t)?n===void 0?e.forEach(r=>r.disconnect(t)):i===void 0?hs(s,e,n).disconnect(t,0):hs(s,e,n).disconnect(t,0,i):n===void 0?e.forEach(r=>r.disconnect(t)):hs(s,e,n).disconnect(t,0),Ql={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},Jl=(s,e,t,n,i,r,a,o)=>class extends s{constructor(l,u){const h=r(l),d={...Ql,...u},f=n(h,d),p=a(h),m=p?t():null;super(l,!1,f,m),this._attack=e(this,p,f.attack),this._knee=e(this,p,f.knee),this._nativeDynamicsCompressorNode=f,this._ratio=e(this,p,f.ratio),this._release=e(this,p,f.release),this._threshold=e(this,p,f.threshold),o(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(l){const u=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=l,l>2)throw this._nativeDynamicsCompressorNode.channelCount=u,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(l){const u=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=l,l==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=u,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},Kl=(s,e,t,n,i)=>()=>{const r=new WeakMap,a=async(o,c)=>{let l=t(o);const u=Ce(l,c);if(!u){const h={attack:l.attack.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,knee:l.knee.value,ratio:l.ratio.value,release:l.release.value,threshold:l.threshold.value};l=e(c,h)}return r.set(c,l),u?(await s(c,o.attack,l.attack),await s(c,o.knee,l.knee),await s(c,o.ratio,l.ratio),await s(c,o.release,l.release),await s(c,o.threshold,l.threshold)):(await n(c,o.attack,l.attack),await n(c,o.knee,l.knee),await n(c,o.ratio,l.ratio),await n(c,o.release,l.release),await n(c,o.threshold,l.threshold)),await i(o,c,l),l};return{render(o,c){const l=r.get(c);return l!==void 0?Promise.resolve(l):a(o,c)}}},eu=()=>new DOMException("","EncodingError"),tu=s=>e=>new Promise((t,n)=>{if(s===null){n(new SyntaxError);return}const i=s.document.head;if(i===null)n(new SyntaxError);else{const r=s.document.createElement("script"),a=new Blob([e],{type:"application/javascript"}),o=URL.createObjectURL(a),c=s.onerror,l=()=>{s.onerror=c,URL.revokeObjectURL(o)};s.onerror=(u,h,d,f,p)=>{if(h===o||h===s.location.href&&d===1&&f===1)return l(),n(p),!1;if(c!==null)return c(u,h,d,f,p)},r.onerror=()=>{l(),n(new SyntaxError)},r.onload=()=>{l(),t()},r.src=o,r.type="module",i.appendChild(r)}}),nu=s=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(t,n,i){if(n!==null){let r=this._listeners.get(n);r===void 0&&(r=s(this,n),typeof n=="function"&&this._listeners.set(n,r)),this._nativeEventTarget.addEventListener(t,r,i)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,n,i){const r=n===null?void 0:this._listeners.get(n);this._nativeEventTarget.removeEventListener(t,r===void 0?null:r,i)}},su=s=>(e,t,n)=>{Object.defineProperties(s,{currentFrame:{configurable:!0,get(){return Math.round(e*t)}},currentTime:{configurable:!0,get(){return e}}});try{return n()}finally{s!==null&&(delete s.currentFrame,delete s.currentTime)}},iu=s=>async e=>{try{const t=await fetch(e);if(t.ok)return[await t.text(),t.url]}catch{}throw s()},ru={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},ou=(s,e,t,n,i,r)=>class extends s{constructor(o,c){const l=i(o),u={...ru,...c},h=n(l,u),d=r(l),f=d?t():null;super(o,!1,h,f),this._gain=e(this,d,h.gain,Ae,De)}get gain(){return this._gain}},au=(s,e,t,n,i)=>()=>{const r=new WeakMap,a=async(o,c)=>{let l=t(o);const u=Ce(l,c);if(!u){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,gain:l.gain.value};l=e(c,h)}return r.set(c,l),u?await s(c,o.gain,l.gain):await n(c,o.gain,l.gain),await i(o,c,l),l};return{render(o,c){const l=r.get(c);return l!==void 0?Promise.resolve(l):a(o,c)}}},cu=(s,e)=>t=>e(s,t),lu=s=>e=>{const t=s(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return t.renderer},uu=s=>e=>{var t;return(t=s.get(e))!==null&&t!==void 0?t:0},hu=s=>e=>{const t=s(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return t.renderer},du=s=>e=>s.get(e),ve=()=>new DOMException("","InvalidStateError"),pu=s=>e=>{const t=s.get(e);if(t===void 0)throw ve();return t},fu=(s,e)=>t=>{let n=s.get(t);if(n!==void 0)return n;if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");return n=new e(1,1,44100),s.set(t,n),n},mu=s=>e=>{const t=s.get(e);if(t===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return t},si=()=>new DOMException("","InvalidAccessError"),gu=s=>{s.getFrequencyResponse=(e=>(t,n,i)=>{if(t.length!==n.length||n.length!==i.length)throw si();return e.call(s,t,n,i)})(s.getFrequencyResponse)},_u={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},yu=(s,e,t,n,i,r)=>class extends s{constructor(o,c){const l=n(o),u=i(l),h={..._u,...c},d=e(l,u?null:o.baseLatency,h),f=u?t(h.feedback,h.feedforward):null;super(o,!1,d,f),gu(d),this._nativeIIRFilterNode=d,r(this,1)}getFrequencyResponse(o,c,l){return this._nativeIIRFilterNode.getFrequencyResponse(o,c,l)}},yo=(s,e,t,n,i,r,a,o,c,l,u)=>{const h=l.length;let d=o;for(let f=0;f<h;f+=1){let p=t[0]*l[f];for(let m=1;m<i;m+=1){const g=d-m&c-1;p+=t[m]*r[g],p-=s[m]*a[g]}for(let m=i;m<n;m+=1)p+=t[m]*r[d-m&c-1];for(let m=i;m<e;m+=1)p-=s[m]*a[d-m&c-1];r[d]=l[f],a[d]=p,d=d+1&c-1,u[f]=p}return d},vu=(s,e,t,n)=>{const i=t instanceof Float64Array?t:new Float64Array(t),r=n instanceof Float64Array?n:new Float64Array(n),a=i.length,o=r.length,c=Math.min(a,o);if(i[0]!==1){for(let p=0;p<a;p+=1)r[p]/=i[0];for(let p=1;p<o;p+=1)i[p]/=i[0]}const l=32,u=new Float32Array(l),h=new Float32Array(l),d=e.createBuffer(s.numberOfChannels,s.length,s.sampleRate),f=s.numberOfChannels;for(let p=0;p<f;p+=1){const m=s.getChannelData(p),g=d.getChannelData(p);u.fill(0),h.fill(0),yo(i,a,r,o,c,u,h,0,l,m,g)}return d},wu=(s,e,t,n,i)=>(r,a)=>{const o=new WeakMap;let c=null;const l=async(u,h)=>{let d=null,f=e(u);const p=Ce(f,h);if(h.createIIRFilter===void 0?d=s(h,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):p||(f=h.createIIRFilter(a,r)),o.set(h,d===null?f:d),d!==null){if(c===null){if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");const g=new t(u.context.destination.channelCount,u.context.length,h.sampleRate);c=(async()=>{await n(u,g,g.destination);const y=await i(g);return vu(y,h,r,a)})()}const m=await c;return d.buffer=m,d.start(0),d}return await n(u,h,f),f};return{render(u,h){const d=o.get(h);return d!==void 0?Promise.resolve(d):l(u,h)}}},bu=(s,e,t,n,i,r)=>a=>(o,c)=>{const l=s.get(o);if(l===void 0){if(!a&&r(o)){const u=n(o),{outputs:h}=t(o);for(const d of h)if(ss(d)){const f=n(d[0]);e(u,f,d[1],d[2])}else{const f=i(d[0]);u.disconnect(f,d[1])}}s.set(o,c)}else s.set(o,l+c)},Tu=(s,e)=>t=>{const n=s.get(t);return e(n)||e(t)},xu=(s,e)=>t=>s.has(t)||e(t),Su=(s,e)=>t=>s.has(t)||e(t),Cu=(s,e)=>t=>{const n=s.get(t);return e(n)||e(t)},ku=s=>e=>s!==null&&e instanceof s,Au=s=>e=>s!==null&&typeof s.AudioNode=="function"&&e instanceof s.AudioNode,Nu=s=>e=>s!==null&&typeof s.AudioParam=="function"&&e instanceof s.AudioParam,Ou=(s,e)=>t=>s(t)||e(t),Du=s=>e=>s!==null&&e instanceof s,Eu=s=>s!==null&&s.isSecureContext,Mu=(s,e,t,n)=>class extends s{constructor(r,a){const o=t(r),c=e(o,a);if(n(o))throw TypeError();super(r,!0,c,null),this._nativeMediaElementAudioSourceNode=c}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},Iu={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},Ru=(s,e,t,n)=>class extends s{constructor(r,a){const o=t(r);if(n(o))throw new TypeError;const c={...Iu,...a},l=e(o,c);super(r,!1,l,null),this._nativeMediaStreamAudioDestinationNode=l}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},Vu=(s,e,t,n)=>class extends s{constructor(r,a){const o=t(r),c=e(o,a);if(n(o))throw new TypeError;super(r,!0,c,null),this._nativeMediaStreamAudioSourceNode=c}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},Fu=(s,e,t)=>class extends s{constructor(i,r){const a=t(i),o=e(a,r);super(i,!0,o,null)}},Pu=(s,e,t,n,i,r)=>class extends t{constructor(o,c){super(o),this._nativeContext=o,ti.set(this,o),n(o)&&i.set(o,new Set),this._destination=new s(this,c),this._listener=e(this,o),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(o){const c=typeof o=="function"?r(this,o):null;this._nativeContext.onstatechange=c;const l=this._nativeContext.onstatechange;this._onstatechange=l!==null&&l===c?o:l}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},Fn=s=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const t=s.decodeAudioData(e.buffer,()=>{});return t===void 0?!1:(t.catch(()=>{}),!0)}catch{}return!1},qu=(s,e)=>(t,n,i)=>{const r=new Set;return t.connect=(a=>(o,c=0,l=0)=>{const u=r.size===0;if(e(o))return a.call(t,o,c,l),s(r,[o,c,l],h=>h[0]===o&&h[1]===c&&h[2]===l,!0),u&&n(),o;a.call(t,o,c),s(r,[o,c],h=>h[0]===o&&h[1]===c,!0),u&&n()})(t.connect),t.disconnect=(a=>(o,c,l)=>{const u=r.size>0;if(o===void 0)a.apply(t),r.clear();else if(typeof o=="number"){a.call(t,o);for(const d of r)d[1]===o&&r.delete(d)}else{e(o)?a.call(t,o,c,l):a.call(t,o,c);for(const d of r)d[0]===o&&(c===void 0||d[1]===c)&&(l===void 0||d[2]===l)&&r.delete(d)}const h=r.size===0;u&&h&&i()})(t.disconnect),t},re=(s,e,t)=>{const n=e[t];n!==void 0&&n!==s[t]&&(s[t]=n)},ge=(s,e)=>{re(s,e,"channelCount"),re(s,e,"channelCountMode"),re(s,e,"channelInterpretation")},Er=s=>typeof s.getFloatTimeDomainData=="function",Lu=s=>{s.getFloatTimeDomainData=e=>{const t=new Uint8Array(e.length);s.getByteTimeDomainData(t);const n=Math.max(t.length,s.fftSize);for(let i=0;i<n;i+=1)e[i]=(t[i]-128)*.0078125;return e}},Wu=(s,e)=>(t,n)=>{const i=t.createAnalyser();if(ge(i,n),!(n.maxDecibels>n.minDecibels))throw e();return re(i,n,"fftSize"),re(i,n,"maxDecibels"),re(i,n,"minDecibels"),re(i,n,"smoothingTimeConstant"),s(Er,()=>Er(i))||Lu(i),i},ju=s=>s===null?null:s.hasOwnProperty("AudioBuffer")?s.AudioBuffer:null,ue=(s,e,t)=>{const n=e[t];n!==void 0&&n!==s[t].value&&(s[t].value=n)},Bu=s=>{s.start=(e=>{let t=!1;return(n=0,i=0,r)=>{if(t)throw ve();e.call(s,n,i,r),t=!0}})(s.start)},Bi=s=>{s.start=(e=>(t=0,n=0,i)=>{if(typeof i=="number"&&i<0||n<0||t<0)throw new RangeError("The parameters can't be negative.");e.call(s,t,n,i)})(s.start)},$i=s=>{s.stop=(e=>(t=0)=>{if(t<0)throw new RangeError("The parameter can't be negative.");e.call(s,t)})(s.stop)},$u=(s,e,t,n,i,r,a,o,c,l,u)=>(h,d)=>{const f=h.createBufferSource();return ge(f,d),ue(f,d,"playbackRate"),re(f,d,"buffer"),re(f,d,"loop"),re(f,d,"loopEnd"),re(f,d,"loopStart"),e(t,()=>t(h))||Bu(f),e(n,()=>n(h))||c(f),e(i,()=>i(h))||l(f,h),e(r,()=>r(h))||Bi(f),e(a,()=>a(h))||u(f,h),e(o,()=>o(h))||$i(f),s(h,f),f},Uu=s=>s===null?null:s.hasOwnProperty("AudioContext")?s.AudioContext:s.hasOwnProperty("webkitAudioContext")?s.webkitAudioContext:null,Gu=(s,e)=>(t,n,i)=>{const r=t.destination;if(r.channelCount!==n)try{r.channelCount=n}catch{}i&&r.channelCountMode!=="explicit"&&(r.channelCountMode="explicit"),r.maxChannelCount===0&&Object.defineProperty(r,"maxChannelCount",{value:n});const a=s(t,{channelCount:n,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,gain:1});return e(a,"channelCount",o=>()=>o.call(a),o=>c=>{o.call(a,c);try{r.channelCount=c}catch(l){if(c>r.maxChannelCount)throw l}}),e(a,"channelCountMode",o=>()=>o.call(a),o=>c=>{o.call(a,c),r.channelCountMode=c}),e(a,"channelInterpretation",o=>()=>o.call(a),o=>c=>{o.call(a,c),r.channelInterpretation=c}),Object.defineProperty(a,"maxChannelCount",{get:()=>r.maxChannelCount}),a.connect(r),a},zu=s=>s===null?null:s.hasOwnProperty("AudioWorkletNode")?s.AudioWorkletNode:null,Zu=s=>{const{port1:e}=new MessageChannel;try{e.postMessage(s)}finally{e.close()}},Xu=(s,e,t,n,i)=>(r,a,o,c,l,u)=>{if(o!==null)try{const h=new o(r,c,u),d=new Map;let f=null;if(Object.defineProperties(h,{channelCount:{get:()=>u.channelCount,set:()=>{throw s()}},channelCountMode:{get:()=>"explicit",set:()=>{throw s()}},onprocessorerror:{get:()=>f,set:p=>{typeof f=="function"&&h.removeEventListener("processorerror",f),f=typeof p=="function"?p:null,typeof f=="function"&&h.addEventListener("processorerror",f)}}}),h.addEventListener=(p=>(...m)=>{if(m[0]==="processorerror"){const g=typeof m[1]=="function"?m[1]:typeof m[1]=="object"&&m[1]!==null&&typeof m[1].handleEvent=="function"?m[1].handleEvent:null;if(g!==null){const y=d.get(m[1]);y!==void 0?m[1]=y:(m[1]=T=>{T.type==="error"?(Object.defineProperties(T,{type:{value:"processorerror"}}),g(T)):g(new ErrorEvent(m[0],{...T}))},d.set(g,m[1]))}}return p.call(h,"error",m[1],m[2]),p.call(h,...m)})(h.addEventListener),h.removeEventListener=(p=>(...m)=>{if(m[0]==="processorerror"){const g=d.get(m[1]);g!==void 0&&(d.delete(m[1]),m[1]=g)}return p.call(h,"error",m[1],m[2]),p.call(h,m[0],m[1],m[2])})(h.removeEventListener),u.numberOfOutputs!==0){const p=t(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return h.connect(p).connect(r.destination),i(h,()=>p.disconnect(),()=>p.connect(r.destination))}return h}catch(h){throw h.code===11?n():h}if(l===void 0)throw n();return Zu(u),e(r,a,l,u)},vo=(s,e)=>s===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(s*e))))),Hu=s=>new Promise((e,t)=>{const{port1:n,port2:i}=new MessageChannel;n.onmessage=({data:r})=>{n.close(),i.close(),e(r)},n.onmessageerror=({data:r})=>{n.close(),i.close(),t(r)},i.postMessage(s)}),Yu=async(s,e)=>{const t=await Hu(e);return new s(t)},Qu=(s,e,t,n)=>{let i=ki.get(s);i===void 0&&(i=new WeakMap,ki.set(s,i));const r=Yu(t,n);return i.set(e,r),r},Ju=(s,e,t,n,i,r,a,o,c,l,u,h,d)=>(f,p,m,g)=>{if(g.numberOfInputs===0&&g.numberOfOutputs===0)throw c();const y=Array.isArray(g.outputChannelCount)?g.outputChannelCount:Array.from(g.outputChannelCount);if(y.some(D=>D<1))throw c();if(y.length!==g.numberOfOutputs)throw e();if(g.channelCountMode!=="explicit")throw c();const T=g.channelCount*g.numberOfInputs,x=y.reduce((D,W)=>D+W,0),C=m.parameterDescriptors===void 0?0:m.parameterDescriptors.length;if(T+C>6||x>6)throw c();const _=new MessageChannel,w=[],b=[];for(let D=0;D<g.numberOfInputs;D+=1)w.push(a(f,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1})),b.push(i(f,{channelCount:g.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:g.channelCount}));const v=[];if(m.parameterDescriptors!==void 0)for(const{defaultValue:D,maxValue:W,minValue:fe,name:oe}of m.parameterDescriptors){const H=r(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:g.parameterData[oe]!==void 0?g.parameterData[oe]:D===void 0?0:D});Object.defineProperties(H.offset,{defaultValue:{get:()=>D===void 0?0:D},maxValue:{get:()=>W===void 0?Ae:W},minValue:{get:()=>fe===void 0?De:fe}}),v.push(H)}const O=n(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,T+C)}),N=vo(p,f.sampleRate),A=o(f,N,T+C,Math.max(1,x)),k=i(f,{channelCount:Math.max(1,x),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,x)}),M=[];for(let D=0;D<g.numberOfOutputs;D+=1)M.push(n(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:y[D]}));for(let D=0;D<g.numberOfInputs;D+=1){w[D].connect(b[D]);for(let W=0;W<g.channelCount;W+=1)b[D].connect(O,W,D*g.channelCount+W)}const E=new go(m.parameterDescriptors===void 0?[]:m.parameterDescriptors.map(({name:D},W)=>{const fe=v[W];return fe.connect(O,0,T+W),fe.start(0),[D,fe.offset]}));O.connect(A);let P=g.channelInterpretation,R=null;const V=g.numberOfOutputs===0?[A]:M,$={get bufferSize(){return N},get channelCount(){return g.channelCount},set channelCount(D){throw t()},get channelCountMode(){return g.channelCountMode},set channelCountMode(D){throw t()},get channelInterpretation(){return P},set channelInterpretation(D){for(const W of w)W.channelInterpretation=D;P=D},get context(){return A.context},get inputs(){return w},get numberOfInputs(){return g.numberOfInputs},get numberOfOutputs(){return g.numberOfOutputs},get onprocessorerror(){return R},set onprocessorerror(D){typeof R=="function"&&$.removeEventListener("processorerror",R),R=typeof D=="function"?D:null,typeof R=="function"&&$.addEventListener("processorerror",R)},get parameters(){return E},get port(){return _.port2},addEventListener(...D){return A.addEventListener(D[0],D[1],D[2])},connect:s.bind(null,V),disconnect:l.bind(null,V),dispatchEvent(...D){return A.dispatchEvent(D[0])},removeEventListener(...D){return A.removeEventListener(D[0],D[1],D[2])}},q=new Map;_.port1.addEventListener=(D=>(...W)=>{if(W[0]==="message"){const fe=typeof W[1]=="function"?W[1]:typeof W[1]=="object"&&W[1]!==null&&typeof W[1].handleEvent=="function"?W[1].handleEvent:null;if(fe!==null){const oe=q.get(W[1]);oe!==void 0?W[1]=oe:(W[1]=H=>{u(f.currentTime,f.sampleRate,()=>fe(H))},q.set(fe,W[1]))}}return D.call(_.port1,W[0],W[1],W[2])})(_.port1.addEventListener),_.port1.removeEventListener=(D=>(...W)=>{if(W[0]==="message"){const fe=q.get(W[1]);fe!==void 0&&(q.delete(W[1]),W[1]=fe)}return D.call(_.port1,W[0],W[1],W[2])})(_.port1.removeEventListener);let B=null;Object.defineProperty(_.port1,"onmessage",{get:()=>B,set:D=>{typeof B=="function"&&_.port1.removeEventListener("message",B),B=typeof D=="function"?D:null,typeof B=="function"&&(_.port1.addEventListener("message",B),_.port1.start())}}),m.prototype.port=_.port1;let j=null;Qu(f,$,m,g).then(D=>j=D);const Re=Ds(g.numberOfInputs,g.channelCount),Ve=Ds(g.numberOfOutputs,y),U=m.parameterDescriptors===void 0?[]:m.parameterDescriptors.reduce((D,{name:W})=>({...D,[W]:new Float32Array(128)}),{});let se=!0;const ke=()=>{g.numberOfOutputs>0&&A.disconnect(k);for(let D=0,W=0;D<g.numberOfOutputs;D+=1){const fe=M[D];for(let oe=0;oe<y[D];oe+=1)k.disconnect(fe,W+oe,oe);W+=y[D]}},F=new Map;A.onaudioprocess=({inputBuffer:D,outputBuffer:W})=>{if(j!==null){const fe=h($);for(let oe=0;oe<N;oe+=128){for(let H=0;H<g.numberOfInputs;H+=1)for(let le=0;le<g.channelCount;le+=1)Os(D,Re[H],le,le,oe);m.parameterDescriptors!==void 0&&m.parameterDescriptors.forEach(({name:H},le)=>{Os(D,U,H,T+le,oe)});for(let H=0;H<g.numberOfInputs;H+=1)for(let le=0;le<y[H];le+=1)Ve[H][le].byteLength===0&&(Ve[H][le]=new Float32Array(128));try{const H=Re.map((Le,xt)=>{if(fe[xt].size>0)return F.set(xt,N/128),Le;const pi=F.get(xt);return pi===void 0?[]:(Le.every(Ya=>Ya.every(Qa=>Qa===0))&&(pi===1?F.delete(xt):F.set(xt,pi-1)),Le)});se=u(f.currentTime+oe/f.sampleRate,f.sampleRate,()=>j.process(H,Ve,U));for(let Le=0,xt=0;Le<g.numberOfOutputs;Le+=1){for(let En=0;En<y[Le];En+=1)_o(W,Ve[Le],En,xt+En,oe);xt+=y[Le]}}catch(H){se=!1,$.dispatchEvent(new ErrorEvent("processorerror",{colno:H.colno,filename:H.filename,lineno:H.lineno,message:H.message}))}if(!se){for(let H=0;H<g.numberOfInputs;H+=1){w[H].disconnect(b[H]);for(let le=0;le<g.channelCount;le+=1)b[oe].disconnect(O,le,H*g.channelCount+le)}if(m.parameterDescriptors!==void 0){const H=m.parameterDescriptors.length;for(let le=0;le<H;le+=1){const Le=v[le];Le.disconnect(O,0,T+le),Le.stop()}}O.disconnect(A),A.onaudioprocess=null,Vt?ke():nn();break}}}};let Vt=!1;const Ft=a(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),tn=()=>A.connect(Ft).connect(f.destination),nn=()=>{A.disconnect(Ft),Ft.disconnect()},Xa=()=>{if(se){nn(),g.numberOfOutputs>0&&A.connect(k);for(let D=0,W=0;D<g.numberOfOutputs;D+=1){const fe=M[D];for(let oe=0;oe<y[D];oe+=1)k.connect(fe,W+oe,oe);W+=y[D]}}Vt=!0},Ha=()=>{se&&(tn(),ke()),Vt=!1};return tn(),d($,Xa,Ha)},wo=(s,e)=>{const t=s.createBiquadFilter();return ge(t,e),ue(t,e,"Q"),ue(t,e,"detune"),ue(t,e,"frequency"),ue(t,e,"gain"),re(t,e,"type"),t},Ku=(s,e)=>(t,n)=>{const i=t.createChannelMerger(n.numberOfInputs);return s!==null&&s.name==="webkitAudioContext"&&e(t,i),ge(i,n),i},eh=s=>{const e=s.numberOfOutputs;Object.defineProperty(s,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw ve()}}),Object.defineProperty(s,"channelCountMode",{get:()=>"explicit",set:t=>{if(t!=="explicit")throw ve()}}),Object.defineProperty(s,"channelInterpretation",{get:()=>"discrete",set:t=>{if(t!=="discrete")throw ve()}})},is=(s,e)=>{const t=s.createChannelSplitter(e.numberOfOutputs);return ge(t,e),eh(t),t},th=(s,e,t,n,i)=>(r,a)=>{if(r.createConstantSource===void 0)return t(r,a);const o=r.createConstantSource();return ge(o,a),ue(o,a,"offset"),e(n,()=>n(r))||Bi(o),e(i,()=>i(r))||$i(o),s(r,o),o},kn=(s,e)=>(s.connect=e.connect.bind(e),s.disconnect=e.disconnect.bind(e),s),nh=(s,e,t,n)=>(i,{offset:r,...a})=>{const o=i.createBuffer(1,2,44100),c=e(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),l=t(i,{...a,gain:r}),u=o.getChannelData(0);u[0]=1,u[1]=1,c.buffer=o,c.loop=!0;const h={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(p){l.channelCount=p},get channelCountMode(){return l.channelCountMode},set channelCountMode(p){l.channelCountMode=p},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(p){l.channelInterpretation=p},get context(){return l.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get offset(){return l.gain},get onended(){return c.onended},set onended(p){c.onended=p},addEventListener(...p){return c.addEventListener(p[0],p[1],p[2])},dispatchEvent(...p){return c.dispatchEvent(p[0])},removeEventListener(...p){return c.removeEventListener(p[0],p[1],p[2])},start(p=0){c.start.call(c,p)},stop(p=0){c.stop.call(c,p)}},d=()=>c.connect(l),f=()=>c.disconnect(l);return s(i,c),n(kn(h,l),d,f)},sh=(s,e)=>(t,n)=>{const i=t.createConvolver();if(ge(i,n),n.disableNormalization===i.normalize&&(i.normalize=!n.disableNormalization),re(i,n,"buffer"),n.channelCount>2||(e(i,"channelCount",r=>()=>r.call(i),r=>a=>{if(a>2)throw s();return r.call(i,a)}),n.channelCountMode==="max"))throw s();return e(i,"channelCountMode",r=>()=>r.call(i),r=>a=>{if(a==="max")throw s();return r.call(i,a)}),i},bo=(s,e)=>{const t=s.createDelay(e.maxDelayTime);return ge(t,e),ue(t,e,"delayTime"),t},ih=s=>(e,t)=>{const n=e.createDynamicsCompressor();if(ge(n,t),t.channelCount>2||t.channelCountMode==="max")throw s();return ue(n,t,"attack"),ue(n,t,"knee"),ue(n,t,"ratio"),ue(n,t,"release"),ue(n,t,"threshold"),n},Me=(s,e)=>{const t=s.createGain();return ge(t,e),ue(t,e,"gain"),t},rh=s=>(e,t,n)=>{if(e.createIIRFilter===void 0)return s(e,t,n);const i=e.createIIRFilter(n.feedforward,n.feedback);return ge(i,n),i};function oh(s,e){const t=e[0]*e[0]+e[1]*e[1];return[(s[0]*e[0]+s[1]*e[1])/t,(s[1]*e[0]-s[0]*e[1])/t]}function ah(s,e){return[s[0]*e[0]-s[1]*e[1],s[0]*e[1]+s[1]*e[0]]}function Mr(s,e){let t=[0,0];for(let n=s.length-1;n>=0;n-=1)t=ah(t,e),t[0]+=s[n];return t}const ch=(s,e,t,n)=>(i,r,{channelCount:a,channelCountMode:o,channelInterpretation:c,feedback:l,feedforward:u})=>{const h=vo(r,i.sampleRate),d=l instanceof Float64Array?l:new Float64Array(l),f=u instanceof Float64Array?u:new Float64Array(u),p=d.length,m=f.length,g=Math.min(p,m);if(p===0||p>20)throw n();if(d[0]===0)throw e();if(m===0||m>20)throw n();if(f[0]===0)throw e();if(d[0]!==1){for(let v=0;v<m;v+=1)f[v]/=d[0];for(let v=1;v<p;v+=1)d[v]/=d[0]}const y=t(i,h,a,a);y.channelCount=a,y.channelCountMode=o,y.channelInterpretation=c;const T=32,x=[],C=[],_=[];for(let v=0;v<a;v+=1){x.push(0);const O=new Float32Array(T),N=new Float32Array(T);O.fill(0),N.fill(0),C.push(O),_.push(N)}y.onaudioprocess=v=>{const O=v.inputBuffer,N=v.outputBuffer,A=O.numberOfChannels;for(let k=0;k<A;k+=1){const M=O.getChannelData(k),E=N.getChannelData(k);x[k]=yo(d,p,f,m,g,C[k],_[k],x[k],T,M,E)}};const w=i.sampleRate/2;return kn({get bufferSize(){return h},get channelCount(){return y.channelCount},set channelCount(v){y.channelCount=v},get channelCountMode(){return y.channelCountMode},set channelCountMode(v){y.channelCountMode=v},get channelInterpretation(){return y.channelInterpretation},set channelInterpretation(v){y.channelInterpretation=v},get context(){return y.context},get inputs(){return[y]},get numberOfInputs(){return y.numberOfInputs},get numberOfOutputs(){return y.numberOfOutputs},addEventListener(...v){return y.addEventListener(v[0],v[1],v[2])},dispatchEvent(...v){return y.dispatchEvent(v[0])},getFrequencyResponse(v,O,N){if(v.length!==O.length||O.length!==N.length)throw s();const A=v.length;for(let k=0;k<A;k+=1){const M=-Math.PI*(v[k]/w),E=[Math.cos(M),Math.sin(M)],P=Mr(f,E),R=Mr(d,E),V=oh(P,R);O[k]=Math.sqrt(V[0]*V[0]+V[1]*V[1]),N[k]=Math.atan2(V[1],V[0])}},removeEventListener(...v){return y.removeEventListener(v[0],v[1],v[2])}},y)},lh=(s,e)=>s.createMediaElementSource(e.mediaElement),uh=(s,e)=>{const t=s.createMediaStreamDestination();return ge(t,e),t.numberOfOutputs===1&&Object.defineProperty(t,"numberOfOutputs",{get:()=>0}),t},hh=(s,{mediaStream:e})=>{const t=e.getAudioTracks();t.sort((r,a)=>r.id<a.id?-1:r.id>a.id?1:0);const n=t.slice(0,1),i=s.createMediaStreamSource(new MediaStream(n));return Object.defineProperty(i,"mediaStream",{value:e}),i},dh=(s,e)=>(t,{mediaStreamTrack:n})=>{if(typeof t.createMediaStreamTrackSource=="function")return t.createMediaStreamTrackSource(n);const i=new MediaStream([n]),r=t.createMediaStreamSource(i);if(n.kind!=="audio")throw s();if(e(t))throw new TypeError;return r},ph=s=>s===null?null:s.hasOwnProperty("OfflineAudioContext")?s.OfflineAudioContext:s.hasOwnProperty("webkitOfflineAudioContext")?s.webkitOfflineAudioContext:null,fh=(s,e,t,n,i,r)=>(a,o)=>{const c=a.createOscillator();return ge(c,o),ue(c,o,"detune"),ue(c,o,"frequency"),o.periodicWave!==void 0?c.setPeriodicWave(o.periodicWave):re(c,o,"type"),e(t,()=>t(a))||Bi(c),e(n,()=>n(a))||r(c,a),e(i,()=>i(a))||$i(c),s(a,c),c},mh=s=>(e,t)=>{const n=e.createPanner();return n.orientationX===void 0?s(e,t):(ge(n,t),ue(n,t,"orientationX"),ue(n,t,"orientationY"),ue(n,t,"orientationZ"),ue(n,t,"positionX"),ue(n,t,"positionY"),ue(n,t,"positionZ"),re(n,t,"coneInnerAngle"),re(n,t,"coneOuterAngle"),re(n,t,"coneOuterGain"),re(n,t,"distanceModel"),re(n,t,"maxDistance"),re(n,t,"panningModel"),re(n,t,"refDistance"),re(n,t,"rolloffFactor"),n)},gh=(s,e,t,n,i,r,a,o,c,l)=>(u,{coneInnerAngle:h,coneOuterAngle:d,coneOuterGain:f,distanceModel:p,maxDistance:m,orientationX:g,orientationY:y,orientationZ:T,panningModel:x,positionX:C,positionY:_,positionZ:w,refDistance:b,rolloffFactor:v,...O})=>{const N=u.createPanner();if(O.channelCount>2||O.channelCountMode==="max")throw a();ge(N,O);const A={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},k=t(u,{...A,channelInterpretation:"speakers",numberOfInputs:6}),M=n(u,{...O,gain:1}),E=n(u,{...A,gain:1}),P=n(u,{...A,gain:0}),R=n(u,{...A,gain:0}),V=n(u,{...A,gain:0}),$=n(u,{...A,gain:0}),q=n(u,{...A,gain:0}),B=i(u,256,6,1),j=r(u,{...A,curve:new Float32Array([1,1]),oversample:"none"});let K=[g,y,T],Re=[C,_,w];const Ve=new Float32Array(1);B.onaudioprocess=({inputBuffer:F})=>{const Vt=[c(F,Ve,0),c(F,Ve,1),c(F,Ve,2)];Vt.some((tn,nn)=>tn!==K[nn])&&(N.setOrientation(...Vt),K=Vt);const Ft=[c(F,Ve,3),c(F,Ve,4),c(F,Ve,5)];Ft.some((tn,nn)=>tn!==Re[nn])&&(N.setPosition(...Ft),Re=Ft)},Object.defineProperty(P.gain,"defaultValue",{get:()=>0}),Object.defineProperty(R.gain,"defaultValue",{get:()=>0}),Object.defineProperty(V.gain,"defaultValue",{get:()=>0}),Object.defineProperty($.gain,"defaultValue",{get:()=>0}),Object.defineProperty(q.gain,"defaultValue",{get:()=>0});const U={get bufferSize(){},get channelCount(){return N.channelCount},set channelCount(F){if(F>2)throw a();M.channelCount=F,N.channelCount=F},get channelCountMode(){return N.channelCountMode},set channelCountMode(F){if(F==="max")throw a();M.channelCountMode=F,N.channelCountMode=F},get channelInterpretation(){return N.channelInterpretation},set channelInterpretation(F){M.channelInterpretation=F,N.channelInterpretation=F},get coneInnerAngle(){return N.coneInnerAngle},set coneInnerAngle(F){N.coneInnerAngle=F},get coneOuterAngle(){return N.coneOuterAngle},set coneOuterAngle(F){N.coneOuterAngle=F},get coneOuterGain(){return N.coneOuterGain},set coneOuterGain(F){if(F<0||F>1)throw e();N.coneOuterGain=F},get context(){return N.context},get distanceModel(){return N.distanceModel},set distanceModel(F){N.distanceModel=F},get inputs(){return[M]},get maxDistance(){return N.maxDistance},set maxDistance(F){if(F<0)throw new RangeError;N.maxDistance=F},get numberOfInputs(){return N.numberOfInputs},get numberOfOutputs(){return N.numberOfOutputs},get orientationX(){return E.gain},get orientationY(){return P.gain},get orientationZ(){return R.gain},get panningModel(){return N.panningModel},set panningModel(F){N.panningModel=F},get positionX(){return V.gain},get positionY(){return $.gain},get positionZ(){return q.gain},get refDistance(){return N.refDistance},set refDistance(F){if(F<0)throw new RangeError;N.refDistance=F},get rolloffFactor(){return N.rolloffFactor},set rolloffFactor(F){if(F<0)throw new RangeError;N.rolloffFactor=F},addEventListener(...F){return M.addEventListener(F[0],F[1],F[2])},dispatchEvent(...F){return M.dispatchEvent(F[0])},removeEventListener(...F){return M.removeEventListener(F[0],F[1],F[2])}};h!==U.coneInnerAngle&&(U.coneInnerAngle=h),d!==U.coneOuterAngle&&(U.coneOuterAngle=d),f!==U.coneOuterGain&&(U.coneOuterGain=f),p!==U.distanceModel&&(U.distanceModel=p),m!==U.maxDistance&&(U.maxDistance=m),g!==U.orientationX.value&&(U.orientationX.value=g),y!==U.orientationY.value&&(U.orientationY.value=y),T!==U.orientationZ.value&&(U.orientationZ.value=T),x!==U.panningModel&&(U.panningModel=x),C!==U.positionX.value&&(U.positionX.value=C),_!==U.positionY.value&&(U.positionY.value=_),w!==U.positionZ.value&&(U.positionZ.value=w),b!==U.refDistance&&(U.refDistance=b),v!==U.rolloffFactor&&(U.rolloffFactor=v),(K[0]!==1||K[1]!==0||K[2]!==0)&&N.setOrientation(...K),(Re[0]!==0||Re[1]!==0||Re[2]!==0)&&N.setPosition(...Re);const se=()=>{M.connect(N),s(M,j,0,0),j.connect(E).connect(k,0,0),j.connect(P).connect(k,0,1),j.connect(R).connect(k,0,2),j.connect(V).connect(k,0,3),j.connect($).connect(k,0,4),j.connect(q).connect(k,0,5),k.connect(B).connect(u.destination)},ke=()=>{M.disconnect(N),o(M,j,0,0),j.disconnect(E),E.disconnect(k),j.disconnect(P),P.disconnect(k),j.disconnect(R),R.disconnect(k),j.disconnect(V),V.disconnect(k),j.disconnect($),$.disconnect(k),j.disconnect(q),q.disconnect(k),k.disconnect(B),B.disconnect(u.destination)};return l(kn(U,N),se,ke)},_h=s=>(e,{disableNormalization:t,imag:n,real:i})=>{const r=n instanceof Float32Array?n:new Float32Array(n),a=i instanceof Float32Array?i:new Float32Array(i),o=e.createPeriodicWave(a,r,{disableNormalization:t});if(Array.from(n).length<2)throw s();return o},rs=(s,e,t,n)=>s.createScriptProcessor(e,t,n),yh=(s,e)=>(t,n)=>{const i=n.channelCountMode;if(i==="clamped-max")throw e();if(t.createStereoPanner===void 0)return s(t,n);const r=t.createStereoPanner();return ge(r,n),ue(r,n,"pan"),Object.defineProperty(r,"channelCountMode",{get:()=>i,set:a=>{if(a!==i)throw e()}}),r},vh=(s,e,t,n,i,r)=>{const o=new Float32Array([1,1]),c=Math.PI/2,l={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...l,oversample:"none"},h=(p,m,g,y)=>{const T=new Float32Array(16385),x=new Float32Array(16385);for(let O=0;O<16385;O+=1){const N=O/16384*c;T[O]=Math.cos(N),x[O]=Math.sin(N)}const C=t(p,{...l,gain:0}),_=n(p,{...u,curve:T}),w=n(p,{...u,curve:o}),b=t(p,{...l,gain:0}),v=n(p,{...u,curve:x});return{connectGraph(){m.connect(C),m.connect(w.inputs===void 0?w:w.inputs[0]),m.connect(b),w.connect(g),g.connect(_.inputs===void 0?_:_.inputs[0]),g.connect(v.inputs===void 0?v:v.inputs[0]),_.connect(C.gain),v.connect(b.gain),C.connect(y,0,0),b.connect(y,0,1)},disconnectGraph(){m.disconnect(C),m.disconnect(w.inputs===void 0?w:w.inputs[0]),m.disconnect(b),w.disconnect(g),g.disconnect(_.inputs===void 0?_:_.inputs[0]),g.disconnect(v.inputs===void 0?v:v.inputs[0]),_.disconnect(C.gain),v.disconnect(b.gain),C.disconnect(y,0,0),b.disconnect(y,0,1)}}},d=(p,m,g,y)=>{const T=new Float32Array(16385),x=new Float32Array(16385),C=new Float32Array(16385),_=new Float32Array(16385),w=Math.floor(16385/2);for(let V=0;V<16385;V+=1)if(V>w){const $=(V-w)/(16384-w)*c;T[V]=Math.cos($),x[V]=Math.sin($),C[V]=0,_[V]=1}else{const $=V/(16384-w)*c;T[V]=1,x[V]=0,C[V]=Math.cos($),_[V]=Math.sin($)}const b=e(p,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),v=t(p,{...l,gain:0}),O=n(p,{...u,curve:T}),N=t(p,{...l,gain:0}),A=n(p,{...u,curve:x}),k=n(p,{...u,curve:o}),M=t(p,{...l,gain:0}),E=n(p,{...u,curve:C}),P=t(p,{...l,gain:0}),R=n(p,{...u,curve:_});return{connectGraph(){m.connect(b),m.connect(k.inputs===void 0?k:k.inputs[0]),b.connect(v,0),b.connect(N,0),b.connect(M,1),b.connect(P,1),k.connect(g),g.connect(O.inputs===void 0?O:O.inputs[0]),g.connect(A.inputs===void 0?A:A.inputs[0]),g.connect(E.inputs===void 0?E:E.inputs[0]),g.connect(R.inputs===void 0?R:R.inputs[0]),O.connect(v.gain),A.connect(N.gain),E.connect(M.gain),R.connect(P.gain),v.connect(y,0,0),M.connect(y,0,0),N.connect(y,0,1),P.connect(y,0,1)},disconnectGraph(){m.disconnect(b),m.disconnect(k.inputs===void 0?k:k.inputs[0]),b.disconnect(v,0),b.disconnect(N,0),b.disconnect(M,1),b.disconnect(P,1),k.disconnect(g),g.disconnect(O.inputs===void 0?O:O.inputs[0]),g.disconnect(A.inputs===void 0?A:A.inputs[0]),g.disconnect(E.inputs===void 0?E:E.inputs[0]),g.disconnect(R.inputs===void 0?R:R.inputs[0]),O.disconnect(v.gain),A.disconnect(N.gain),E.disconnect(M.gain),R.disconnect(P.gain),v.disconnect(y,0,0),M.disconnect(y,0,0),N.disconnect(y,0,1),P.disconnect(y,0,1)}}},f=(p,m,g,y,T)=>{if(m===1)return h(p,g,y,T);if(m===2)return d(p,g,y,T);throw i()};return(p,{channelCount:m,channelCountMode:g,pan:y,...T})=>{if(g==="max")throw i();const x=s(p,{...T,channelCount:1,channelCountMode:g,numberOfInputs:2}),C=t(p,{...T,channelCount:m,channelCountMode:g,gain:1}),_=t(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:y});let{connectGraph:w,disconnectGraph:b}=f(p,m,C,_,x);Object.defineProperty(_.gain,"defaultValue",{get:()=>0}),Object.defineProperty(_.gain,"maxValue",{get:()=>1}),Object.defineProperty(_.gain,"minValue",{get:()=>-1});const v={get bufferSize(){},get channelCount(){return C.channelCount},set channelCount(k){C.channelCount!==k&&(O&&b(),{connectGraph:w,disconnectGraph:b}=f(p,k,C,_,x),O&&w()),C.channelCount=k},get channelCountMode(){return C.channelCountMode},set channelCountMode(k){if(k==="clamped-max"||k==="max")throw i();C.channelCountMode=k},get channelInterpretation(){return C.channelInterpretation},set channelInterpretation(k){C.channelInterpretation=k},get context(){return C.context},get inputs(){return[C]},get numberOfInputs(){return C.numberOfInputs},get numberOfOutputs(){return C.numberOfOutputs},get pan(){return _.gain},addEventListener(...k){return C.addEventListener(k[0],k[1],k[2])},dispatchEvent(...k){return C.dispatchEvent(k[0])},removeEventListener(...k){return C.removeEventListener(k[0],k[1],k[2])}};let O=!1;const N=()=>{w(),O=!0},A=()=>{b(),O=!1};return r(kn(v,x),N,A)}},wh=(s,e,t,n,i,r,a)=>(o,c)=>{const l=o.createWaveShaper();if(r!==null&&r.name==="webkitAudioContext"&&o.createGain().gain.automationRate===void 0)return t(o,c);ge(l,c);const u=c.curve===null||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(u!==null&&u.length<2)throw e();re(l,{curve:u},"curve"),re(l,c,"oversample");let h=null,d=!1;return a(l,"curve",m=>()=>m.call(l),m=>g=>(m.call(l,g),d&&(n(g)&&h===null?h=s(o,l):!n(g)&&h!==null&&(h(),h=null)),g)),i(l,()=>{d=!0,n(l.curve)&&(h=s(o,l))},()=>{d=!1,h!==null&&(h(),h=null)})},bh=(s,e,t,n,i)=>(r,{curve:a,oversample:o,...c})=>{const l=r.createWaveShaper(),u=r.createWaveShaper();ge(l,c),ge(u,c);const h=t(r,{...c,gain:1}),d=t(r,{...c,gain:-1}),f=t(r,{...c,gain:1}),p=t(r,{...c,gain:-1});let m=null,g=!1,y=null;const T={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(_){h.channelCount=_,d.channelCount=_,l.channelCount=_,f.channelCount=_,u.channelCount=_,p.channelCount=_},get channelCountMode(){return l.channelCountMode},set channelCountMode(_){h.channelCountMode=_,d.channelCountMode=_,l.channelCountMode=_,f.channelCountMode=_,u.channelCountMode=_,p.channelCountMode=_},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(_){h.channelInterpretation=_,d.channelInterpretation=_,l.channelInterpretation=_,f.channelInterpretation=_,u.channelInterpretation=_,p.channelInterpretation=_},get context(){return l.context},get curve(){return y},set curve(_){if(_!==null&&_.length<2)throw e();if(_===null)l.curve=_,u.curve=_;else{const w=_.length,b=new Float32Array(w+2-w%2),v=new Float32Array(w+2-w%2);b[0]=_[0],v[0]=-_[w-1];const O=Math.ceil((w+1)/2),N=(w+1)/2-1;for(let A=1;A<O;A+=1){const k=A/O*N,M=Math.floor(k),E=Math.ceil(k);b[A]=M===E?_[M]:(1-(k-M))*_[M]+(1-(E-k))*_[E],v[A]=M===E?-_[w-1-M]:-((1-(k-M))*_[w-1-M])-(1-(E-k))*_[w-1-E]}b[O]=w%2===1?_[O-1]:(_[O-2]+_[O-1])/2,l.curve=b,u.curve=v}y=_,g&&(n(y)&&m===null?m=s(r,h):m!==null&&(m(),m=null))},get inputs(){return[h]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get oversample(){return l.oversample},set oversample(_){l.oversample=_,u.oversample=_},addEventListener(..._){return h.addEventListener(_[0],_[1],_[2])},dispatchEvent(..._){return h.dispatchEvent(_[0])},removeEventListener(..._){return h.removeEventListener(_[0],_[1],_[2])}};a!==null&&(T.curve=a instanceof Float32Array?a:new Float32Array(a)),o!==T.oversample&&(T.oversample=o);const x=()=>{h.connect(l).connect(f),h.connect(d).connect(u).connect(p).connect(f),g=!0,n(y)&&(m=s(r,h))},C=()=>{h.disconnect(l),l.disconnect(f),h.disconnect(d),d.disconnect(u),u.disconnect(p),p.disconnect(f),g=!1,m!==null&&(m(),m=null)};return i(kn(T,f),x,C)},Oe=()=>new DOMException("","NotSupportedError"),Th={numberOfChannels:1},xh=(s,e,t,n,i)=>class extends s{constructor(a,o,c){let l;if(typeof a=="number"&&o!==void 0&&c!==void 0)l={length:o,numberOfChannels:a,sampleRate:c};else if(typeof a=="object")l=a;else throw new Error("The given parameters are not valid.");const{length:u,numberOfChannels:h,sampleRate:d}={...Th,...l},f=n(h,u,d);e(Fn,()=>Fn(f))||f.addEventListener("statechange",(()=>{let p=0;const m=g=>{this._state==="running"&&(p>0?(f.removeEventListener("statechange",m),g.stopImmediatePropagation(),this._waitForThePromiseToSettle(g)):p+=1)};return m})()),super(f,h),this._length=u,this._nativeOfflineAudioContext=f,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(t()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,ho(this)}))}_waitForThePromiseToSettle(a){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(a):setTimeout(()=>this._waitForThePromiseToSettle(a))}},Sh={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},Ch=(s,e,t,n,i,r,a)=>class extends s{constructor(c,l){const u=i(c),h={...Sh,...l},d=t(u,h),f=r(u),p=f?n():null,m=c.sampleRate/2;super(c,!1,d,p),this._detune=e(this,f,d.detune,153600,-153600),this._frequency=e(this,f,d.frequency,m,-m),this._nativeOscillatorNode=d,this._onended=null,this._oscillatorNodeRenderer=p,this._oscillatorNodeRenderer!==null&&h.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=h.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?a(this,c):null;this._nativeOscillatorNode.onended=l;const u=this._nativeOscillatorNode.onended;this._onended=u!==null&&u===l?c:u}get type(){return this._nativeOscillatorNode.type}set type(c){this._nativeOscillatorNode.type=c,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(c){this._nativeOscillatorNode.setPeriodicWave(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=c)}start(c=0){if(this._nativeOscillatorNode.start(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=c),this.context.state!=="closed"){pn(this);const l=()=>{this._nativeOscillatorNode.removeEventListener("ended",l),ft(this)&&ts(this)};this._nativeOscillatorNode.addEventListener("ended",l)}}stop(c=0){this._nativeOscillatorNode.stop(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=c)}},kh=(s,e,t,n,i)=>()=>{const r=new WeakMap;let a=null,o=null,c=null;const l=async(u,h)=>{let d=t(u);const f=Ce(d,h);if(!f){const p={channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,detune:d.detune.value,frequency:d.frequency.value,periodicWave:a===null?void 0:a,type:d.type};d=e(h,p),o!==null&&d.start(o),c!==null&&d.stop(c)}return r.set(h,d),f?(await s(h,u.detune,d.detune),await s(h,u.frequency,d.frequency)):(await n(h,u.detune,d.detune),await n(h,u.frequency,d.frequency)),await i(u,h,d),d};return{set periodicWave(u){a=u},set start(u){o=u},set stop(u){c=u},render(u,h){const d=r.get(h);return d!==void 0?Promise.resolve(d):l(u,h)}}},Ah={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},Nh=(s,e,t,n,i,r,a)=>class extends s{constructor(c,l){const u=i(c),h={...Ah,...l},d=t(u,h),f=r(u),p=f?n():null;super(c,!1,d,p),this._nativePannerNode=d,this._orientationX=e(this,f,d.orientationX,Ae,De),this._orientationY=e(this,f,d.orientationY,Ae,De),this._orientationZ=e(this,f,d.orientationZ,Ae,De),this._positionX=e(this,f,d.positionX,Ae,De),this._positionY=e(this,f,d.positionY,Ae,De),this._positionZ=e(this,f,d.positionZ,Ae,De),a(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(c){this._nativePannerNode.coneInnerAngle=c}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(c){this._nativePannerNode.coneOuterAngle=c}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(c){this._nativePannerNode.coneOuterGain=c}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(c){this._nativePannerNode.distanceModel=c}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(c){this._nativePannerNode.maxDistance=c}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(c){this._nativePannerNode.panningModel=c}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(c){this._nativePannerNode.refDistance=c}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(c){this._nativePannerNode.rolloffFactor=c}},Oh=(s,e,t,n,i,r,a,o,c,l)=>()=>{const u=new WeakMap;let h=null;const d=async(f,p)=>{let m=null,g=r(f);const y={channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation},T={...y,coneInnerAngle:g.coneInnerAngle,coneOuterAngle:g.coneOuterAngle,coneOuterGain:g.coneOuterGain,distanceModel:g.distanceModel,maxDistance:g.maxDistance,panningModel:g.panningModel,refDistance:g.refDistance,rolloffFactor:g.rolloffFactor},x=Ce(g,p);if("bufferSize"in g)m=n(p,{...y,gain:1});else if(!x){const C={...T,orientationX:g.orientationX.value,orientationY:g.orientationY.value,orientationZ:g.orientationZ.value,positionX:g.positionX.value,positionY:g.positionY.value,positionZ:g.positionZ.value};g=i(p,C)}if(u.set(p,m===null?g:m),m!==null){if(h===null){if(a===null)throw new Error("Missing the native OfflineAudioContext constructor.");const A=new a(6,f.context.length,p.sampleRate),k=e(A,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});k.connect(A.destination),h=(async()=>{const M=await Promise.all([f.orientationX,f.orientationY,f.orientationZ,f.positionX,f.positionY,f.positionZ].map(async(E,P)=>{const R=t(A,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:P===0?1:0});return await o(A,E,R.offset),R}));for(let E=0;E<6;E+=1)M[E].connect(k,0,E),M[E].start(0);return l(A)})()}const C=await h,_=n(p,{...y,gain:1});await c(f,p,_);const w=[];for(let A=0;A<C.numberOfChannels;A+=1)w.push(C.getChannelData(A));let b=[w[0][0],w[1][0],w[2][0]],v=[w[3][0],w[4][0],w[5][0]],O=n(p,{...y,gain:1}),N=i(p,{...T,orientationX:b[0],orientationY:b[1],orientationZ:b[2],positionX:v[0],positionY:v[1],positionZ:v[2]});_.connect(O).connect(N.inputs[0]),N.connect(m);for(let A=128;A<C.length;A+=128){const k=[w[0][A],w[1][A],w[2][A]],M=[w[3][A],w[4][A],w[5][A]];if(k.some((E,P)=>E!==b[P])||M.some((E,P)=>E!==v[P])){b=k,v=M;const E=A/p.sampleRate;O.gain.setValueAtTime(0,E),O=n(p,{...y,gain:0}),N=i(p,{...T,orientationX:b[0],orientationY:b[1],orientationZ:b[2],positionX:v[0],positionY:v[1],positionZ:v[2]}),O.gain.setValueAtTime(1,E),_.connect(O).connect(N.inputs[0]),N.connect(m)}}return m}return x?(await s(p,f.orientationX,g.orientationX),await s(p,f.orientationY,g.orientationY),await s(p,f.orientationZ,g.orientationZ),await s(p,f.positionX,g.positionX),await s(p,f.positionY,g.positionY),await s(p,f.positionZ,g.positionZ)):(await o(p,f.orientationX,g.orientationX),await o(p,f.orientationY,g.orientationY),await o(p,f.orientationZ,g.orientationZ),await o(p,f.positionX,g.positionX),await o(p,f.positionY,g.positionY),await o(p,f.positionZ,g.positionZ)),Cn(g)?await c(f,p,g.inputs[0]):await c(f,p,g),g};return{render(f,p){const m=u.get(p);return m!==void 0?Promise.resolve(m):d(f,p)}}},Dh={disableNormalization:!1},Eh=(s,e,t,n)=>class To{constructor(r,a){const o=e(r),c=n({...Dh,...a}),l=s(o,c);return t.add(l),l}static[Symbol.hasInstance](r){return r!==null&&typeof r=="object"&&Object.getPrototypeOf(r)===To.prototype||t.has(r)}},Mh=(s,e)=>(t,n,i)=>(s(n).replay(i),e(n,t,i)),Ih=(s,e,t)=>async(n,i,r)=>{const a=s(n);await Promise.all(a.activeInputs.map((o,c)=>Array.from(o).map(async([l,u])=>{const d=await e(l).render(l,i),f=n.context.destination;!t(l)&&(n!==f||!t(n))&&d.connect(r,u,c)})).reduce((o,c)=>[...o,...c],[]))},Rh=(s,e,t)=>async(n,i,r)=>{const a=e(n);await Promise.all(Array.from(a.activeInputs).map(async([o,c])=>{const u=await s(o).render(o,i);t(o)||u.connect(r,c)}))},Vh=(s,e,t,n)=>i=>s(Fn,()=>Fn(i))?Promise.resolve(s(n,n)).then(r=>{if(!r){const a=t(i,512,0,1);i.oncomplete=()=>{a.onaudioprocess=null,a.disconnect()},a.onaudioprocess=()=>i.currentTime,a.connect(i.destination)}return i.startRendering()}):new Promise(r=>{const a=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=o=>{a.disconnect(),r(o.renderedBuffer)},a.connect(i.destination),i.startRendering()}),Fh=s=>(e,t)=>{s.set(e,t)},Ph=s=>(e,t)=>s.set(e,t),qh=(s,e,t,n,i,r,a,o)=>(c,l)=>t(c).render(c,l).then(()=>Promise.all(Array.from(n(l)).map(u=>t(u).render(u,l)))).then(()=>i(l)).then(u=>(typeof u.copyFromChannel!="function"?(a(u),Li(u)):e(r,()=>r(u))||o(u),s.add(u),u)),Lh={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},Wh=(s,e,t,n,i,r)=>class extends s{constructor(o,c){const l=i(o),u={...Lh,...c},h=t(l,u),d=r(l),f=d?n():null;super(o,!1,h,f),this._pan=e(this,d,h.pan)}get pan(){return this._pan}},jh=(s,e,t,n,i)=>()=>{const r=new WeakMap,a=async(o,c)=>{let l=t(o);const u=Ce(l,c);if(!u){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,pan:l.pan.value};l=e(c,h)}return r.set(c,l),u?await s(c,o.pan,l.pan):await n(c,o.pan,l.pan),Cn(l)?await i(o,c,l.inputs[0]):await i(o,c,l),l};return{render(o,c){const l=r.get(c);return l!==void 0?Promise.resolve(l):a(o,c)}}},Bh=s=>()=>{if(s===null)return!1;try{new s({length:1,sampleRate:44100})}catch{return!1}return!0},$h=(s,e)=>async()=>{if(s===null)return!0;if(e===null)return!1;const t=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),n=new e(1,128,44100),i=URL.createObjectURL(t);let r=!1,a=!1;try{await n.audioWorklet.addModule(i);const o=new s(n,"a",{numberOfOutputs:0}),c=n.createOscillator();o.port.onmessage=()=>r=!0,o.onprocessorerror=()=>a=!0,c.connect(o),c.start(0),await n.startRendering(),await new Promise(l=>setTimeout(l))}catch{}finally{URL.revokeObjectURL(i)}return r&&!a},Uh=(s,e)=>()=>{if(e===null)return Promise.resolve(!1);const t=new e(1,1,44100),n=s(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(i=>{t.oncomplete=()=>{n.disconnect(),i(t.currentTime!==0)},t.startRendering()})},Gh=()=>new DOMException("","UnknownError"),zh={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},Zh=(s,e,t,n,i,r,a)=>class extends s{constructor(c,l){const u=i(c),h={...zh,...l},d=t(u,h),p=r(u)?n():null;super(c,!0,d,p),this._isCurveNullified=!1,this._nativeWaveShaperNode=d,a(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(c){if(c===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(c.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=c}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(c){this._nativeWaveShaperNode.oversample=c}},Xh=(s,e,t)=>()=>{const n=new WeakMap,i=async(r,a)=>{let o=e(r);if(!Ce(o,a)){const l={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,curve:o.curve,oversample:o.oversample};o=s(a,l)}return n.set(a,o),Cn(o)?await t(r,a,o.inputs[0]):await t(r,a,o),o};return{render(r,a){const o=n.get(a);return o!==void 0?Promise.resolve(o):i(r,a)}}},Hh=()=>typeof window>"u"?null:window,Yh=(s,e)=>t=>{t.copyFromChannel=(n,i,r=0)=>{const a=s(r),o=s(i);if(o>=t.numberOfChannels)throw e();const c=t.length,l=t.getChannelData(o),u=n.length;for(let h=a<0?-a:0;h+a<c&&h<u;h+=1)n[h]=l[h+a]},t.copyToChannel=(n,i,r=0)=>{const a=s(r),o=s(i);if(o>=t.numberOfChannels)throw e();const c=t.length,l=t.getChannelData(o),u=n.length;for(let h=a<0?-a:0;h+a<c&&h<u;h+=1)l[h+a]=n[h]}},Qh=s=>e=>{e.copyFromChannel=(t=>(n,i,r=0)=>{const a=s(r),o=s(i);if(a<e.length)return t.call(e,n,o,a)})(e.copyFromChannel),e.copyToChannel=(t=>(n,i,r=0)=>{const a=s(r),o=s(i);if(a<e.length)return t.call(e,n,o,a)})(e.copyToChannel)},Jh=s=>(e,t)=>{const n=t.createBuffer(1,1,44100);e.buffer===null&&(e.buffer=n),s(e,"buffer",i=>()=>{const r=i.call(e);return r===n?null:r},i=>r=>i.call(e,r===null?n:r))},Kh=(s,e)=>(t,n)=>{n.channelCount=1,n.channelCountMode="explicit",Object.defineProperty(n,"channelCount",{get:()=>1,set:()=>{throw s()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set:()=>{throw s()}});const i=t.createBufferSource();e(n,()=>{const o=n.numberOfInputs;for(let c=0;c<o;c+=1)i.connect(n,0,c)},()=>i.disconnect(n))},xo=(s,e,t)=>s.copyFromChannel===void 0?s.getChannelData(t)[0]:(s.copyFromChannel(e,t),e[0]),So=s=>{if(s===null)return!1;const e=s.length;return e%2!==0?s[Math.floor(e/2)]!==0:s[e/2-1]+s[e/2]!==0},os=(s,e,t,n)=>{let i=s;for(;!i.hasOwnProperty(e);)i=Object.getPrototypeOf(i);const{get:r,set:a}=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(s,e,{get:t(r),set:n(a)})},ed=s=>({...s,outputChannelCount:s.outputChannelCount!==void 0?s.outputChannelCount:s.numberOfInputs===1&&s.numberOfOutputs===1?[s.channelCount]:Array.from({length:s.numberOfOutputs},()=>1)}),td=s=>({...s,channelCount:s.numberOfOutputs}),nd=s=>{const{imag:e,real:t}=s;return e===void 0?t===void 0?{...s,imag:[0,0],real:[0,0]}:{...s,imag:Array.from(t,()=>0),real:t}:t===void 0?{...s,imag:e,real:Array.from(e,()=>0)}:{...s,imag:e,real:t}},Co=(s,e,t)=>{try{s.setValueAtTime(e,t)}catch(n){if(n.code!==9)throw n;Co(s,e,t+1e-7)}},sd=s=>{const e=s.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},id=s=>{const e=s.createBufferSource(),t=s.createBuffer(1,1,44100);e.buffer=t;try{e.start(0,1)}catch{return!1}return!0},rd=s=>{const e=s.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},Ui=s=>{const e=s.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1},ko=s=>{const e=s.createBuffer(1,1,44100),t=s.createBufferSource();t.buffer=e,t.start(),t.stop();try{return t.stop(),!0}catch{return!1}},Gi=s=>{const e=s.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1},od=s=>{const{port1:e,port2:t}=new MessageChannel;try{e.postMessage(s)}finally{e.close(),t.close()}},ad=s=>{s.start=(e=>(t=0,n=0,i)=>{const r=s.buffer,a=r===null?n:Math.min(r.duration,n);r!==null&&a>r.duration-.5/s.context.sampleRate?e.call(s,t,0,0):e.call(s,t,a,i)})(s.start)},Ao=(s,e)=>{const t=e.createGain();s.connect(t);const n=(i=>()=>{i.call(s,t),s.removeEventListener("ended",n)})(s.disconnect);s.addEventListener("ended",n),kn(s,t),s.stop=(i=>{let r=!1;return(a=0)=>{if(r)try{i.call(s,a)}catch{t.gain.setValueAtTime(0,a)}else i.call(s,a),r=!0}})(s.stop)},An=(s,e)=>t=>{const n={value:s};return Object.defineProperties(t,{currentTarget:n,target:n}),typeof e=="function"?e.call(s,t):e.handleEvent.call(s,t)},cd=Nc(Jt),ld=Rc(Jt),ud=zl(ni),No=new WeakMap,hd=uu(No),Ye=Tl(new Map,new WeakMap),tt=Hh(),Oo=Wu(Ye,it),zi=lu(Ne),Te=Ih(Ne,zi,Ut),dd=Lc(Oo,ne,Te),te=pu(ti),wt=ph(tt),ee=Du(wt),Do=new WeakMap,Eo=nu(An),as=Uu(tt),Zi=ku(as),Xi=Au(tt),Mo=Nu(tt),Pn=zu(tt),pe=ul(Oc(io),Ic(cd,ld,ks,ud,As,Ne,hd,es,ne,Jt,ft,Ut,fs),Ye,bu(Si,As,Ne,ne,Vn,ft),it,si,Oe,Bl(ks,Si,Ne,ne,Vn,te,ft,ee),Hl(Do,Ne,Ze),Eo,te,Zi,Xi,Mo,ee,Pn),pd=qc(pe,dd,it,Oo,te,ee),Hi=new WeakSet,Ir=ju(tt),Io=Vl(new Uint32Array(1)),Yi=Yh(Io,it),Qi=Qh(Io),fd=jc(Hi,Ye,Oe,Ir,wt,Bh(Ir),Yi,Qi),ii=Vc(Me),Ro=Rh(zi,ns,Ut),rt=Ol(Ro),Nn=$u(ii,Ye,sd,id,rd,Ui,ko,Gi,ad,Jh(os),Ao),ot=Mh(hu(ns),Ro),md=Uc(rt,Nn,ne,ot,Te),Qe=hl(Dc(ro),Do,qi,dl,Tc,xc,Sc,Cc,kc,bi,no,as,Co),gd=$c(pe,md,Qe,ve,Nn,te,ee,An),_d=Kc(pe,el,it,ve,Gu(Me,os),te,ee,Te),yd=bl(rt,wo,ne,ot,Te),Kt=Ph(No),vd=wl(pe,Qe,yd,si,wo,te,ee,Kt),It=qu(Jt,Xi),wd=Kh(ve,It),Rt=Ku(as,wd),bd=Cl(Rt,ne,Te),Td=Sl(pe,bd,Rt,te,ee),xd=Nl(is,ne,Te),Sd=Al(pe,xd,is,te,ee,td),Cd=nh(ii,Nn,Me,It),On=th(ii,Ye,Cd,Ui,Gi),kd=Rl(rt,On,ne,ot,Te),Ad=Il(pe,Qe,kd,On,te,ee,An),Vo=sh(Oe,os),Nd=ql(Vo,ne,Te),Od=Pl(pe,Nd,Vo,te,ee,Kt),Dd=Gl(rt,bo,ne,ot,Te),Ed=Ul(pe,Qe,Dd,bo,te,ee,Kt),Fo=ih(Oe),Md=Kl(rt,Fo,ne,ot,Te),Id=Jl(pe,Qe,Md,Fo,Oe,te,ee,Kt),Rd=au(rt,Me,ne,ot,Te),Vd=ou(pe,Qe,Rd,Me,te,ee),Fd=ch(si,ve,rs,Oe),ri=Vh(Ye,Me,rs,Uh(Me,wt)),Pd=wu(Nn,ne,wt,Te,ri),qd=rh(Fd),Ld=yu(pe,qd,Pd,te,ee,Kt),Wd=tl(Qe,Rt,On,rs,Oe,xo,ee,os),Po=new WeakMap,jd=Pu(_d,Wd,Eo,ee,Po,An),qo=fh(ii,Ye,Ui,ko,Gi,Ao),Bd=kh(rt,qo,ne,ot,Te),$d=Ch(pe,Qe,qo,Bd,te,ee,An),Lo=El(Nn),Ud=bh(Lo,ve,Me,So,It),oi=wh(Lo,ve,Ud,So,It,as,os),Gd=gh(ks,ve,Rt,Me,rs,oi,Oe,As,xo,It),Wo=mh(Gd),zd=Oh(rt,Rt,On,Me,Wo,ne,wt,ot,Te,ri),Zd=Nh(pe,Qe,Wo,zd,te,ee,Kt),Xd=_h(it),Hd=Eh(Xd,te,new WeakSet,nd),Yd=vh(Rt,is,Me,oi,Oe,It),jo=yh(Yd,Oe),Qd=jh(rt,jo,ne,ot,Te),Jd=Wh(pe,Qe,jo,Qd,te,ee),Kd=Xh(oi,ne,Te),ep=Zh(pe,ve,oi,Kd,te,ee,Kt),Bo=Eu(tt),Ji=su(tt),$o=new WeakMap,tp=fu($o,wt),np=Bo?Mc(Ye,Oe,tu(tt),Ji,iu(Ac),te,tp,ee,Pn,new WeakMap,new WeakMap,$h(Pn,wt),tt):void 0,sp=Ou(Zi,ee),ip=jl(Hi,Ye,Wl,eu,new WeakSet,te,sp,Ss,Fn,Yi,Qi),Uo=yl(np,pd,fd,gd,vd,Td,Sd,Ad,Od,ip,Ed,Id,Vd,Ld,jd,$d,Zd,Hd,Jd,ep),rp=Mu(pe,lh,te,ee),op=Ru(pe,uh,te,ee),ap=Vu(pe,hh,te,ee),cp=dh(ve,ee),lp=Fu(pe,cp,te),up=Jc(Uo,ve,Oe,Gh,rp,op,ap,lp,as),Ki=mu(Po),hp=Fc(Ki),Go=Dl(it),dp=Zl(Ki),zo=Yl(it),Zo=new WeakMap,pp=cu(Zo,Ze),fp=Ju(Go,it,ve,Rt,is,On,Me,rs,Oe,zo,Ji,pp,It),mp=Xu(ve,fp,Me,Oe,It),gp=_l(rt,Go,Nn,Rt,is,On,Me,dp,zo,Ji,ne,Pn,wt,ot,Te,ri),_p=du($o),yp=Fh(Zo),Rr=Bo?fl(hp,pe,Qe,gp,mp,Ne,_p,te,ee,Pn,ed,yp,od,An):void 0,vp=Ll(Oe,wt),wp=qh(Hi,Ye,zi,Ki,ri,Ss,Yi,Qi),bp=xh(Uo,Ye,ve,vp,wp),Tp=Tu(ti,Zi),xp=xu(Pi,Xi),Sp=Su(qi,Mo),Cp=Cu(ti,ee);function L(s,e){if(!s)throw new Error(e)}function Xe(s,e,t=1/0){if(!(e<=s&&s<=t))throw new RangeError(`Value must be within [${e}, ${t}], got: ${s}`)}function Xo(s){!s.isOffline&&s.state!=="running"&&er('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let Ho=console;function kp(...s){Ho.log(...s)}function er(...s){Ho.warn(...s)}function We(s){return typeof s>"u"}function G(s){return!We(s)}function Ap(s){return typeof s=="function"}function _t(s){return typeof s=="number"}function Wt(s){return Object.prototype.toString.call(s)==="[object Object]"&&s.constructor===Object}function Np(s){return typeof s=="boolean"}function Pe(s){return Array.isArray(s)}function nt(s){return typeof s=="string"}function ds(s){return nt(s)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(s)}function Op(s){return new up(s)}function Dp(s,e,t){return new bp(s,e,t)}const jt=typeof self=="object"?self:null,Ep=jt&&(jt.hasOwnProperty("AudioContext")||jt.hasOwnProperty("webkitAudioContext"));function Mp(s,e,t){return L(G(Rr),"This node only works in a secure context (https or localhost)"),new Rr(s,e,t)}function Je(s,e,t,n){var i=arguments.length,r=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,n);else for(var o=s.length-1;o>=0;o--)(a=s[o])&&(r=(i<3?a(r):i>3?a(e,t,r):a(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r}function de(s,e,t,n){function i(r){return r instanceof t?r:new t(function(a){a(r)})}return new(t||(t=Promise))(function(r,a){function o(u){try{l(n.next(u))}catch(h){a(h)}}function c(u){try{l(n.throw(u))}catch(h){a(h)}}function l(u){u.done?r(u.value):i(u.value).then(o,c)}l((n=n.apply(s,e||[])).next())})}class Ip{constructor(e,t,n){this._callback=e,this._type=t,this._updateInterval=n,this._createClock()}_createWorker(){const e=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),t=URL.createObjectURL(e),n=new Worker(t);n.onmessage=this._callback.bind(this),this._worker=n}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){this._updateInterval=Math.max(e,128/44100),this._type==="worker"&&this._worker.postMessage(Math.max(e*1e3,1))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function Gt(s){return Sp(s)}function At(s){return xp(s)}function ms(s){return Cp(s)}function on(s){return Tp(s)}function Yo(s){return s instanceof AudioBuffer}function Rp(s,e){return s==="value"||Gt(e)||At(e)||Yo(e)}function je(s,...e){if(!e.length)return s;const t=e.shift();if(Wt(s)&&Wt(t))for(const n in t)Rp(n,t[n])?s[n]=t[n]:Wt(t[n])?(s[n]||Object.assign(s,{[n]:{}}),je(s[n],t[n])):Object.assign(s,{[n]:t[n]});return je(s,...e)}function Vp(s,e){return s.length===e.length&&s.every((t,n)=>e[n]===t)}function S(s,e,t=[],n){const i={},r=Array.from(e);if(Wt(r[0])&&n&&!Reflect.has(r[0],n)&&(Object.keys(r[0]).some(o=>Reflect.has(s,o))||(je(i,{[n]:r[0]}),t.splice(t.indexOf(n),1),r.shift())),r.length===1&&Wt(r[0]))je(i,r[0]);else for(let a=0;a<t.length;a++)G(r[a])&&(i[t[a]]=r[a]);return je(s,i)}function Fp(s){return s.constructor.getDefaults()}function ln(s,e){return We(s)?e:s}function xe(s,e){return e.forEach(t=>{Reflect.has(s,t)&&delete s[t]}),s}/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2019 Yotam Mann
 */class bt{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...e){(this.debug||jt&&this.toString()===jt.TONE_DEBUG_CLASS)&&kp(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}bt.version=to;const tr=1e-6;function Es(s,e){return s>e+tr}function Oi(s,e){return Es(s,e)||$e(s,e)}function Qo(s,e){return s+tr<e}function $e(s,e){return Math.abs(s-e)<tr}function Pp(s,e,t){return Math.max(Math.min(s,t),e)}class at extends bt{constructor(){super(),this.name="Timeline",this._timeline=[];const e=S(at.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(L(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){const t=this._timeline[this.length-1];L(Oi(e.time,t.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{const t=this._search(e.time);this._timeline.splice(t+1,0,e)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(e){const t=this._timeline.indexOf(e);return t!==-1&&this._timeline.splice(t,1),this}get(e,t="time"){const n=this._search(e,t);return n!==-1?this._timeline[n]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,t="time"){const n=this._search(e,t);return n+1<this._timeline.length?this._timeline[n+1]:null}getBefore(e){const t=this._timeline.length;if(t>0&&this._timeline[t-1].time<e)return this._timeline[t-1];const n=this._search(e);return n-1>=0?this._timeline[n-1]:null}cancel(e){if(this._timeline.length>1){let t=this._search(e);if(t>=0)if($e(this._timeline[t].time,e)){for(let n=t;n>=0&&$e(this._timeline[n].time,e);n--)t=n;this._timeline=this._timeline.slice(0,t)}else this._timeline=this._timeline.slice(0,t+1);else this._timeline=[]}else this._timeline.length===1&&Oi(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const t=this._search(e);return t>=0&&(this._timeline=this._timeline.slice(t+1)),this}previousEvent(e){const t=this._timeline.indexOf(e);return t>0?this._timeline[t-1]:null}_search(e,t="time"){if(this._timeline.length===0)return-1;let n=0;const i=this._timeline.length;let r=i;if(i>0&&this._timeline[i-1][t]<=e)return i-1;for(;n<r;){let a=Math.floor(n+(r-n)/2);const o=this._timeline[a],c=this._timeline[a+1];if($e(o[t],e)){for(let l=a;l<this._timeline.length;l++){const u=this._timeline[l];if($e(u[t],e))a=l;else break}return a}else{if(Qo(o[t],e)&&Es(c[t],e))return a;Es(o[t],e)?r=a:n=a+1}}return-1}_iterate(e,t=0,n=this._timeline.length-1){this._timeline.slice(t,n+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,t){const n=this._search(e);return n!==-1&&this._iterate(t,0,n),this}forEachAfter(e,t){const n=this._search(e);return this._iterate(t,n+1),this}forEachBetween(e,t,n){let i=this._search(e),r=this._search(t);return i!==-1&&r!==-1?(this._timeline[i].time!==e&&(i+=1),this._timeline[r].time===t&&(r-=1),this._iterate(n,i,r)):i===-1&&this._iterate(n,0,r),this}forEachFrom(e,t){let n=this._search(e);for(;n>=0&&this._timeline[n].time>=e;)n--;return this._iterate(t,n+1),this}forEachAtTime(e,t){const n=this._search(e);if(n!==-1&&$e(this._timeline[n].time,e)){let i=n;for(let r=n;r>=0&&$e(this._timeline[r].time,e);r--)i=r;this._iterate(r=>{t(r)},i,n)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const Jo=[];function ai(s){Jo.push(s)}function qp(s){Jo.forEach(e=>e(s))}const Ko=[];function ci(s){Ko.push(s)}function Lp(s){Ko.forEach(e=>e(s))}class cs extends bt{constructor(){super(...arguments),this.name="Emitter"}on(e,t){return e.split(/\W+/).forEach(i=>{We(this._events)&&(this._events={}),this._events.hasOwnProperty(i)||(this._events[i]=[]),this._events[i].push(t)}),this}once(e,t){const n=(...i)=>{t(...i),this.off(e,n)};return this.on(e,n),this}off(e,t){return e.split(/\W+/).forEach(i=>{if(We(this._events)&&(this._events={}),this._events.hasOwnProperty(e))if(We(t))this._events[e]=[];else{const r=this._events[e];for(let a=r.length-1;a>=0;a--)r[a]===t&&r.splice(a,1)}}),this}emit(e,...t){if(this._events&&this._events.hasOwnProperty(e)){const n=this._events[e].slice(0);for(let i=0,r=n.length;i<r;i++)n[i].apply(this,t)}return this}static mixin(e){["on","once","off","emit"].forEach(t=>{const n=Object.getOwnPropertyDescriptor(cs.prototype,t);Object.defineProperty(e.prototype,t,n)})}dispose(){return super.dispose(),this._events=void 0,this}}class ea extends cs{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class Dn extends ea{constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new at,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;const e=S(Dn.getDefaults(),arguments,["context"]);e.context?this._context=e.context:this._context=Op({latencyHint:e.latencyHint}),this._ticker=new Ip(this.emit.bind(this,"tick"),e.clockSource,e.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(e.latencyHint),this.lookAhead=e.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(qp(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,t,n){return this._context.createBuffer(e,t,n)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,t){return this._context.createIIRFilter(e,t)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,t,n){return this._context.createPeriodicWave(e,t,n)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){return L(on(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(e)}createMediaElementSource(e){return L(on(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(e)}createMediaStreamDestination(){return L(on(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){L(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){L(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){L(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){L(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,t){return Mp(this.rawContext,e,t)}addAudioWorkletModule(e,t){return de(this,void 0,void 0,function*(){L(G(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(t)||this._workletModules.set(t,this.rawContext.audioWorklet.addModule(e)),yield this._workletModules.get(t)})}workletsAreReady(){return de(this,void 0,void 0,function*(){const e=[];this._workletModules.forEach(t=>e.push(t)),yield Promise.all(e)})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get latencyHint(){return this._latencyHint}_setLatencyHint(e){let t=0;if(this._latencyHint=e,nt(e))switch(e){case"interactive":t=.1;break;case"playback":t=.5;break;case"balanced":t=.25;break}this.lookAhead=t,this.updateInterval=t/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return on(this._context)?this._context.resume():Promise.resolve()}close(){return de(this,void 0,void 0,function*(){on(this._context)&&(yield this._context.close()),this._initialized&&Lp(this)})}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const t=this._context.createBuffer(1,128,this._context.sampleRate),n=t.getChannelData(0);for(let r=0;r<n.length;r++)n[r]=e;const i=this._context.createBufferSource();return i.channelCount=1,i.channelCountMode="explicit",i.buffer=t,i.loop=!0,i.start(0),this._constants.set(e,i),i}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(e=>this._constants[e].disconnect()),this}_timeoutLoop(){const e=this.now();let t=this._timeouts.peek();for(;this._timeouts.length&&t&&t.time<=e;)t.callback(),this._timeouts.shift(),t=this._timeouts.peek()}setTimeout(e,t){this._timeoutIds++;const n=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:n+t}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach(t=>{t.id===e&&this._timeouts.remove(t)}),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,t){const n=++this._timeoutIds,i=()=>{const r=this.now();this._timeouts.add({callback:()=>{e(),i()},id:n,time:r+t})};return i(),n}}class Wp extends ea{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,t,n){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,t){return{}}createPanner(){return{}}createPeriodicWave(e,t,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,t){return{}}get rawContext(){return{}}addAudioWorkletModule(e,t){return de(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(e,t){return 0}clearTimeout(e){return this}setInterval(e,t){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}}function Y(s,e){Pe(e)?e.forEach(t=>Y(s,t)):Object.defineProperty(s,e,{enumerable:!0,writable:!1})}function nr(s,e){Pe(e)?e.forEach(t=>nr(s,t)):Object.defineProperty(s,e,{writable:!0})}const Q=()=>{};class J extends bt{constructor(){super(),this.name="ToneAudioBuffer",this.onload=Q;const e=S(J.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,e.url&&Yo(e.url)||e.url instanceof J?this.set(e.url):nt(e.url)&&this.load(e.url).catch(e.onerror)}static getDefaults(){return{onerror:Q,onload:Q,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:Ue().sampleRate}set(e){return e instanceof J?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return de(this,void 0,void 0,function*(){const t=J.load(e).then(n=>{this.set(n),this.onload(this)});J.downloads.push(t);try{yield t}finally{const n=J.downloads.indexOf(t);J.downloads.splice(n,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){const t=Pe(e)&&e[0].length>0,n=t?e.length:1,i=t?e[0].length:e.length,r=Ue(),a=r.createBuffer(n,i,r.sampleRate),o=!t&&n===1?[e]:e;for(let c=0;c<n;c++)a.copyToChannel(o[c],c);return this._buffer=a,this}toMono(e){if(_t(e))this.fromArray(this.toArray(e));else{let t=new Float32Array(this.length);const n=this.numberOfChannels;for(let i=0;i<n;i++){const r=this.toArray(i);for(let a=0;a<r.length;a++)t[a]+=r[a]}t=t.map(i=>i/n),this.fromArray(t)}return this}toArray(e){if(_t(e))return this.getChannelData(e);if(this.numberOfChannels===1)return this.toArray(0);{const t=[];for(let n=0;n<this.numberOfChannels;n++)t[n]=this.getChannelData(n);return t}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e,t=this.duration){const n=Math.floor(e*this.sampleRate),i=Math.floor(t*this.sampleRate);L(n<i,"The start time must be less than the end time");const r=i-n,a=Ue().createBuffer(this.numberOfChannels,r,this.sampleRate);for(let o=0;o<this.numberOfChannels;o++)a.copyToChannel(this.getChannelData(o).subarray(n,i),o);return new J(a)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return new J().fromArray(e)}static fromUrl(e){return de(this,void 0,void 0,function*(){return yield new J().load(e)})}static load(e){return de(this,void 0,void 0,function*(){const t=e.match(/\[([^\]\[]+\|.+)\]$/);if(t){const o=t[1].split("|");let c=o[0];for(const l of o)if(J.supportsType(l)){c=l;break}e=e.replace(t[0],c)}const n=J.baseUrl===""||J.baseUrl.endsWith("/")?J.baseUrl:J.baseUrl+"/",i=yield fetch(n+e);if(!i.ok)throw new Error(`could not load url: ${e}`);const r=yield i.arrayBuffer();return yield Ue().decodeAudioData(r)})}static supportsType(e){const t=e.split("."),n=t[t.length-1];return document.createElement("audio").canPlayType("audio/"+n)!==""}static loaded(){return de(this,void 0,void 0,function*(){for(yield Promise.resolve();J.downloads.length;)yield J.downloads[0]})}}J.baseUrl="";J.downloads=[];class li extends Dn{constructor(){super({clockSource:"offline",context:ms(arguments[0])?arguments[0]:Dp(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:ms(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=ms(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return de(this,void 0,void 0,function*(){let t=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,t++;const n=Math.floor(this.sampleRate/128);e&&t%n===0&&(yield new Promise(i=>setTimeout(i,1)))}})}render(e=!0){return de(this,void 0,void 0,function*(){yield this.workletsAreReady(),yield this._renderClock(e);const t=yield this._context.startRendering();return new J(t)})}close(){return Promise.resolve()}}const ta=new Wp;let un=ta;function Ue(){return un===ta&&Ep&&na(new Dn),un}function na(s){on(s)?un=new Dn(s):ms(s)?un=new li(s):un=s}function sa(){return un.resume()}if(jt&&!jt.TONE_SILENCE_LOGGING){const e=` * Tone.js v${to} * `;console.log(`%c${e}`,"background: #000; color: #fff")}function jp(s){return Math.pow(10,s/20)}function Bp(s){return 20*(Math.log(s)/Math.LN10)}function ia(s){return Math.pow(2,s/12)}let ui=440;function $p(){return ui}function Up(s){ui=s}function Lt(s){return Math.round(ra(s))}function ra(s){return 69+12*Math.log2(s/ui)}function oa(s){return ui*Math.pow(2,(s-69)/12)}class sr extends bt{constructor(e,t,n){super(),this.defaultUnits="s",this._val=t,this._units=n,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,t)=>{const n=parseInt(e,10),i=t==="."?1.5:1;return n===1?this._beatsToUnits(this._getTimeSignature())*i:this._beatsToUnits(4/n)*i},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const t=parseInt(e,10);return this._beatsToUnits(8/(Math.floor(t)*3))},regexp:/^(\d+)t$/i},tr:{method:(e,t,n)=>{let i=0;return e&&e!=="0"&&(i+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(i+=this._beatsToUnits(parseFloat(t))),n&&n!=="0"&&(i+=this._beatsToUnits(parseFloat(n)/4)),i},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof sr&&this.fromType(this._val),We(this._val))return this._noArg();if(nt(this._val)&&We(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(Wt(this._val)){let e=0;for(const t in this._val)if(G(this._val[t])){const n=this._val[t],i=new this.constructor(this.context,t).valueOf()*n;e+=i}return e}if(G(this._units)){const e=this._expressions[this._units],t=this._val.toString().trim().match(e.regexp);return t?e.method.apply(this,t.slice(1)):e.method.call(this,this._val)}else return nt(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}}class Ge extends sr{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const t=new Ge(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(t))},regexp:/^@(.+)/}})}quantize(e,t=1){const n=new this.constructor(this.context,e).valueOf(),i=this.valueOf(),o=Math.round(i/n)*n-i;return i+o*t}toNotation(){const e=this.toSeconds(),t=["1m"];for(let r=1;r<9;r++){const a=Math.pow(2,r);t.push(a+"n."),t.push(a+"n"),t.push(a+"t")}t.push("0");let n=t[0],i=new Ge(this.context,t[0]).toSeconds();return t.forEach(r=>{const a=new Ge(this.context,r).toSeconds();Math.abs(a-e)<Math.abs(i-e)&&(n=r,i=a)}),n}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let t=this.valueOf()/e;t=parseFloat(t.toFixed(4));const n=Math.floor(t/this._getTimeSignature());let i=t%1*4;t=Math.floor(t)%this._getTimeSignature();const r=i.toString();return r.length>3&&(i=parseFloat(parseFloat(r).toFixed(3))),[n,t,i].join(":")}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.round(t*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return Lt(this.toFrequency())}_now(){return this.context.now()}}class Fe extends Ge{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return $p()}static set A4(e){Up(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return this.defaultUnits==="midi"?e:Fe.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(e,t){const i=Gp[e.toLowerCase()]+(parseInt(t,10)+1)*12;return this.defaultUnits==="midi"?i:Fe.mtof(i)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,t,n){let i=1;return e&&e!=="0"&&(i*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(i*=this._beatsToUnits(parseFloat(t))),n&&n!=="0"&&(i*=this._beatsToUnits(parseFloat(n)/4)),i}}})}transpose(e){return new Fe(this.context,this.valueOf()*ia(e))}harmonize(e){return e.map(t=>this.transpose(t))}toMidi(){return Lt(this.valueOf())}toNote(){const e=this.toFrequency(),t=Math.log2(e/Fe.A4);let n=Math.round(12*t)+57;const i=Math.floor(n/12);return i<0&&(n+=-12*i),zp[n%12]+i.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.floor(t*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(e*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return oa(e)}static ftom(e){return Lt(e)}}const Gp={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},zp=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class Rn extends Ge{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class Ee extends bt{constructor(){super();const e=S(Ee.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:Ue()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return new Ge(this.context,e).toSeconds()}toFrequency(e){return new Fe(this.context,e).toFrequency()}toTicks(e){return new Rn(this.context,e).toTicks()}_getPartialProperties(e){const t=this.get();return Object.keys(t).forEach(n=>{We(e[n])&&delete t[n]}),t}get(){const e=Fp(this);return Object.keys(e).forEach(t=>{if(Reflect.has(this,t)){const n=this[t];G(n)&&G(n.value)&&G(n.setValueAtTime)?e[t]=n.value:n instanceof Ee?e[t]=n._getPartialProperties(e[t]):Pe(n)||_t(n)||nt(n)||Np(n)?e[t]=n:delete e[t]}}),e}set(e){return Object.keys(e).forEach(t=>{Reflect.has(this,t)&&G(this[t])&&(this[t]&&G(this[t].value)&&G(this[t].setValueAtTime)?this[t].value!==e[t]&&(this[t].value=e[t]):this[t]instanceof Ee?this[t].set(e[t]):this[t]=e[t])}),this}}class ir extends at{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const t=this.get(e);return t!==null?t.state:this._initial}setStateAtTime(e,t,n){return Xe(t,0),this.add(Object.assign({},n,{state:e,time:t})),this}getLastState(e,t){const n=this._search(t);for(let i=n;i>=0;i--){const r=this._timeline[i];if(r.state===e)return r}}getNextState(e,t){const n=this._search(t);if(n!==-1)for(let i=n;i<this._timeline.length;i++){const r=this._timeline[i];if(r.state===e)return r}}}class z extends Ee{constructor(){super(S(z.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const e=S(z.getDefaults(),arguments,["param","units","convert"]);for(L(G(e.param)&&(Gt(e.param)||e.param instanceof z),"param must be an AudioParam");!Gt(e.param);)e.param=e.param._param;this._swappable=G(e.swappable)?e.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new at(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,G(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Ee.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return G(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return G(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(e,t){return this.units===t}_assertRange(e){return G(this.maxValue)&&G(this.minValue)&&Xe(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?jp(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}_toType(e){return this.convert&&this.units==="decibels"?Bp(e):e}setValueAtTime(e,t){const n=this.toSeconds(t),i=this._fromType(e);return L(isFinite(i)&&isFinite(n),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(i),this.log(this.units,"setValueAtTime",e,n),this._events.add({time:n,type:"setValueAtTime",value:i}),this._param.setValueAtTime(i,n),this}getValueAtTime(e){const t=Math.max(this.toSeconds(e),0),n=this._events.getAfter(t),i=this._events.get(t);let r=this._initialValue;if(i===null)r=this._initialValue;else if(i.type==="setTargetAtTime"&&(n===null||n.type==="setValueAtTime")){const a=this._events.getBefore(i.time);let o;a===null?o=this._initialValue:o=a.value,i.type==="setTargetAtTime"&&(r=this._exponentialApproach(i.time,o,i.value,i.constant,t))}else if(n===null)r=i.value;else if(n.type==="linearRampToValueAtTime"||n.type==="exponentialRampToValueAtTime"){let a=i.value;if(i.type==="setTargetAtTime"){const o=this._events.getBefore(i.time);o===null?a=this._initialValue:a=o.value}n.type==="linearRampToValueAtTime"?r=this._linearInterpolate(i.time,a,n.time,n.value,t):r=this._exponentialInterpolate(i.time,a,n.time,n.value,t)}else r=i.value;return this._toType(r)}setRampPoint(e){e=this.toSeconds(e);let t=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),this._fromType(t)===0&&(t=this._toType(this._minOutput)),this.setValueAtTime(t,e),this}linearRampToValueAtTime(e,t){const n=this._fromType(e),i=this.toSeconds(t);return L(isFinite(n)&&isFinite(i),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(n),this._events.add({time:i,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",e,i),this._param.linearRampToValueAtTime(n,i),this}exponentialRampToValueAtTime(e,t){let n=this._fromType(e);n=$e(n,0)?this._minOutput:n,this._assertRange(n);const i=this.toSeconds(t);return L(isFinite(n)&&isFinite(i),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({time:i,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",e,i),this._param.exponentialRampToValueAtTime(n,i),this}exponentialRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(e,n+this.toSeconds(t)),this}linearRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(e,n+this.toSeconds(t)),this}targetRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(e,n,t),this}exponentialApproachValueAtTime(e,t,n){t=this.toSeconds(t),n=this.toSeconds(n);const i=Math.log(n+1)/Math.log(200);return this.setTargetAtTime(e,t,i),this.cancelAndHoldAtTime(t+n*.9),this.linearRampToValueAtTime(e,t+n),this}setTargetAtTime(e,t,n){const i=this._fromType(e);L(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");const r=this.toSeconds(t);return this._assertRange(i),L(isFinite(i)&&isFinite(r),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({constant:n,time:r,type:"setTargetAtTime",value:i}),this.log(this.units,"setTargetAtTime",e,r,n),this._param.setTargetAtTime(i,r,n),this}setValueCurveAtTime(e,t,n,i=1){n=this.toSeconds(n),t=this.toSeconds(t);const r=this._fromType(e[0])*i;this.setValueAtTime(this._toType(r),t);const a=n/(e.length-1);for(let o=1;o<e.length;o++){const c=this._fromType(e[o])*i;this.linearRampToValueAtTime(this._toType(c),t+o*a)}return this}cancelScheduledValues(e){const t=this.toSeconds(e);return L(isFinite(t),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(t),this._param.cancelScheduledValues(t),this.log(this.units,"cancelScheduledValues",t),this}cancelAndHoldAtTime(e){const t=this.toSeconds(e),n=this._fromType(this.getValueAtTime(t));L(isFinite(t),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",t,"value="+n);const i=this._events.get(t),r=this._events.getAfter(t);return i&&$e(i.time,t)?r?(this._param.cancelScheduledValues(r.time),this._events.cancel(r.time)):(this._param.cancelAndHoldAtTime(t),this._events.cancel(t+this.sampleTime)):r&&(this._param.cancelScheduledValues(r.time),this._events.cancel(r.time),r.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(n),t):r.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(n),t)),this._events.add({time:t,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,t),this}rampTo(e,t=.1,n){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(e,t,n):this.linearRampTo(e,t,n),this}apply(e){const t=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(t),t);const n=this._events.get(t);if(n&&n.type==="setTargetAtTime"){const i=this._events.getAfter(n.time),r=i?i.time:t+2,a=(r-t)/10;for(let o=t;o<r;o+=a)e.linearRampToValueAtTime(this.getValueAtTime(o),o)}return this._events.forEachAfter(this.context.currentTime,i=>{i.type==="cancelScheduledValues"?e.cancelScheduledValues(i.time):i.type==="setTargetAtTime"?e.setTargetAtTime(i.value,i.time,i.constant):e[i.type](i.value,i.time)}),this}setParam(e){L(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const t=this.input;return t.disconnect(this._param),this.apply(e),this._param=e,t.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,t,n,i,r){return n+(t-n)*Math.exp(-(r-e)/i)}_linearInterpolate(e,t,n,i,r){return t+(i-t)*((r-e)/(n-e))}_exponentialInterpolate(e,t,n,i,r){return t*Math.pow(i/t,(r-e)/(n-e))}}class I extends Ee{constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}get numberOfInputs(){return G(this.input)?Gt(this.input)||this.input instanceof z?1:this.input.numberOfInputs:0}get numberOfOutputs(){return G(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return G(e)&&(e instanceof I||At(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach(n=>{n.channelCount=e.channelCount,n.channelCountMode=e.channelCountMode,n.channelInterpretation=e.channelInterpretation})}_getChannelProperties(){const e=this._getInternalNodes();L(e.length>0,"ToneAudioNode does not have any internal nodes");const t=e[0];return{channelCount:t.channelCount,channelCountMode:t.channelCountMode,channelInterpretation:t.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelInterpretation:e}))}connect(e,t=0,n=0){return yt(this,e,t,n),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return er("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,t=0,n=0){return aa(this,e,t,n),this}chain(...e){return fn(this,...e),this}fan(...e){return e.forEach(t=>this.connect(t)),this}dispose(){return super.dispose(),G(this.input)&&(this.input instanceof I?this.input.dispose():At(this.input)&&this.input.disconnect()),G(this.output)&&(this.output instanceof I?this.output.dispose():At(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function fn(...s){const e=s.shift();s.reduce((t,n)=>(t instanceof I?t.connect(n):At(t)&&yt(t,n),n),e)}function yt(s,e,t=0,n=0){for(L(G(s),"Cannot connect from undefined node"),L(G(e),"Cannot connect to undefined node"),(e instanceof I||At(e))&&L(e.numberOfInputs>0,"Cannot connect to node with no inputs"),L(s.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof I||e instanceof z;)G(e.input)&&(e=e.input);for(;s instanceof I;)G(s.output)&&(s=s.output);Gt(e)?s.connect(e,t):s.connect(e,t,n)}function aa(s,e,t=0,n=0){if(G(e))for(;e instanceof I;)e=e.input;for(;!At(s);)G(s.output)&&(s=s.output);Gt(e)?s.disconnect(e,t):At(e)?s.disconnect(e,t,n):s.disconnect()}class X extends I{constructor(){super(S(X.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const e=S(X.getDefaults(),arguments,["gain","units"]);this.gain=new z({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),Y(this,"gain")}static getDefaults(){return Object.assign(I.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class mn extends I{constructor(e){super(e),this.onended=Q,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new X({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const n=this.toSeconds(t);return this._startTime!==-1&&n>=this._startTime&&(this._stopTime===-1||n<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(I.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:Q})}_startGain(e,t=1){L(this._startTime===-1,"Source cannot be started more than once");const n=this.toSeconds(this._fadeIn);return this._startTime=e+n,this._startTime=Math.max(this._startTime,this.context.currentTime),n>0?(this._gainNode.gain.setValueAtTime(0,e),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(t,e+n):this._gainNode.gain.exponentialApproachValueAtTime(t,e,n)):this._gainNode.gain.setValueAtTime(t,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){L(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const t=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+t,this._stopTime=Math.max(this._stopTime,this.context.currentTime),t>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,t,e):this._gainNode.gain.targetRampTo(0,t,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const n=this._curve==="exponential"?t*2:0;this._stopSource(this.now()+n),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==Q&&(this.onended(this),this.onended=Q,!this.context.isOffline)){const e=()=>this.dispose();typeof window.requestIdleCallback<"u"?window.requestIdleCallback(e):setTimeout(e,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),L(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}}class Ms extends mn{constructor(){super(S(Ms.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const e=S(Ms.getDefaults(),arguments,["offset"]);yt(this._source,this._gainNode),this.offset=new z({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(mn.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._source.start(t),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class Z extends I{constructor(){super(S(Z.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const e=S(Z.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new Ms({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(I.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,t=0,n=0){return hi(this,e,t,n),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,t){return this._param.setValueAtTime(e,t),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,t){return this._param.linearRampToValueAtTime(e,t),this}exponentialRampToValueAtTime(e,t){return this._param.exponentialRampToValueAtTime(e,t),this}exponentialRampTo(e,t,n){return this._param.exponentialRampTo(e,t,n),this}linearRampTo(e,t,n){return this._param.linearRampTo(e,t,n),this}targetRampTo(e,t,n){return this._param.targetRampTo(e,t,n),this}exponentialApproachValueAtTime(e,t,n){return this._param.exponentialApproachValueAtTime(e,t,n),this}setTargetAtTime(e,t,n){return this._param.setTargetAtTime(e,t,n),this}setValueCurveAtTime(e,t,n,i){return this._param.setValueCurveAtTime(e,t,n,i),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,t,n){return this._param.rampTo(e,t,n),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function hi(s,e,t,n){(e instanceof z||Gt(e)||e instanceof Z&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof Z&&(e.overridden=!0)),yt(s,e,t,n)}class Is extends z{constructor(){super(S(Is.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new at(1/0),this._multiplier=1;const e=S(Is.getDefaults(),arguments,["value"]);this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(z.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,t,n){t=this.toSeconds(t),this.setRampPoint(t);const i=this._fromType(e),r=this._events.get(t),a=Math.round(Math.max(1/n,1));for(let o=0;o<=a;o++){const c=n*o+t,l=this._exponentialApproach(r.time,r.value,i,n,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}setValueAtTime(e,t){const n=this.toSeconds(t);super.setValueAtTime(e,t);const i=this._events.get(n),r=this._events.previousEvent(i),a=this._getTicksUntilEvent(r,n);return i.ticks=Math.max(a,0),this}linearRampToValueAtTime(e,t){const n=this.toSeconds(t);super.linearRampToValueAtTime(e,t);const i=this._events.get(n),r=this._events.previousEvent(i),a=this._getTicksUntilEvent(r,n);return i.ticks=Math.max(a,0),this}exponentialRampToValueAtTime(e,t){t=this.toSeconds(t);const n=this._fromType(e),i=this._events.get(t),r=Math.round(Math.max((t-i.time)*10,1)),a=(t-i.time)/r;for(let o=0;o<=r;o++){const c=a*o+i.time,l=this._exponentialInterpolate(i.time,i.value,t,n,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}_getTicksUntilEvent(e,t){if(e===null)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(We(e.ticks)){const a=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(a,e.time)}const n=this._fromType(this.getValueAtTime(e.time));let i=this._fromType(this.getValueAtTime(t));const r=this._events.get(t);return r&&r.time===t&&r.type==="setValueAtTime"&&(i=this._fromType(this.getValueAtTime(t-this.sampleTime))),.5*(t-e.time)*(n+i)+e.ticks}getTicksAtTime(e){const t=this.toSeconds(e),n=this._events.get(t);return Math.max(this._getTicksUntilEvent(n,t),0)}getDurationOfTicks(e,t){const n=this.toSeconds(t),i=this.getTicksAtTime(t);return this.getTimeOfTick(i+e)-n}getTimeOfTick(e){const t=this._events.get(e,"ticks"),n=this._events.getAfter(e,"ticks");if(t&&t.ticks===e)return t.time;if(t&&n&&n.type==="linearRampToValueAtTime"&&t.value!==n.value){const i=this._fromType(this.getValueAtTime(t.time)),a=(this._fromType(this.getValueAtTime(n.time))-i)/(n.time-t.time),o=Math.sqrt(Math.pow(i,2)-2*a*(t.ticks-e)),c=(-i+o)/a,l=(-i-o)/a;return(c>0?c:l)+t.time}else return t?t.value===0?1/0:t.time+(e-t.ticks)/t.value:e/this._initialValue}ticksToTime(e,t){return this.getDurationOfTicks(e,t)}timeToTicks(e,t){const n=this.toSeconds(t),i=this.toSeconds(e),r=this.getTicksAtTime(n);return this.getTicksAtTime(n+i)-r}_fromType(e){return this.units==="bpm"&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return this.units==="bpm"&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const t=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(t,0)}}class Rs extends Z{constructor(){super(S(Rs.getDefaults(),arguments,["value"])),this.name="TickSignal";const e=S(Rs.getDefaults(),arguments,["value"]);this.input=this._param=new Is({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(Z.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,t){return this._param.ticksToTime(e,t)}timeToTicks(e,t){return this._param.timeToTicks(e,t)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,t){return this._param.getDurationOfTicks(e,t)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class Vs extends Ee{constructor(){super(S(Vs.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new ir,this._tickOffset=new at;const e=S(Vs.getDefaults(),arguments,["frequency"]);this.frequency=new Rs({context:this.context,units:e.units,value:e.frequency}),Y(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},Ee.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,t){const n=this.toSeconds(e);return this._state.getValueAtTime(n)!=="started"&&(this._state.setStateAtTime("started",n),G(t)&&this.setTicksAtTime(t,n)),this}stop(e){const t=this.toSeconds(e);if(this._state.getValueAtTime(t)==="stopped"){const n=this._state.get(t);n&&n.time>0&&(this._tickOffset.cancel(n.time),this._state.cancel(n.time))}return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this.setTicksAtTime(0,t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&this._state.setStateAtTime("paused",t),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this}getTicksAtTime(e){const t=this.toSeconds(e),n=this._state.getLastState("stopped",t),i={state:"paused",time:t};this._state.add(i);let r=n,a=0;return this._state.forEachBetween(n.time,t+this.sampleTime,o=>{let c=r.time;const l=this._tickOffset.get(o.time);l&&l.time>=r.time&&(a=l.ticks,c=l.time),r.state==="started"&&o.state!=="started"&&(a+=this.frequency.getTicksAtTime(o.time)-this.frequency.getTicksAtTime(c)),r=o}),this._state.remove(i),a}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const t=this.now(),n=this.frequency.timeToTicks(e,t);this.setTicksAtTime(n,t)}getSecondsAtTime(e){e=this.toSeconds(e);const t=this._state.getLastState("stopped",e),n={state:"paused",time:e};this._state.add(n);let i=t,r=0;return this._state.forEachBetween(t.time,e+this.sampleTime,a=>{let o=i.time;const c=this._tickOffset.get(a.time);c&&c.time>=i.time&&(r=c.seconds,o=c.time),i.state==="started"&&a.state!=="started"&&(r+=a.time-o),i=a}),this._state.remove(n),r}setTicksAtTime(e,t){return t=this.toSeconds(t),this._tickOffset.cancel(t),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,t),ticks:e,time:t}),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,t=this.now()){const n=this._tickOffset.get(t),i=this._state.get(t),r=Math.max(n.time,i.time),a=this.frequency.getTicksAtTime(r)+e-n.ticks;return this.frequency.getTimeOfTick(a)}forEachTickBetween(e,t,n){let i=this._state.get(e);this._state.forEachBetween(e,t,a=>{i&&i.state==="started"&&a.state!=="started"&&this.forEachTickBetween(Math.max(i.time,e),a.time-this.sampleTime,n),i=a});let r=null;if(i&&i.state==="started"){const a=Math.max(i.time,e),o=this.frequency.getTicksAtTime(a),c=this.frequency.getTicksAtTime(i.time),l=o-c;let u=Math.ceil(l)-l;u=$e(u,1)?0:u;let h=this.frequency.getTimeOfTick(o+u);for(;h<t;){try{n(h,Math.round(this.getTicksAtTime(h)))}catch(d){r=d;break}h+=this.frequency.getDurationOfTicks(1,h)}}if(r)throw r;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}}class qn extends Ee{constructor(){super(S(qn.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=Q,this._lastUpdate=0,this._state=new ir("stopped"),this._boundLoop=this._loop.bind(this);const e=S(qn.getDefaults(),arguments,["callback","frequency"]);this.callback=e.callback,this._tickSource=new Vs({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,Y(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(Ee.getDefaults(),{callback:Q,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,t){Xo(this.context);const n=this.toSeconds(e);return this.log("start",n),this._state.getValueAtTime(n)!=="started"&&(this._state.setStateAtTime("started",n),this._tickSource.start(n,t),n<this._lastUpdate&&this.emit("start",n,t)),this}stop(e){const t=this.toSeconds(e);return this.log("stop",t),this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._tickSource.pause(t),t<this._lastUpdate&&this.emit("pause",t)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,t){return this._tickSource.setTicksAtTime(e,t),this}getTimeOfTick(e,t=this.now()){return this._tickSource.getTimeOfTick(e,t)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,t){const n=this.toSeconds(t),i=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(i+e,n)}_loop(){const e=this._lastUpdate,t=this.now();this._lastUpdate=t,this.log("loop",e,t),e!==t&&(this._state.forEachBetween(e,t,n=>{switch(n.state){case"started":const i=this._tickSource.getTicksAtTime(n.time);this.emit("start",n.time,i);break;case"stopped":n.time!==0&&this.emit("stop",n.time);break;case"paused":this.emit("pause",n.time);break}}),this._tickSource.forEachTickBetween(e,t,(n,i)=>{this.callback(n,i)}))}getStateAtTime(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}cs.mixin(qn);class rr extends bt{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=S(rr.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach(t=>{this._loadingCount++;const n=e.urls[t];this.add(t,n,this._bufferLoaded.bind(this,e.onload),e.onerror)})}static getDefaults(){return{baseUrl:"",onerror:Q,onload:Q,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return L(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,this._loadingCount===0&&e&&e()}get loaded(){return Array.from(this._buffers).every(([e,t])=>t.loaded)}add(e,t,n=Q,i=Q){return nt(t)?this._buffers.set(e.toString(),new J(this.baseUrl+t,n,i)):this._buffers.set(e.toString(),new J(t,n,i)),this}dispose(){return super.dispose(),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this}}class Fs extends Fe{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(e){return Lt(super._frequencyToUnits(e))}_ticksToUnits(e){return Lt(super._ticksToUnits(e))}_beatsToUnits(e){return Lt(super._beatsToUnits(e))}_secondsToUnits(e){return Lt(super._secondsToUnits(e))}toMidi(){return this.valueOf()}toFrequency(){return oa(this.toMidi())}transpose(e){return new Fs(this.context,this.toMidi()+e)}}class ht extends Rn{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}let Zp=class extends Ee{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new at,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,t){return this._events.add({callback:e,time:this.toSeconds(t)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=e;){const t=this._events.shift();t&&e-t.time<=this.expiration&&t.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}};ai(s=>{s.draw=new Zp({context:s})});ci(s=>{s.draw.dispose()});class Xp extends bt{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){L(G(e.time),"Events must have a time property"),L(G(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let t=new Hp(e.time,e.time+e.duration,e);for(this._root===null?this._root=t:this._root.insert(t),this._length++;t!==null;)t.updateHeight(),t.updateMax(),this._rebalance(t),t=t.parent;return this}remove(e){if(this._root!==null){const t=[];this._root.search(e.time,t);for(const n of t)if(n.event===e){this._removeNode(n),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,t=>this.remove(t)),this}_setRoot(e){this._root=e,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(e,t){e.parent!==null?(e.isLeftChild()?e.parent.left=t:e.parent.right=t,this._rebalance(e.parent)):this._setRoot(t)}_removeNode(e){if(e.left===null&&e.right===null)this._replaceNodeInParent(e,null);else if(e.right===null)this._replaceNodeInParent(e,e.left);else if(e.left===null)this._replaceNodeInParent(e,e.right);else{const t=e.getBalance();let n,i=null;if(t>0)if(e.left.right===null)n=e.left,n.right=e.right,i=n;else{for(n=e.left.right;n.right!==null;)n=n.right;n.parent&&(n.parent.right=n.left,i=n.parent,n.left=e.left,n.right=e.right)}else if(e.right.left===null)n=e.right,n.left=e.left,i=n;else{for(n=e.right.left;n.left!==null;)n=n.left;n.parent&&(n.parent.left=n.right,i=n.parent,n.left=e.left,n.right=e.right)}e.parent!==null?e.isLeftChild()?e.parent.left=n:e.parent.right=n:this._setRoot(n),i&&this._rebalance(i)}e.dispose()}_rotateLeft(e){const t=e.parent,n=e.isLeftChild(),i=e.right;i&&(e.right=i.left,i.left=e),t!==null?n?t.left=i:t.right=i:this._setRoot(i)}_rotateRight(e){const t=e.parent,n=e.isLeftChild(),i=e.left;i&&(e.left=i.right,i.right=e),t!==null?n?t.left=i:t.right=i:this._setRoot(i)}_rebalance(e){const t=e.getBalance();t>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):t<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(this._root!==null){const t=[];if(this._root.search(e,t),t.length>0){let n=t[0];for(let i=1;i<t.length;i++)t[i].low>n.low&&(n=t[i]);return n.event}}return null}forEach(e){if(this._root!==null){const t=[];this._root.traverse(n=>t.push(n)),t.forEach(n=>{n.event&&e(n.event)})}return this}forEachAtTime(e,t){if(this._root!==null){const n=[];this._root.search(e,n),n.forEach(i=>{i.event&&t(i.event)})}return this}forEachFrom(e,t){if(this._root!==null){const n=[];this._root.searchAfter(e,n),n.forEach(i=>{i.event&&t(i.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(e=>e.dispose()),this._root=null,this}}class Hp{constructor(e,t,n){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=n,this.low=e,this.high=t,this.max=this.high}insert(e){e.low<=this.low?this.left===null?this.left=e:this.left.insert(e):this.right===null?this.right=e:this.right.insert(e)}search(e,t){e>this.max||(this.left!==null&&this.left.search(e,t),this.low<=e&&this.high>e&&t.push(this),!(this.low>e)&&this.right!==null&&this.right.search(e,t))}searchAfter(e,t){this.low>=e&&(t.push(this),this.left!==null&&this.left.searchAfter(e,t)),this.right!==null&&this.right.searchAfter(e,t)}traverse(e){e(this),this.left!==null&&this.left.traverse(e),this.right!==null&&this.right.traverse(e)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return this.left!==null&&this.right!==null?e=this.left.height-this.right.height:this.left!==null?e=this.left.height+1:this.right!==null&&(e=-(this.right.height+1)),e}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class zt extends I{constructor(){super(S(zt.getDefaults(),arguments,["volume"])),this.name="Volume";const e=S(zt.getDefaults(),arguments,["volume"]);this.input=this.output=new X({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,Y(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(I.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}let Yp=class Di extends I{constructor(){super(S(Di.getDefaults(),arguments)),this.name="Destination",this.input=new zt({context:this.context}),this.output=new X({context:this.context}),this.volume=this.input.volume;const e=S(Di.getDefaults(),arguments);fn(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(I.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),fn(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}};ai(s=>{s.destination=new Yp({context:s})});ci(s=>{s.destination.dispose()});class Qp extends bt{constructor(e){super(),this.name="TimelineValue",this._timeline=new at({memory:10}),this._initialValue=e}set(e,t){return this._timeline.add({value:e,time:t}),this}get(e){const t=this._timeline.get(e);return t?t.value:this._initialValue}}class Nt{constructor(e,t){this.id=Nt._eventId++;const n=Object.assign(Nt.getDefaults(),t);this.transport=e,this.callback=n.callback,this._once=n.once,this.time=n.time}static getDefaults(){return{callback:Q,once:!1,time:0}}invoke(e){this.callback&&(this.callback(e),this._once&&this.transport.clear(this.id))}dispose(){return this.callback=void 0,this}}Nt._eventId=0;class or extends Nt{constructor(e,t){super(e,t),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const n=Object.assign(or.getDefaults(),t);this.duration=new ht(e.context,n.duration).valueOf(),this._interval=new ht(e.context,n.interval).valueOf(),this._nextTick=n.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},Nt.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvents(e){const t=this.transport.getTicksAtTime(e);t>=this.time&&t>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new ht(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;const t=this.transport.getTicksAtTime(e);t>this.time&&(this._nextTick=this.time+Math.ceil((t-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new ht(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new ht(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}}let ca=class Ei extends Ee{constructor(){super(S(Ei.getDefaults(),arguments)),this.name="Transport",this._loop=new Qp(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new at,this._repeatedEvents=new Xp,this._syncedSignals=[],this._swingAmount=0;const e=S(Ei.getDefaults(),arguments);this._ppq=e.ppq,this._clock=new qn({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),Y(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(Ee.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,t){if(this._loop.get(e)&&t>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),t=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&t%this._ppq!==0&&t%(this._swingTicks*2)!==0){const n=t%(this._swingTicks*2)/(this._swingTicks*2),i=Math.sin(n*Math.PI)*this._swingAmount;e+=new ht(this.context,this._swingTicks*2/3).toSeconds()*i}this._timeline.forEachAtTime(t,n=>n.invoke(e))}schedule(e,t){const n=new Nt(this,{callback:e,time:new Rn(this.context,t).toTicks()});return this._addEvent(n,this._timeline)}scheduleRepeat(e,t,n,i=1/0){const r=new or(this,{callback:e,duration:new Ge(this.context,i).toTicks(),interval:new Ge(this.context,t).toTicks(),time:new Rn(this.context,n).toTicks()});return this._addEvent(r,this._repeatedEvents)}scheduleOnce(e,t){const n=new Nt(this,{callback:e,once:!0,time:new Rn(this.context,t).toTicks()});return this._addEvent(n,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const t=this._scheduledEvents[e.toString()];t.timeline.remove(t.event),t.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,t){return this._scheduledEvents[e.id.toString()]={event:e,timeline:t},t.add(e),e.id}cancel(e=0){const t=this.toTicks(e);return this._timeline.forEachFrom(t,n=>this.clear(n.id)),this._repeatedEvents.forEachFrom(t,n=>this.clear(n.id)),this}_bindClockEvents(){this._clock.on("start",(e,t)=>{t=new ht(this.context,t).toSeconds(),this.emit("start",e,t)}),this._clock.on("stop",e=>{this.emit("stop",e)}),this._clock.on("pause",e=>{this.emit("pause",e)})}get state(){return this._clock.getStateAtTime(this.now())}start(e,t){let n;return G(t)&&(n=this.toTicks(t)),this._clock.start(e,n),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),this._clock.getStateAtTime(e)!=="started"?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){Pe(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new Ge(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new Ge(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new ht(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),t=this._clock.getTicksAtTime(e);return new ht(this.context,t).toBarsBeatsSixteenths()}set position(e){const t=this.toTicks(e);this.ticks=t}get seconds(){return this._clock.seconds}set seconds(e){const t=this.now(),n=this._clock.frequency.timeToTicks(e,t);this.ticks=n}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const t=this.now();if(this.state==="started"){const n=this._clock.getTicksAtTime(t),i=this._clock.frequency.getDurationOfTicks(Math.ceil(n)-n,t),r=t+i;this.emit("stop",r),this._clock.setTicksAtTime(e,r),this.emit("start",r,this._clock.getSecondsAtTime(r))}else this._clock.setTicksAtTime(e,t)}}getTicksAtTime(e){return Math.round(this._clock.getTicksAtTime(e))}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),this.state!=="started")return 0;{const t=this.now(),n=this.getTicksAtTime(t),i=e-n%e;return this._clock.nextTickTime(i,t)}}syncSignal(e,t){if(!t){const i=this.now();if(e.getValueAtTime(i)!==0){const a=1/(60/this.bpm.getValueAtTime(i)/this.PPQ);t=e.getValueAtTime(i)/a}else t=0}const n=new X(t);return this.bpm.connect(n),n.connect(e._param),this._syncedSignals.push({initial:e.value,ratio:n,signal:e}),e.value=0,this}unsyncSignal(e){for(let t=this._syncedSignals.length-1;t>=0;t--){const n=this._syncedSignals[t];n.signal===e&&(n.ratio.dispose(),n.signal.value=n.initial,this._syncedSignals.splice(t,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),nr(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}};cs.mixin(ca);ai(s=>{s.transport=new ca({context:s})});ci(s=>{s.transport.dispose()});class _e extends I{constructor(e){super(e),this.input=void 0,this._state=new ir("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=Q,this._syncedStop=Q,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new zt({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,Y(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(I.getDefaults(),{mute:!1,onstop:Q,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,t,n){let i=We(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(i=this._clampToCurrentTime(i),!this._synced&&this._state.getValueAtTime(i)==="started")L(Es(i,this._state.get(i).time),"Start time must be strictly greater than previous start time"),this._state.cancel(i),this._state.setStateAtTime("started",i),this.log("restart",i),this.restart(i,t,n);else if(this.log("start",i),this._state.setStateAtTime("started",i),this._synced){const r=this._state.get(i);r&&(r.offset=this.toSeconds(ln(t,0)),r.duration=n?this.toSeconds(n):void 0);const a=this.context.transport.schedule(o=>{this._start(o,t,n)},i);this._scheduled.push(a),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>i&&this._syncedStart(this.now(),this.context.transport.seconds)}else Xo(this.context),this._start(i,t,n);return this}stop(e){let t=We(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(t=this._clampToCurrentTime(t),this._state.getValueAtTime(t)==="started"||G(this._state.getNextState("started",t))){if(this.log("stop",t),!this._synced)this._stop(t);else{const n=this.context.transport.schedule(this._stop.bind(this),t);this._scheduled.push(n)}this._state.cancel(t),this._state.setStateAtTime("stopped",t)}return this}restart(e,t,n){return e=this.toSeconds(e),this._state.getValueAtTime(e)==="started"&&(this._state.cancel(e),this._restart(e,t,n)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,t)=>{if(t>0){const n=this._state.get(t);if(n&&n.state==="started"&&n.time!==t){const i=t-this.toSeconds(n.time);let r;n.duration&&(r=this.toSeconds(n.duration)-i),this._start(e,this.toSeconds(n.offset)+i,r)}}},this._syncedStop=e=>{const t=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));this._state.getValueAtTime(t)==="started"&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(e=>this.context.transport.clear(e)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=Q,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class gn extends mn{constructor(){super(S(gn.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const e=S(gn.getDefaults(),arguments,["url","onload"]);yt(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new z({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new J(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(mn.getDefaults(),{url:new J,loop:!1,loopEnd:0,loopStart:0,onload:Q,onerror:Q,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,t,n,i=1){L(this.buffer.loaded,"buffer is either not set or not loaded");const r=this.toSeconds(e);this._startGain(r,i),this.loop?t=ln(t,this.loopStart):t=ln(t,0);let a=Math.max(this.toSeconds(t),0);if(this.loop){const o=this.toSeconds(this.loopEnd)||this.buffer.duration,c=this.toSeconds(this.loopStart),l=o-c;Oi(a,o)&&(a=(a-c)%l+c),$e(a,this.buffer.duration)&&(a=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,Qo(a,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(r,a)),G(n)){let o=this.toSeconds(n);o=Math.max(o,0),this.stop(r+o)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class Ot extends _e{constructor(){super(S(Ot.getDefaults(),arguments,["type"])),this.name="Noise",this._source=null;const e=S(Ot.getDefaults(),arguments,["type"]);this._playbackRate=e.playbackRate,this.type=e.type,this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut}static getDefaults(){return Object.assign(_e.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(e){if(L(e in Vr,"Noise: invalid type: "+e),this._type!==e&&(this._type=e,this.state==="started")){const t=this.now();this._stop(t),this._start(t)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._source&&(this._source.playbackRate.value=e)}_start(e){const t=Vr[this._type];this._source=new gn({url:t,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(e),Math.random()*(t.duration-.001))}_stop(e){this._source&&(this._source.stop(this.toSeconds(e)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(e){this._stop(e),this._start(e)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const rn=44100*5,gi=2,ct={brown:null,pink:null,white:null},Vr={get brown(){if(!ct.brown){const s=[];for(let e=0;e<gi;e++){const t=new Float32Array(rn);s[e]=t;let n=0;for(let i=0;i<rn;i++){const r=Math.random()*2-1;t[i]=(n+.02*r)/1.02,n=t[i],t[i]*=3.5}}ct.brown=new J().fromArray(s)}return ct.brown},get pink(){if(!ct.pink){const s=[];for(let e=0;e<gi;e++){const t=new Float32Array(rn);s[e]=t;let n,i,r,a,o,c,l;n=i=r=a=o=c=l=0;for(let u=0;u<rn;u++){const h=Math.random()*2-1;n=.99886*n+h*.0555179,i=.99332*i+h*.0750759,r=.969*r+h*.153852,a=.8665*a+h*.3104856,o=.55*o+h*.5329522,c=-.7616*c-h*.016898,t[u]=n+i+r+a+o+c+l+h*.5362,t[u]*=.11,l=h*.115926}}ct.pink=new J().fromArray(s)}return ct.pink},get white(){if(!ct.white){const s=[];for(let e=0;e<gi;e++){const t=new Float32Array(rn);s[e]=t;for(let n=0;n<rn;n++)t[n]=Math.random()*2-1}ct.white=new J().fromArray(s)}return ct.white}};function en(s,e){return de(this,void 0,void 0,function*(){const t=e/s.context.sampleRate,n=new li(1,t,s.context.sampleRate);return new s.constructor(Object.assign(s.get(),{frequency:2/t,detune:0,context:n})).toDestination().start(0),(yield n.render()).getChannelData(0)})}class Ps extends mn{constructor(){super(S(Ps.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const e=S(Ps.getDefaults(),arguments,["frequency","type"]);yt(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new z({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new z({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),Y(this,["frequency","detune"])}static getDefaults(){return Object.assign(mn.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._oscillator.start(t),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class ce extends _e{constructor(){super(S(ce.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const e=S(ce.getDefaults(),arguments,["frequency","type"]);this.frequency=new Z({context:this.context,units:"frequency",value:e.frequency}),Y(this,"frequency"),this.detune=new Z({context:this.context,units:"cents",value:e.detune}),Y(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&e.type!=="custom"&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(_e.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){const t=this.toSeconds(e),n=new Ps({context:this.context,onended:()=>this.onstop(this)});this._oscillator=n,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(t)}_stop(e){const t=this.toSeconds(e);this._oscillator&&this._oscillator.stop(t)}_restart(e){const t=this.toSeconds(e);return this.log("restart",t),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(t),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return ce._periodicWaveCache.find(t=>t.phase===this._phase&&Vp(t.partials,this._partials));{const e=ce._periodicWaveCache.find(t=>t.type===this._type&&t.phase===this._phase);return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const t=["sine","square","sawtooth","triangle"].indexOf(e)!==-1;if(this._phase===0&&t)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=e);else{const n=this._getCachedPeriodicWave();if(G(n)){const{partials:i,wave:r}=n;this._wave=r,this._partials=i,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[i,r]=this._getRealImaginary(e,this._phase),a=this.context.createPeriodicWave(i,r);this._wave=a,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),ce._periodicWaveCache.push({imag:r,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:i,type:this._type,wave:this._wave}),ce._periodicWaveCache.length>100&&ce._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&this._type!=="custom"&&e!=="custom"?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){Xe(e,0);let t=this._type;const n=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(n&&(t=n[1]),this._type!=="custom")e===0?this.type=t:this.type=t+e.toString();else{const i=new Float32Array(e);this._partials.forEach((r,a)=>i[a]=r),this._partials=Array.from(i),this.type=this._type}}_getRealImaginary(e,t){let i=2048;const r=new Float32Array(i),a=new Float32Array(i);let o=1;if(e==="custom"){if(o=this._partials.length+1,this._partialCount=this._partials.length,i=o,this._partials.length===0)return[r,a]}else{const c=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);c?(o=parseInt(c[2],10)+1,this._partialCount=parseInt(c[2],10),e=c[1],o=Math.max(o,2),i=o):this._partialCount=0,this._partials=[]}for(let c=1;c<i;++c){const l=2/(c*Math.PI);let u;switch(e){case"sine":u=c<=o?1:0,this._partials[c-1]=u;break;case"square":u=c&1?2*l:0,this._partials[c-1]=u;break;case"sawtooth":u=l*(c&1?1:-1),this._partials[c-1]=u;break;case"triangle":c&1?u=2*(l*l)*(c-1>>1&1?-1:1):u=0,this._partials[c-1]=u;break;case"custom":u=this._partials[c-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}u!==0?(r[c]=-u*Math.sin(t*c),a[c]=u*Math.cos(t*c)):(r[c]=0,a[c]=0)}return[r,a]}_inverseFFT(e,t,n){let i=0;const r=e.length;for(let a=0;a<r;a++)i+=e[a]*Math.cos(a*n)+t[a]*Math.sin(a*n);return i}getInitialValue(){const[e,t]=this._getRealImaginary(this._type,0);let n=0;const i=Math.PI*2,r=32;for(let a=0;a<r;a++)n=Math.max(this._inverseFFT(e,t,a/r*i),n);return Pp(-this._inverseFFT(e,t,this._phase)/n,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(e=1024){return de(this,void 0,void 0,function*(){return en(this,e)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}ce._periodicWaveCache=[];class st extends I{constructor(){super(Object.assign(S(st.getDefaults(),arguments,["context"])))}connect(e,t=0,n=0){return hi(this,e,t,n),this}}class Zt extends st{constructor(){super(Object.assign(S(Zt.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const e=S(Zt.getDefaults(),arguments,["mapping","length"]);Pe(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):Ap(e.mapping)&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(Z.getDefaults(),{length:1024})}setMap(e,t=1024){const n=new Float32Array(t);for(let i=0,r=t;i<r;i++){const a=i/(r-1)*2-1;n[i]=e(a,i)}return this.curve=n,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){const t=["none","2x","4x"].some(n=>n.includes(e));L(t,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class ar extends st{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new Zt({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Be extends Z{constructor(){super(Object.assign(S(Be.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const e=S(Be.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new X({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Z.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class Ln extends _e{constructor(){super(S(Ln.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new ar({context:this.context}),this._modulationNode=new X({context:this.context});const e=S(Ln.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new ce({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new ce({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Be({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),Y(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(ce.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(e=1024){return de(this,void 0,void 0,function*(){return en(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class _n extends _e{constructor(){super(S(_n.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new X({context:this.context,gain:0});const e=S(_n.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new ce({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new Z({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new ce({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Be({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new Be({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),Y(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(ce.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(e=1024){return de(this,void 0,void 0,function*(){return en(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class yn extends _e{constructor(){super(S(yn.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new X({context:this.context,gain:0}),this._thresh=new Zt({context:this.context,mapping:t=>t<=0?-1:1});const e=S(yn.getDefaults(),arguments,["frequency","width"]);this.width=new Z({context:this.context,units:"audioRange",value:e.width}),this._triangle=new ce({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),Y(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(_e.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(e=1024){return de(this,void 0,void 0,function*(){return en(this,e)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class Wn extends _e{constructor(){super(S(Wn.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const e=S(Wn.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new Z({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Z({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,Y(this,["frequency","detune"])}static getDefaults(){return Object.assign(ce.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach(t=>t.start(e))}_stop(e){e=this.toSeconds(e),this._forEach(t=>t.stop(e))}_restart(e){this._forEach(t=>t.restart(e))}_forEach(e){for(let t=0;t<this._oscillators.length;t++)e(this._oscillators[t],t)}get type(){return this._type}set type(e){this._type=e,this._forEach(t=>t.type=e)}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){const t=-e/2,n=e/(this._oscillators.length-1);this._forEach((i,r)=>i.detune.value=t+n*r)}}get count(){return this._oscillators.length}set count(e){if(Xe(e,1),this._oscillators.length!==e){this._forEach(t=>t.dispose()),this._oscillators=[];for(let t=0;t<e;t++){const n=new ce({context:this.context,volume:-6-e*1.1,type:this._type,phase:this._phase+t/e*360,partialCount:this._partialCount,onstop:t===0?()=>this.onstop(this):Q});this.type==="custom"&&(n.partials=this._partials),this.frequency.connect(n.frequency),this.detune.connect(n.detune),n.detune.overridden=!1,n.connect(this.output),this._oscillators[t]=n}this.spread=this._spread,this.state==="started"&&this._forEach(t=>t.start())}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach((t,n)=>t.phase=this._phase+n/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach(t=>t.baseType=e),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach(t=>t.partials=e))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach(t=>t.partialCount=e),this._type=this._oscillators[0].type}asArray(e=1024){return de(this,void 0,void 0,function*(){return en(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(e=>e.dispose()),this}}class jn extends _e{constructor(){super(S(jn.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Be({context:this.context,value:2});const e=S(jn.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new yn({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new ce({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),Y(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(_e.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(e=1024){return de(this,void 0,void 0,function*(){return en(this,e)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const Fr={am:Ln,fat:Wn,fm:_n,oscillator:ce,pulse:yn,pwm:jn};class vt extends _e{constructor(){super(S(vt.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const e=S(vt.getDefaults(),arguments,["frequency","type"]);this.frequency=new Z({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Z({context:this.context,units:"cents",value:e.detune}),Y(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(ce.getDefaults(),_n.getDefaults(),Ln.getDefaults(),Wn.getDefaults(),yn.getDefaults(),jn.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some(t=>this._sourceType===t)&&(e=this._sourceType),e+this._oscillator.type}set type(e){e.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):e==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):e==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;const t=Fr[e],n=this.now();if(this._oscillator){const i=this._oscillator;i.stop(n),this.context.setTimeout(()=>i.dispose(),this.blockTime)}this._oscillator=new t({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(n)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let t="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(t=this._oscillator.type),e==="fm"?this.type="fm"+t:e==="am"?this.type="am"+t:e==="fat"?this.type="fat"+t:e==="oscillator"?this.type=t:e==="pulse"?this.type="pulse":e==="pwm"&&(this.type="pwm")}_getOscType(e,t){return e instanceof Fr[t]}get baseType(){return this._oscillator.baseType}set baseType(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&e!=="pulse"&&e!=="pwm"&&(this._oscillator.baseType=e)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(e){this._getOscType(this._oscillator,"fat")&&_t(e)&&(this._oscillator.count=e)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(e){this._getOscType(this._oscillator,"fat")&&_t(e)&&(this._oscillator.spread=e)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&nt(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(e=1024){return de(this,void 0,void 0,function*(){return en(this,e)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class cr extends Z{constructor(){super(Object.assign(S(cr.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Add",this._sum=new X({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,fn(this._constantSource,this._sum)}static getDefaults(){return Object.assign(Z.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class vn extends st{constructor(){super(Object.assign(S(vn.getDefaults(),arguments,["min","max"]))),this.name="Scale";const e=S(vn.getDefaults(),arguments,["min","max"]);this._mult=this.input=new Be({context:this.context,value:e.max-e.min}),this._add=this.output=new cr({context:this.context,value:e.min}),this._min=e.min,this._max=e.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(st.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(e){this._min=e,this._setRange()}get max(){return this._max}set max(e){this._max=e,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class lr extends st{constructor(){super(Object.assign(S(lr.getDefaults(),arguments))),this.name="Zero",this._gain=new X({context:this.context}),this.output=this._gain,this.input=void 0,yt(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),aa(this.context.getConstant(0),this._gain),this}}class Bn extends I{constructor(){super(S(Bn.getDefaults(),arguments,["frequency","min","max"])),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=z.prototype._fromType,this._toType=z.prototype._toType,this._is=z.prototype._is,this._clampValue=z.prototype._clampValue;const e=S(Bn.getDefaults(),arguments,["frequency","min","max"]);this._oscillator=new ce(e),this.frequency=this._oscillator.frequency,this._amplitudeGain=new X({context:this.context,gain:e.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new Z({context:this.context,units:"audioRange",value:0}),this._zeros=new lr({context:this.context}),this._a2g=new ar({context:this.context}),this._scaler=this.output=new vn({context:this.context,max:e.max,min:e.min}),this.units=e.units,this.min=e.min,this.max=e.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),Y(this,["amplitude","frequency"]),this.phase=e.phase}static getDefaults(){return Object.assign(ce.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(0,e),this._oscillator.start(e),this}stop(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(this._stoppedValue,e),this._oscillator.stop(e),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(e){e=this._fromType(e),this._scaler.min=e}get max(){return this._toType(this._scaler.max)}set max(e){e=this._fromType(e),this._scaler.max=e}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(e){this._oscillator.partials=e,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e,this._setStoppedValue()}get units(){return this._units}set units(e){const t=this.min,n=this.max;this._units=e,this.min=t,this.max=n}get state(){return this._oscillator.state}connect(e,t,n){return(e instanceof z||e instanceof Z)&&(this.convert=e.convert,this.units=e.units),hi(this,e,t,n),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function la(s,e=1/0){const t=new WeakMap;return function(n,i){Reflect.defineProperty(n,i,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(r){Xe(r,s,e),t.set(this,r)}})}}function Tt(s,e=1/0){const t=new WeakMap;return function(n,i){Reflect.defineProperty(n,i,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(r){Xe(this.toSeconds(r),s,e),t.set(this,r)}})}}class $n extends _e{constructor(){super(S($n.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const e=S($n.getDefaults(),arguments,["url","onload"]);this._buffer=new J({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(_e.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:Q,onerror:Q,playbackRate:1,reverse:!1})}load(e){return de(this,void 0,void 0,function*(){return yield this._buffer.load(e),this._onload(),this})}_onload(e=Q){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,t,n){return super.start(e,t,n),this}_start(e,t,n){this._loop?t=ln(t,this._loopStart):t=ln(t,0);const i=this.toSeconds(t),r=n;n=ln(n,Math.max(this._buffer.duration-i,0));let a=this.toSeconds(n);a=a/this._playbackRate,e=this.toSeconds(e);const o=new gn({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(e+a),this._state.setStateAtTime("stopped",e+a,{implicitEnd:!0})),this._activeSources.add(o),this._loop&&We(r)?o.start(e,i):o.start(e,i,a-this.toSeconds(this.fadeOut))}_stop(e){const t=this.toSeconds(e);this._activeSources.forEach(n=>n.stop(t))}restart(e,t,n){return super.restart(e,t,n),this}_restart(e,t,n){this._stop(e),this._start(e,t,n)}seek(e,t){const n=this.toSeconds(t);if(this._state.getValueAtTime(n)==="started"){const i=this.toSeconds(e);this._stop(n),this._start(n,i)}return this}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&Xe(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopStart=e})}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&Xe(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopEnd=e})}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach(t=>{t.loop=e}),e)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const t=this.now(),n=this._state.getNextState("stopped",t);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach(i=>i.cancelStop())),this._activeSources.forEach(i=>{i.playbackRate.setValueAtTime(e,t)})}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(e=>e.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}Je([Tt(0)],$n.prototype,"fadeIn",void 0);Je([Tt(0)],$n.prototype,"fadeOut",void 0);class Jp extends st{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new Zt({context:this.context,mapping:e=>Math.abs(e)*2-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class qs extends st{constructor(){super(Object.assign(S(qs.getDefaults(),arguments,["value"]))),this.name="Pow";const e=S(qs.getDefaults(),arguments,["value"]);this._exponentScaler=this.input=this.output=new Zt({context:this.context,mapping:this._expFunc(e.value),length:8192}),this._exponent=e.value}static getDefaults(){return Object.assign(st.getDefaults(),{value:1})}_expFunc(e){return t=>Math.pow(Math.abs(t),e)}get value(){return this._exponent}set value(e){this._exponent=e,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class be extends I{constructor(){super(S(be.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new Z({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const e=S(be.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(I.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,t){if(nt(e))return e;{let n;for(n in ps)if(ps[n][t]===e)return n;return e}}_setCurve(e,t,n){if(nt(n)&&Reflect.has(ps,n)){const i=ps[n];Wt(i)?e!=="_decayCurve"&&(this[e]=i[t]):this[e]=i}else if(Pe(n)&&e!=="_decayCurve")this[e]=n;else throw new Error("Envelope: invalid curve: "+n)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._decayCurve}set decayCurve(e){L(["linear","exponential"].some(t=>t===e),`Invalid envelope curve: ${e}`),this._decayCurve=e}triggerAttack(e,t=1){this.log("triggerAttack",e,t),e=this.toSeconds(e);let i=this.toSeconds(this.attack);const r=this.toSeconds(this.decay),a=this.getValueAtTime(e);if(a>0){const o=1/i;i=(1-a)/o}if(i<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(t,e);else if(this._attackCurve==="linear")this._sig.linearRampTo(t,i,e);else if(this._attackCurve==="exponential")this._sig.targetRampTo(t,i,e);else{this._sig.cancelAndHoldAtTime(e);let o=this._attackCurve;for(let c=1;c<o.length;c++)if(o[c-1]<=a&&a<=o[c]){o=this._attackCurve.slice(c),o[0]=a;break}this._sig.setValueCurveAtTime(o,e,i,t)}if(r&&this.sustain<1){const o=t*this.sustain,c=e+i;this.log("decay",c),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(o,r+c):this._sig.exponentialApproachValueAtTime(o,c,r)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const t=this.getValueAtTime(e);if(t>0){const n=this.toSeconds(this.release);n<this.sampleTime?this._sig.setValueAtTime(0,e):this._releaseCurve==="linear"?this._sig.linearRampTo(0,n,e):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,n,e):(L(Pe(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,n,t))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,t,n=1){return t=this.toSeconds(t),this.triggerAttack(t,n),this.triggerRelease(t+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,t=0,n=0){return hi(this,e,t,n),this}asArray(e=1024){return de(this,void 0,void 0,function*(){const t=e/this.context.sampleRate,n=new li(1,t,this.context.sampleRate),i=this.toSeconds(this.attack)+this.toSeconds(this.decay),r=i+this.toSeconds(this.release),a=r*.1,o=r+a,c=new this.constructor(Object.assign(this.get(),{attack:t*this.toSeconds(this.attack)/o,decay:t*this.toSeconds(this.decay)/o,release:t*this.toSeconds(this.release)/o,context:n}));return c._sig.toDestination(),c.triggerAttackRelease(t*(i+a)/o,0),(yield n.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}Je([Tt(0)],be.prototype,"attack",void 0);Je([Tt(0)],be.prototype,"decay",void 0);Je([la(0,1)],be.prototype,"sustain",void 0);Je([Tt(0)],be.prototype,"release",void 0);const ps=(()=>{let e,t;const n=[];for(e=0;e<128;e++)n[e]=Math.sin(e/127*(Math.PI/2));const i=[],r=6.4;for(e=0;e<127;e++){t=e/127;const d=Math.sin(t*(Math.PI*2)*r-Math.PI/2)+1;i[e]=d/10+t*.83}i[127]=1;const a=[],o=5;for(e=0;e<128;e++)a[e]=Math.ceil(e/127*o)/o;const c=[];for(e=0;e<128;e++)t=e/127,c[e]=.5*(1-Math.cos(Math.PI*t));const l=[];for(e=0;e<128;e++){t=e/127;const d=Math.pow(t,3)*4+.2,f=Math.cos(d*Math.PI*2*t);l[e]=Math.abs(f*(1-t))}function u(d){const f=new Array(d.length);for(let p=0;p<d.length;p++)f[p]=1-d[p];return f}function h(d){return d.slice(0).reverse()}return{bounce:{In:u(l),Out:l},cosine:{In:n,Out:h(n)},exponential:"exponential",linear:"linear",ripple:{In:i,Out:u(i)},sine:{In:c,Out:u(c)},step:{In:a,Out:u(a)}}})();class qe extends I{constructor(){super(S(qe.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;const e=S(qe.getDefaults(),arguments);this._volume=this.output=new zt({context:this.context,volume:e.volume}),this.volume=this._volume.volume,Y(this,"volume")}static getDefaults(){return Object.assign(I.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,t){const n=this["_original_"+e]=this[e];this[e]=(...i)=>{const r=i[t],a=this.context.transport.schedule(o=>{i[t]=o,n.apply(this,i)},r);this._scheduledEvents.push(a)}}unsync(){return this._scheduledEvents.forEach(e=>this.context.transport.clear(e)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(e,t,n,i){const r=this.toSeconds(n),a=this.toSeconds(t);return this.triggerAttack(e,r,i),this.triggerRelease(r+a),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class we extends qe{constructor(){super(S(we.getDefaults(),arguments));const e=S(we.getDefaults(),arguments);this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(qe.getDefaults(),{detune:0,onsilence:Q,portamento:0})}triggerAttack(e,t,n=1){this.log("triggerAttack",e,t,n);const i=this.toSeconds(t);return this._triggerEnvelopeAttack(i,n),this.setNote(e,i),this}triggerRelease(e){this.log("triggerRelease",e);const t=this.toSeconds(e);return this._triggerEnvelopeRelease(t),this}setNote(e,t){const n=this.toSeconds(t),i=e instanceof Fe?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(n)>.05){const r=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(i,r,n)}else this.frequency.setValueAtTime(i,n);return this}}Je([Tt(0)],we.prototype,"portamento",void 0);class ls extends be{constructor(){super(S(ls.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new X({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Ie extends we{constructor(){super(S(Ie.getDefaults(),arguments)),this.name="Synth";const e=S(Ie.getDefaults(),arguments);this.oscillator=new vt(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new ls(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),Y(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(we.getDefaults(),{envelope:Object.assign(xe(be.getDefaults(),Object.keys(I.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(xe(vt.getDefaults(),[...Object.keys(_e.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,t){if(this.envelope.triggerAttack(e,t),this.oscillator.start(e),this.envelope.sustain===0){const n=this.toSeconds(this.envelope.attack),i=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+n+i)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class wn extends we{constructor(){super(S(wn.getDefaults(),arguments)),this.name="ModulationSynth";const e=S(wn.getDefaults(),arguments);this._carrier=new Ie({context:this.context,oscillator:e.oscillator,envelope:e.envelope,onsilence:()=>this.onsilence(this),volume:-10}),this._modulator=new Ie({context:this.context,oscillator:e.modulation,envelope:e.modulationEnvelope,volume:-10}),this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope,this.modulation=this._modulator.oscillator,this.modulationEnvelope=this._modulator.envelope,this.frequency=new Z({context:this.context,units:"frequency"}),this.detune=new Z({context:this.context,value:e.detune,units:"cents"}),this.harmonicity=new Be({context:this.context,value:e.harmonicity,minValue:0}),this._modulationNode=new X({context:this.context,gain:0}),Y(this,["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])}static getDefaults(){return Object.assign(we.getDefaults(),{harmonicity:3,oscillator:Object.assign(xe(vt.getDefaults(),[...Object.keys(_e.getDefaults()),"frequency","detune"]),{type:"sine"}),envelope:Object.assign(xe(be.getDefaults(),Object.keys(I.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),modulation:Object.assign(xe(vt.getDefaults(),[...Object.keys(_e.getDefaults()),"frequency","detune"]),{type:"square"}),modulationEnvelope:Object.assign(xe(be.getDefaults(),Object.keys(I.getDefaults())),{attack:.5,decay:0,sustain:1,release:.5})})}_triggerEnvelopeAttack(e,t){this._carrier._triggerEnvelopeAttack(e,t),this._modulator._triggerEnvelopeAttack(e,t)}_triggerEnvelopeRelease(e){return this._carrier._triggerEnvelopeRelease(e),this._modulator._triggerEnvelopeRelease(e),this}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this._carrier.dispose(),this._modulator.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._modulationNode.dispose(),this}}class di extends wn{constructor(){super(S(di.getDefaults(),arguments)),this.name="AMSynth",this._modulationScale=new ar({context:this.context}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output)}dispose(){return super.dispose(),this._modulationScale.dispose(),this}}class Un extends I{constructor(){super(S(Un.getDefaults(),arguments,["frequency","type"])),this.name="BiquadFilter";const e=S(Un.getDefaults(),arguments,["frequency","type"]);this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new z({context:this.context,units:"number",value:e.Q,param:this._filter.Q}),this.frequency=new z({context:this.context,units:"frequency",value:e.frequency,param:this._filter.frequency}),this.detune=new z({context:this.context,units:"cents",value:e.detune,param:this._filter.detune}),this.gain=new z({context:this.context,units:"decibels",convert:!1,value:e.gain,param:this._filter.gain}),this.type=e.type}static getDefaults(){return Object.assign(I.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(e){L(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._filter.type=e}getFrequencyResponse(e=128){const t=new Float32Array(e);for(let a=0;a<e;a++){const c=Math.pow(a/e,2)*19980+20;t[a]=c}const n=new Float32Array(e),i=new Float32Array(e),r=this.context.createBiquadFilter();return r.type=this.type,r.Q.value=this.Q.value,r.frequency.value=this.frequency.value,r.gain.value=this.gain.value,r.getFrequencyResponse(t,n,i),n}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class Dt extends I{constructor(){super(S(Dt.getDefaults(),arguments,["frequency","type","rolloff"])),this.name="Filter",this.input=new X({context:this.context}),this.output=new X({context:this.context}),this._filters=[];const e=S(Dt.getDefaults(),arguments,["frequency","type","rolloff"]);this._filters=[],this.Q=new Z({context:this.context,units:"positive",value:e.Q}),this.frequency=new Z({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Z({context:this.context,units:"cents",value:e.detune}),this.gain=new Z({context:this.context,units:"decibels",convert:!1,value:e.gain}),this._type=e.type,this.rolloff=e.rolloff,Y(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(I.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(e){L(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._type=e,this._filters.forEach(n=>n.type=e)}get rolloff(){return this._rolloff}set rolloff(e){const t=_t(e)?e:parseInt(e,10),n=[-12,-24,-48,-96];let i=n.indexOf(t);L(i!==-1,`rolloff can only be ${n.join(", ")}`),i+=1,this._rolloff=t,this.input.disconnect(),this._filters.forEach(r=>r.disconnect()),this._filters=new Array(i);for(let r=0;r<i;r++){const a=new Un({context:this.context});a.type=this._type,this.frequency.connect(a.frequency),this.detune.connect(a.detune),this.Q.connect(a.Q),this.gain.connect(a.gain),this._filters[r]=a}this._internalChannels=this._filters,fn(this.input,...this._internalChannels,this.output)}getFrequencyResponse(e=128){const t=new Un({frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),n=new Float32Array(e).map(()=>1);return this._filters.forEach(()=>{t.getFrequencyResponse(e).forEach((r,a)=>n[a]*=r)}),t.dispose(),n}dispose(){return super.dispose(),this._filters.forEach(e=>{e.dispose()}),nr(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class Gn extends be{constructor(){super(S(Gn.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="FrequencyEnvelope";const e=S(Gn.getDefaults(),arguments,["attack","decay","sustain","release"]);this._octaves=e.octaves,this._baseFrequency=this.toFrequency(e.baseFrequency),this._exponent=this.input=new qs({context:this.context,value:e.exponent}),this._scale=this.output=new vn({context:this.context,min:this._baseFrequency,max:this._baseFrequency*Math.pow(2,this._octaves)}),this._sig.chain(this._exponent,this._scale)}static getDefaults(){return Object.assign(be.getDefaults(),{baseFrequency:200,exponent:1,octaves:4})}get baseFrequency(){return this._baseFrequency}set baseFrequency(e){const t=this.toFrequency(e);Xe(t,0),this._baseFrequency=t,this._scale.min=this._baseFrequency,this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(e){this._octaves=e,this._scale.max=this._baseFrequency*Math.pow(2,e)}get exponent(){return this._exponent.value}set exponent(e){this._exponent.value=e}dispose(){return super.dispose(),this._exponent.dispose(),this._scale.dispose(),this}}class dt extends we{constructor(){super(S(dt.getDefaults(),arguments)),this.name="MonoSynth";const e=S(dt.getDefaults(),arguments);this.oscillator=new vt(Object.assign(e.oscillator,{context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)})),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new Dt(Object.assign(e.filter,{context:this.context})),this.filterEnvelope=new Gn(Object.assign(e.filterEnvelope,{context:this.context})),this.envelope=new ls(Object.assign(e.envelope,{context:this.context})),this.oscillator.chain(this.filter,this.envelope,this.output),this.filterEnvelope.connect(this.filter.frequency),Y(this,["oscillator","frequency","detune","filter","filterEnvelope","envelope"])}static getDefaults(){return Object.assign(we.getDefaults(),{envelope:Object.assign(xe(be.getDefaults(),Object.keys(I.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.9}),filter:Object.assign(xe(Dt.getDefaults(),Object.keys(I.getDefaults())),{Q:1,rolloff:-12,type:"lowpass"}),filterEnvelope:Object.assign(xe(Gn.getDefaults(),Object.keys(I.getDefaults())),{attack:.6,baseFrequency:200,decay:.2,exponent:2,octaves:3,release:2,sustain:.5}),oscillator:Object.assign(xe(vt.getDefaults(),Object.keys(_e.getDefaults())),{type:"sawtooth"})})}_triggerEnvelopeAttack(e,t=1){if(this.envelope.triggerAttack(e,t),this.filterEnvelope.triggerAttack(e),this.oscillator.start(e),this.envelope.sustain===0){const n=this.toSeconds(this.envelope.attack),i=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+n+i)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.filterEnvelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this.filterEnvelope.dispose(),this.filter.dispose(),this}}class zn extends we{constructor(){super(S(zn.getDefaults(),arguments)),this.name="DuoSynth";const e=S(zn.getDefaults(),arguments);this.voice0=new dt(Object.assign(e.voice0,{context:this.context,onsilence:()=>this.onsilence(this)})),this.voice1=new dt(Object.assign(e.voice1,{context:this.context})),this.harmonicity=new Be({context:this.context,units:"positive",value:e.harmonicity}),this._vibrato=new Bn({frequency:e.vibratoRate,context:this.context,min:-50,max:50}),this._vibrato.start(),this.vibratoRate=this._vibrato.frequency,this._vibratoGain=new X({context:this.context,units:"normalRange",gain:e.vibratoAmount}),this.vibratoAmount=this._vibratoGain.gain,this.frequency=new Z({context:this.context,units:"frequency",value:440}),this.detune=new Z({context:this.context,units:"cents",value:e.detune}),this.frequency.connect(this.voice0.frequency),this.frequency.chain(this.harmonicity,this.voice1.frequency),this._vibrato.connect(this._vibratoGain),this._vibratoGain.fan(this.voice0.detune,this.voice1.detune),this.detune.fan(this.voice0.detune,this.voice1.detune),this.voice0.connect(this.output),this.voice1.connect(this.output),Y(this,["voice0","voice1","frequency","vibratoAmount","vibratoRate"])}getLevelAtTime(e){return e=this.toSeconds(e),this.voice0.envelope.getValueAtTime(e)+this.voice1.envelope.getValueAtTime(e)}static getDefaults(){return je(we.getDefaults(),{vibratoAmount:.5,vibratoRate:5,harmonicity:1.5,voice0:je(xe(dt.getDefaults(),Object.keys(we.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}}),voice1:je(xe(dt.getDefaults(),Object.keys(we.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}})})}_triggerEnvelopeAttack(e,t){this.voice0._triggerEnvelopeAttack(e,t),this.voice1._triggerEnvelopeAttack(e,t)}_triggerEnvelopeRelease(e){return this.voice0._triggerEnvelopeRelease(e),this.voice1._triggerEnvelopeRelease(e),this}dispose(){return super.dispose(),this.voice0.dispose(),this.voice1.dispose(),this.frequency.dispose(),this.detune.dispose(),this._vibrato.dispose(),this.vibratoRate.dispose(),this._vibratoGain.dispose(),this.harmonicity.dispose(),this}}class Zn extends wn{constructor(){super(S(Zn.getDefaults(),arguments)),this.name="FMSynth";const e=S(Zn.getDefaults(),arguments);this.modulationIndex=new Be({context:this.context,value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output)}static getDefaults(){return Object.assign(wn.getDefaults(),{modulationIndex:10})}dispose(){return super.dispose(),this.modulationIndex.dispose(),this}}const Pr=[1,1.483,1.932,2.546,2.63,3.897];class Xn extends we{constructor(){super(S(Xn.getDefaults(),arguments)),this.name="MetalSynth",this._oscillators=[],this._freqMultipliers=[];const e=S(Xn.getDefaults(),arguments);this.detune=new Z({context:this.context,units:"cents",value:e.detune}),this.frequency=new Z({context:this.context,units:"frequency"}),this._amplitude=new X({context:this.context,gain:0}).connect(this.output),this._highpass=new Dt({Q:0,context:this.context,type:"highpass"}).connect(this._amplitude);for(let t=0;t<Pr.length;t++){const n=new _n({context:this.context,harmonicity:e.harmonicity,modulationIndex:e.modulationIndex,modulationType:"square",onstop:t===0?()=>this.onsilence(this):Q,type:"square"});n.connect(this._highpass),this._oscillators[t]=n;const i=new Be({context:this.context,value:Pr[t]});this._freqMultipliers[t]=i,this.frequency.chain(i,n.frequency),this.detune.connect(n.detune)}this._filterFreqScaler=new vn({context:this.context,max:7e3,min:this.toFrequency(e.resonance)}),this.envelope=new be({attack:e.envelope.attack,attackCurve:"linear",context:this.context,decay:e.envelope.decay,release:e.envelope.release,sustain:0}),this.envelope.chain(this._filterFreqScaler,this._highpass.frequency),this.envelope.connect(this._amplitude.gain),this._octaves=e.octaves,this.octaves=e.octaves}static getDefaults(){return je(we.getDefaults(),{envelope:Object.assign(xe(be.getDefaults(),Object.keys(I.getDefaults())),{attack:.001,decay:1.4,release:.2}),harmonicity:5.1,modulationIndex:32,octaves:1.5,resonance:4e3})}_triggerEnvelopeAttack(e,t=1){return this.envelope.triggerAttack(e,t),this._oscillators.forEach(n=>n.start(e)),this.envelope.sustain===0&&this._oscillators.forEach(n=>{n.stop(e+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay))}),this}_triggerEnvelopeRelease(e){return this.envelope.triggerRelease(e),this._oscillators.forEach(t=>t.stop(e+this.toSeconds(this.envelope.release))),this}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}get modulationIndex(){return this._oscillators[0].modulationIndex.value}set modulationIndex(e){this._oscillators.forEach(t=>t.modulationIndex.value=e)}get harmonicity(){return this._oscillators[0].harmonicity.value}set harmonicity(e){this._oscillators.forEach(t=>t.harmonicity.value=e)}get resonance(){return this._filterFreqScaler.min}set resonance(e){this._filterFreqScaler.min=this.toFrequency(e),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(e){this._octaves=e,this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,e)}dispose(){return super.dispose(),this._oscillators.forEach(e=>e.dispose()),this._freqMultipliers.forEach(e=>e.dispose()),this.frequency.dispose(),this.detune.dispose(),this._filterFreqScaler.dispose(),this._amplitude.dispose(),this.envelope.dispose(),this._highpass.dispose(),this}}class Et extends Ie{constructor(){super(S(Et.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;const e=S(Et.getDefaults(),arguments);this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,Y(this,["oscillator","envelope"])}static getDefaults(){return je(we.getDefaults(),Ie.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,t){const n=this.toSeconds(t),i=this.toFrequency(e instanceof Fe?e.toFrequency():e),r=i*this.octaves;return this.oscillator.frequency.setValueAtTime(r,n),this.oscillator.frequency.exponentialRampToValueAtTime(i,n+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}Je([la(0)],Et.prototype,"octaves",void 0);Je([Tt(0)],Et.prototype,"pitchDecay",void 0);class Hn extends qe{constructor(){super(S(Hn.getDefaults(),arguments)),this.name="NoiseSynth";const e=S(Hn.getDefaults(),arguments);this.noise=new Ot(Object.assign({context:this.context},e.noise)),this.envelope=new ls(Object.assign({context:this.context},e.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(qe.getDefaults(),{envelope:Object.assign(xe(be.getDefaults(),Object.keys(I.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(xe(Ot.getDefaults(),Object.keys(_e.getDefaults())),{type:"white"})})}triggerAttack(e,t=1){return e=this.toSeconds(e),this.envelope.triggerAttack(e,t),this.noise.start(e),this.envelope.sustain===0&&this.noise.stop(e+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(e){return e=this.toSeconds(e),this.envelope.triggerRelease(e),this.noise.stop(e+this.toSeconds(this.envelope.release)),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}triggerAttackRelease(e,t,n=1){return t=this.toSeconds(t),e=this.toSeconds(e),this.triggerAttack(t,n),this.triggerRelease(t+e),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}}const ur=new Set;function hr(s){ur.add(s)}function ua(s,e){const t=`registerProcessor("${s}", ${e})`;ur.add(t)}function Kp(){return Array.from(ur).join(`
`)}class ef extends I{constructor(e){super(e),this.name="ToneAudioWorklet",this.workletOptions={},this.onprocessorerror=Q;const t=URL.createObjectURL(new Blob([Kp()],{type:"text/javascript"})),n=this._audioWorkletName();this._dummyGain=this.context.createGain(),this._dummyParam=this._dummyGain.gain,this.context.addAudioWorkletModule(t,n).then(()=>{this.disposed||(this._worklet=this.context.createAudioWorkletNode(n,this.workletOptions),this._worklet.onprocessorerror=this.onprocessorerror.bind(this),this.onReady(this._worklet))})}dispose(){return super.dispose(),this._dummyGain.disconnect(),this._worklet&&(this._worklet.port.postMessage("dispose"),this._worklet.disconnect()),this}}const tf=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;hr(tf);const nf=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;hr(nf);const sf=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;hr(sf);const ha="feedback-comb-filter",rf=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;ua(ha,rf);class Ls extends ef{constructor(){super(S(Ls.getDefaults(),arguments,["delayTime","resonance"])),this.name="FeedbackCombFilter";const e=S(Ls.getDefaults(),arguments,["delayTime","resonance"]);this.input=new X({context:this.context}),this.output=new X({context:this.context}),this.delayTime=new z({context:this.context,value:e.delayTime,units:"time",minValue:0,maxValue:1,param:this._dummyParam,swappable:!0}),this.resonance=new z({context:this.context,value:e.resonance,units:"normalRange",param:this._dummyParam,swappable:!0}),Y(this,["resonance","delayTime"])}_audioWorkletName(){return ha}static getDefaults(){return Object.assign(I.getDefaults(),{delayTime:.1,resonance:.5})}onReady(e){fn(this.input,e,this.output);const t=e.parameters.get("delayTime");this.delayTime.setParam(t);const n=e.parameters.get("feedback");this.resonance.setParam(n)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.delayTime.dispose(),this.resonance.dispose(),this}}class Ws extends I{constructor(){super(S(Ws.getDefaults(),arguments,["frequency","type"])),this.name="OnePoleFilter";const e=S(Ws.getDefaults(),arguments,["frequency","type"]);this._frequency=e.frequency,this._type=e.type,this.input=new X({context:this.context}),this.output=new X({context:this.context}),this._createFilter()}static getDefaults(){return Object.assign(I.getDefaults(),{frequency:880,type:"lowpass"})}_createFilter(){const e=this._filter,t=this.toFrequency(this._frequency),n=1/(2*Math.PI*t);if(this._type==="lowpass"){const i=1/(n*this.context.sampleRate),r=i-1;this._filter=this.context.createIIRFilter([i,0],[1,r])}else{const i=1/(n*this.context.sampleRate)-1;this._filter=this.context.createIIRFilter([1,-1],[1,i])}this.input.chain(this._filter,this.output),e&&this.context.setTimeout(()=>{this.disposed||(this.input.disconnect(e),e.disconnect())},this.blockTime)}get frequency(){return this._frequency}set frequency(e){this._frequency=e,this._createFilter()}get type(){return this._type}set type(e){this._type=e,this._createFilter()}getFrequencyResponse(e=128){const t=new Float32Array(e);for(let r=0;r<e;r++){const o=Math.pow(r/e,2)*19980+20;t[r]=o}const n=new Float32Array(e),i=new Float32Array(e);return this._filter.getFrequencyResponse(t,n,i),n}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this._filter.disconnect(),this}}class js extends I{constructor(){super(S(js.getDefaults(),arguments,["delayTime","resonance","dampening"])),this.name="LowpassCombFilter";const e=S(js.getDefaults(),arguments,["delayTime","resonance","dampening"]);this._combFilter=this.output=new Ls({context:this.context,delayTime:e.delayTime,resonance:e.resonance}),this.delayTime=this._combFilter.delayTime,this.resonance=this._combFilter.resonance,this._lowpass=this.input=new Ws({context:this.context,frequency:e.dampening,type:"lowpass"}),this._lowpass.connect(this._combFilter)}static getDefaults(){return Object.assign(I.getDefaults(),{dampening:3e3,delayTime:.1,resonance:.5})}get dampening(){return this._lowpass.frequency}set dampening(e){this._lowpass.frequency=e}dispose(){return super.dispose(),this._combFilter.dispose(),this._lowpass.dispose(),this}}class Yn extends qe{constructor(){super(S(Yn.getDefaults(),arguments)),this.name="PluckSynth";const e=S(Yn.getDefaults(),arguments);this._noise=new Ot({context:this.context,type:"pink"}),this.attackNoise=e.attackNoise,this._lfcf=new js({context:this.context,dampening:e.dampening,resonance:e.resonance}),this.resonance=e.resonance,this.release=e.release,this._noise.connect(this._lfcf),this._lfcf.connect(this.output)}static getDefaults(){return je(qe.getDefaults(),{attackNoise:1,dampening:4e3,resonance:.7,release:1})}get dampening(){return this._lfcf.dampening}set dampening(e){this._lfcf.dampening=e}triggerAttack(e,t){const n=this.toFrequency(e);t=this.toSeconds(t);const i=1/n;return this._lfcf.delayTime.setValueAtTime(i,t),this._noise.start(t),this._noise.stop(t+i*this.attackNoise),this._lfcf.resonance.cancelScheduledValues(t),this._lfcf.resonance.setValueAtTime(this.resonance,t),this}triggerRelease(e){return this._lfcf.resonance.linearRampTo(0,this.release,e),this}dispose(){return super.dispose(),this._noise.dispose(),this._lfcf.dispose(),this}}class Bs extends qe{constructor(){super(S(Bs.getDefaults(),arguments,["voice","options"])),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0;const e=S(Bs.getDefaults(),arguments,["voice","options"]);L(!_t(e.voice),"DEPRECATED: The polyphony count is no longer the first argument.");const t=e.voice.getDefaults();this.options=Object.assign(t,e.options),this.voice=e.voice,this.maxPolyphony=e.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();const n=this._voices.indexOf(this._dummyVoice);this._voices.splice(n,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(qe.getDefaults(),{maxPolyphony:32,options:{},voice:Ie})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(e){this._availableVoices.push(e);const t=this._activeVoices.findIndex(n=>n.voice===e);this._activeVoices.splice(t,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){const e=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return e.connect(this.output),this._voices.push(e),e}else er("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(this._averageActiveVoices*.95,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){const e=this._availableVoices.shift(),t=this._voices.indexOf(e);this._voices.splice(t,1),this.context.isOffline||e.dispose()}}_triggerAttack(e,t,n){e.forEach(i=>{const r=new Fs(this.context,i).toMidi(),a=this._getNextAvailableVoice();a&&(a.triggerAttack(i,t,n),this._activeVoices.push({midi:r,voice:a,released:!1}),this.log("triggerAttack",i,t))})}_triggerRelease(e,t){e.forEach(n=>{const i=new Fs(this.context,n).toMidi(),r=this._activeVoices.find(({midi:a,released:o})=>a===i&&!o);r&&(r.voice.triggerRelease(t),r.released=!0,this.log("triggerRelease",n,t))})}_scheduleEvent(e,t,n,i){L(!this.disposed,"Synth was already disposed"),n<=this.now()?e==="attack"?this._triggerAttack(t,n,i):this._triggerRelease(t,n):this.context.setTimeout(()=>{this._scheduleEvent(e,t,n,i)},n-this.now())}triggerAttack(e,t,n){Array.isArray(e)||(e=[e]);const i=this.toSeconds(t);return this._scheduleEvent("attack",e,i,n),this}triggerRelease(e,t){Array.isArray(e)||(e=[e]);const n=this.toSeconds(t);return this._scheduleEvent("release",e,n),this}triggerAttackRelease(e,t,n,i){const r=this.toSeconds(n);if(this.triggerAttack(e,r,i),Pe(t)){L(Pe(e),"If the duration is an array, the notes must also be an array"),e=e;for(let a=0;a<e.length;a++){const o=t[Math.min(a,t.length-1)],c=this.toSeconds(o);L(c>0,"The duration must be greater than 0"),this.triggerRelease(e[a],r+c)}}else{const a=this.toSeconds(t);L(a>0,"The duration must be greater than 0"),this.triggerRelease(e,r+a)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}set(e){const t=xe(e,["onsilence","context"]);return this.options=je(this.options,t),this._voices.forEach(n=>n.set(t)),this._dummyVoice.set(t),this}get(){return this._dummyVoice.get()}releaseAll(e){const t=this.toSeconds(e);return this._activeVoices.forEach(({voice:n})=>{n.triggerRelease(t)}),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach(e=>e.dispose()),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class Xt extends qe{constructor(){super(S(Xt.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const e=S(Xt.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),t={};Object.keys(e.urls).forEach(n=>{const i=parseInt(n,10);if(L(ds(n)||_t(i)&&isFinite(i),`url key is neither a note or midi pitch: ${n}`),ds(n)){const r=new Fe(this.context,n).toMidi();t[r]=e.urls[n]}else _t(i)&&isFinite(i)&&(t[i]=e.urls[i])}),this._buffers=new rr({urls:t,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(qe.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:Q,onerror:Q,release:.1,urls:{}})}_findClosest(e){let n=0;for(;n<96;){if(this._buffers.has(e+n))return-n;if(this._buffers.has(e-n))return n;n++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,t,n=1){return this.log("triggerAttack",e,t,n),Array.isArray(e)||(e=[e]),e.forEach(i=>{const r=ra(new Fe(this.context,i).toFrequency()),a=Math.round(r),o=r-a,c=this._findClosest(a),l=a-c,u=this._buffers.get(l),h=ia(c+o),d=new gn({url:u,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:h}).connect(this.output);d.start(t,0,u.duration/h,n),Pe(this._activeSources.get(a))||this._activeSources.set(a,[]),this._activeSources.get(a).push(d),d.onended=()=>{if(this._activeSources&&this._activeSources.has(a)){const f=this._activeSources.get(a),p=f.indexOf(d);p!==-1&&f.splice(p,1)}}}),this}triggerRelease(e,t){return this.log("triggerRelease",e,t),Array.isArray(e)||(e=[e]),e.forEach(n=>{const i=new Fe(this.context,n).toMidi();if(this._activeSources.has(i)&&this._activeSources.get(i).length){const r=this._activeSources.get(i);t=this.toSeconds(t),r.forEach(a=>{a.stop(t)}),this._activeSources.set(i,[])}}),this}releaseAll(e){const t=this.toSeconds(e);return this._activeSources.forEach(n=>{for(;n.length;)n.shift().stop(t)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,t,n,i=1){const r=this.toSeconds(n);return this.triggerAttack(e,r,i),Pe(t)?(L(Pe(e),"notes must be an array when duration is array"),e.forEach((a,o)=>{const c=t[Math.min(o,t.length-1)];this.triggerRelease(a,r+this.toSeconds(c))})):this.triggerRelease(e,r+this.toSeconds(t)),this}add(e,t,n){if(L(ds(e)||isFinite(e),`note must be a pitch or midi: ${e}`),ds(e)){const i=new Fe(this.context,e).toMidi();this._buffers.add(i,t,n)}else this._buffers.add(e,t,n);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(e=>{e.forEach(t=>t.dispose())}),this._activeSources.clear(),this}}Je([Tt(0)],Xt.prototype,"attack",void 0);Je([Tt(0)],Xt.prototype,"release",void 0);class $s extends I{constructor(){super(Object.assign(S($s.getDefaults(),arguments,["fade"]))),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new Jp({context:this.context}),this.a=new X({context:this.context,gain:0}),this.b=new X({context:this.context,gain:0}),this.output=new X({context:this.context}),this._internalChannels=[this.a,this.b];const e=S($s.getDefaults(),arguments,["fade"]);this.fade=new Z({context:this.context,units:"normalRange",value:e.fade}),Y(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",yt(this._split,this.a.gain,0),yt(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(I.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class Us extends I{constructor(e){super(e),this.name="Effect",this._dryWet=new $s({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new X({context:this.context}),this.effectReturn=new X({context:this.context}),this.input=new X({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(e.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],Y(this,"wet")}static getDefaults(){return Object.assign(I.getDefaults(),{wet:1})}connectEffect(e){return this._internalChannels.push(e),this.effectSend.chain(e,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class qr extends Us{constructor(e){super(e),this.name="LFOEffect",this._lfo=new Bn({context:this.context,frequency:e.frequency,amplitude:e.depth}),this.depth=this._lfo.amplitude,this.frequency=this._lfo.frequency,this.type=e.type,Y(this,["frequency","depth"])}static getDefaults(){return Object.assign(Us.getDefaults(),{frequency:1,type:"sine",depth:1})}start(e){return this._lfo.start(e),this}stop(e){return this._lfo.stop(e),this}sync(){return this._lfo.sync(),this}unsync(){return this._lfo.unsync(),this}get type(){return this._lfo.type}set type(e){this._lfo.type=e}dispose(){return super.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class Gs extends qr{constructor(){super(S(Gs.getDefaults(),arguments,["frequency","baseFrequency","octaves"])),this.name="AutoFilter";const e=S(Gs.getDefaults(),arguments,["frequency","baseFrequency","octaves"]);this.filter=new Dt(Object.assign(e.filter,{context:this.context})),this.connectEffect(this.filter),this._lfo.connect(this.filter.frequency),this.octaves=e.octaves,this.baseFrequency=e.baseFrequency}static getDefaults(){return Object.assign(qr.getDefaults(),{baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}})}get baseFrequency(){return this._lfo.min}set baseFrequency(e){this._lfo.min=this.toFrequency(e),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(e){this._octaves=e,this._lfo.max=this._lfo.min*Math.pow(2,e)}dispose(){return super.dispose(),this.filter.dispose(),this}}class zs extends I{constructor(){super(Object.assign(S(zs.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;const e=S(zs.getDefaults(),arguments,["pan"]);this.pan=new z({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",Y(this,"pan")}static getDefaults(){return Object.assign(I.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}const of="bit-crusher",af=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;ua(of,af);class Zs extends I{constructor(){super(S(Zs.getDefaults(),arguments,["channels"])),this.name="Merge";const e=S(Zs.getDefaults(),arguments,["channels"]);this._merger=this.output=this.input=this.context.createChannelMerger(e.channels)}static getDefaults(){return Object.assign(I.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class Qn extends Us{constructor(){super(S(Qn.getDefaults(),arguments,["decay"])),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();const e=S(Qn.getDefaults(),arguments,["decay"]);this._decay=e.decay,this._preDelay=e.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(Us.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(e){e=this.toSeconds(e),Xe(e,.001),this._decay=e,this.generate()}get preDelay(){return this._preDelay}set preDelay(e){e=this.toSeconds(e),Xe(e,0),this._preDelay=e,this.generate()}generate(){return de(this,void 0,void 0,function*(){const e=this.ready,t=new li(2,this._decay+this._preDelay,this.context.sampleRate),n=new Ot({context:t}),i=new Ot({context:t}),r=new Zs({context:t});n.connect(r,0,0),i.connect(r,0,1);const a=new X({context:t}).toDestination();r.connect(a),n.start(0),i.start(0),a.gain.setValueAtTime(0,0),a.gain.setValueAtTime(1,this._preDelay),a.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const o=t.render();return this.ready=o.then(Q),yield e,this._convolver.buffer=(yield o).get(),this})}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class he extends I{constructor(){super(S(he.getDefaults(),arguments,["solo"])),this.name="Solo";const e=S(he.getDefaults(),arguments,["solo"]);this.input=this.output=new X({context:this.context}),he._allSolos.has(this.context)||he._allSolos.set(this.context,new Set),he._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(I.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),he._allSolos.get(this.context).forEach(t=>t._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){he._soloed.has(this.context)||he._soloed.set(this.context,new Set),he._soloed.get(this.context).add(this)}_removeSolo(){he._soloed.has(this.context)&&he._soloed.get(this.context).delete(this)}_isSoloed(){return he._soloed.has(this.context)&&he._soloed.get(this.context).has(this)}_noSolos(){return!he._soloed.has(this.context)||he._soloed.has(this.context)&&he._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),he._allSolos.get(this.context).delete(this),this._removeSolo(),this}}he._allSolos=new Map;he._soloed=new Map;class Xs extends I{constructor(){super(S(Xs.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";const e=S(Xs.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new zs({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new zt({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,Y(this,["pan","volume"])}static getDefaults(){return Object.assign(I.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class qt extends I{constructor(){super(S(qt.getDefaults(),arguments,["volume","pan"])),this.name="Channel";const e=S(qt.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new he({solo:e.solo,context:this.context}),this._panVol=this.output=new Xs({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),Y(this,["pan","volume"])}static getDefaults(){return Object.assign(I.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return qt.buses.has(e)||qt.buses.set(e,new X({context:this.context})),qt.buses.get(e)}send(e,t=0){const n=this._getBus(e),i=new X({context:this.context,units:"decibels",gain:t});return this.connect(i),i.connect(n),i}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}qt.buses=new Map;class cf extends I{constructor(){super(...arguments),this.name="Listener",this.positionX=new z({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new z({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new z({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new z({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new z({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new z({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new z({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new z({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new z({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(I.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}ai(s=>{s.listener=new cf({context:s})});ci(s=>{s.listener.dispose()});const mt=Ue().transport,dr=Ue().destination;Ue().destination;Ue().listener;const lf=Ue().draw;Ue();var uf=!!hc,hf=uf?s=>Mi()?$t(s):s:$t;function df(s,e,t,n){return s.addEventListener(e,t,n),hf(s.removeEventListener.bind(s,e,t,n))}function pf(s,e=Mi()){let t=0,n,i;return()=>(t++,$t(()=>{t--,queueMicrotask(()=>{!t&&i&&(i(),i=n=void 0)})}),i||cn(r=>n=s(i=r),e),n)}var ff=pf(()=>{const[s,e]=Sn(null);return df(window,"keydown",t=>{e(t),setTimeout(()=>e(null))}),s}),mf=async s=>{typeof s=="string"?await navigator.clipboard.writeText(s):await navigator.clipboard.write(s)};function pr(s,e=[]){return s.filter((t,n)=>!e.includes(n)),s[Math.floor(Math.random()*s.length)]}function gf(s,e){return Math.floor(Math.random()*(e-s)+s)}function _f(s,e,t){const n=[];for(let i=s;i<=e;i++)t.includes(i)||n.push(i);return pr(n)}const Mn="0.0.16";let et={};const yf=()=>{if(location.hash){const s=location.hash.slice(1),e=atob(s),t=unescape(e);et=JSON.parse(t)}},vf=()=>{const s=JSON.stringify(et),e=escape(s),t=btoa(e);location.hash=t},wf=s=>{et={...et,...s}};var bf=He("<p class=warning>The current composition is saved with version <!>. Sikwent is running version <!>. Some sounds may not represent what the original composer intended."),Tf=He('<div class=help><h1>Help!</h1><p>Lost? Just click the orange box and you’re off! You’ll figure it out.</p><p>You can go back and remove a tick, but you must add at least one tick on each track to unlock the next track</p><p>The sound for each track is picked at random on load, if you’re unhappy with the order of sounds, hit "Reset". Notes are also picked at random, but always from the Aeolian Dominant aka Hindu Scale in E.</p><p>Use keys <code>a-y</code> to mute tracks.</p><p>Save works OK but I wouldn’t trust it with my life. It saves the current state of your composition in the URL, just copy it from the address bar to share it.</p><p>Version: ');const xf=()=>{let s=Mn;const[e,t]=Sn(!1);return Ks(()=>{if(et&&et.createdWith){s=et.createdWith;const n=s.split("."),i=Mn.split(".");i[1]==="0"?n[2]!==i[2]&&t(!0):(n[1]!==i[1]||n[0]!==i[0])&&t(!0)}}),(()=>{var n=Tf(),i=n.firstChild,r=i.nextSibling,a=r.nextSibling,o=a.nextSibling,c=o.nextSibling,l=c.nextSibling,u=l.nextSibling;return u.firstChild,me(u,Mn,null),me(n,Ke(Kr,{get when(){return e()},get children(){var h=bf(),d=h.firstChild,f=d.nextSibling,p=f.nextSibling,m=p.nextSibling;return m.nextSibling,me(h,s,f),me(h,Mn,m),h}}),null),n})()},da="./sounds/",Sf=new Qn({decay:.05,wet:.5});dr.chain(Sf);const pa=new Qn({decay:.3,wet:.7}),fa=new Gs("4n").toDestination().start(),Cf=new Dt({frequency:11e3}).toDestination(),ma={name:"Hi-Hat",shortName:"HHat",engine:new Hn({volume:-18,type:"white"}).toDestination()};ma.engine.sync();const ga={name:"Snare",shortName:"Snre",engine:new Hn({volume:-4,noise:{type:"pink",playbackRate:3},envelope:{attack:.001,decay:.13,sustain:0,release:.03}}).connect(Cf).toDestination()};ga.engine.sync();const _a={name:"Kick",octave:2,engine:new Et({volume:-6}).toDestination()};_a.engine.sync();const ya={name:"Tom Lo",shortName:"Tom1",octave:3,engine:new Et({volume:-3,pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toDestination()};ya.engine.sync();const va={name:"Tom Mid",shortName:"Tom2",engine:new Et({volume:-3,pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toDestination()};va.engine.sync();const wa={name:"Mono 1",shortName:"Mon1",engine:new dt({volume:-8,oscillator:{type:"square8"},envelope:{attack:.05,decay:.3,sustain:.4,release:.8},filterEnvelope:{attack:.001,decay:.7,sustain:.1,release:.8,baseFrequency:300,octaves:4}}).toDestination()};wa.engine.sync();const ba={name:"Mono 2",shortName:"Mon2",engine:new dt({volume:-8,oscillator:{type:"sine2"},envelope:{attack:.2,decay:.2,sustain:.2,release:.2},filterEnvelope:{attack:.05,decay:.2,sustain:.1,release:.2,baseFrequency:300,octaves:4}}).toDestination()};ba.engine.sync();const Ta={name:"FM 1",octave:3,engine:new Zn({volume:-6,modulationIndex:12.22,envelope:{attack:.01,decay:.2},modulation:{type:"square"},modulationEnvelope:{attack:.2,decay:.01}}).toDestination()};Ta.engine.sync();const xa={name:"FM 2",octave:2,engine:new Zn({volume:-3,modulationIndex:12.22,envelope:{attack:.5,decay:.2},modulation:{type:"sine"},modulationEnvelope:{attack:.2,decay:.1}}).toDestination()};xa.engine.sync();const Sa={name:"Synth 1",shortName:"Snt1",octave:1,engine:new Ie({oscillator:{type:"amtriangle",harmonicity:.5,modulationType:"square"},envelope:{attackCurve:"exponential",attack:0,decay:.3,sustain:.1,release:1},portamento:0,volume:-6}).toDestination()};Sa.engine.sync();const Ca={name:"Synth 2",shortName:"Snt2",octave:2,engine:new Ie({oscillator:{type:"amtriangle",harmonicity:2.5,modulationType:"sine"},envelope:{attackCurve:"exponential",attack:.05,decay:.2,sustain:.2,release:1.5},portamento:.05,volume:-6}).toDestination()};Ca.engine.sync();const ka={name:"Synth 3",shortName:"Snt3",octave:3,engine:new Ie({volume:-6}).toDestination()};ka.engine.sync();const Aa={name:"Pluck 1",shortName:"Plk1",engine:new Yn({volume:-6}).toDestination()};Aa.engine.sync();const Na={name:"Pluck 2",shortName:"Plk2",engine:new Yn({volume:-6}).toDestination()};Na.engine.sync();const Oa={name:"AM 1",engine:new di({volume:-3}).toDestination()};Oa.engine.sync();const Da={name:"AM 2",engine:new di({volume:0,harmonicity:3.2,oscillator:{type:"fatsawtooth"},envelope:{attack:0,decay:.1,sustain:.1,release:.5},modulation:{type:"sine2"},modulationEnvelope:{attack:.05,decay:.01}}).toDestination()};Da.engine.sync();const Ea={name:"Metal 1",shortName:"Mtl1",engine:new Xn({harmonicity:12,resonance:1200,modulationIndex:16,envelope:{decay:.2},volume:-12}).toDestination()};Ea.engine.sync();const Ma={name:"Metal 2",shortName:"Mtl1",engine:new Xn({harmonicity:8,resonance:300,modulationIndex:22,envelope:{decay:.5},volume:-14}).toDestination()};Ma.engine.sync();const Ia={name:"Fun 1",engine:new Ie({volume:-6,oscillator:{type:"fatsawtooth",harmonicity:4,modulationType:"amtriangle"}}).toDestination()};Ia.engine.sync();const Ra={name:"Fun 2",engine:new Ie({volume:-6,oscillator:{type:"sine",harmonicity:.5,modulationType:"fatsawtooth"}}).toDestination()};Ra.engine.sync();const Va={name:"Fat",octave:2,engine:new Bs(Ie,{oscillator:{type:"fatsawtooth",count:3,spread:30},envelope:{attack:.01,decay:.1,sustain:.5,release:.4,attackCurve:"exponential"}}).toDestination()};Va.engine.sync();const Fa={name:"Sampler 1",shortName:"Smp1",engine:new Xt({urls:{C4:"uh.mp3"},baseUrl:da}).toDestination()};Fa.engine.sync();const Pa={name:"Sampler 2",shortName:"Smp2",engine:new Xt({urls:{C4:"yeah.mp3"},baseUrl:da}).toDestination()};Pa.engine.sync();const qa={name:"Duo 1",octave:2,engine:new zn({volume:-6,portamento:.5,vibratoAmount:1,vibratoRate:1}).chain(fa,pa,dr)};qa.engine.sync();const La={name:"Duo 2",octave:1,engine:new zn({volume:-6,portamento:0,vibratoAmount:.5,vibratoRate:.5}).chain(fa,pa,dr)};La.engine.sync();const Ht=[Oa,Da,qa,La,Va,Ta,xa,Ia,Ra,ma,_a,Ea,Ma,wa,ba,Aa,Na,Fa,Pa,ga,Sa,Ca,ka,ya,va],Hs=Symbol("store-raw"),hn=Symbol("store-node"),ut=Symbol("store-has"),Wa=Symbol("store-self");function ja(s){let e=s[Bt];if(!e&&(Object.defineProperty(s,Bt,{value:e=new Proxy(s,Nf)}),!Array.isArray(s))){const t=Object.keys(s),n=Object.getOwnPropertyDescriptors(s);for(let i=0,r=t.length;i<r;i++){const a=t[i];n[a].get&&Object.defineProperty(s,a,{enumerable:n[a].enumerable,get:n[a].get.bind(e)})}}return e}function bn(s){let e;return s!=null&&typeof s=="object"&&(s[Bt]||!(e=Object.getPrototypeOf(s))||e===Object.prototype||Array.isArray(s))}function Tn(s,e=new Set){let t,n,i,r;if(t=s!=null&&s[Hs])return t;if(!bn(s)||e.has(s))return s;if(Array.isArray(s)){Object.isFrozen(s)?s=s.slice(0):e.add(s);for(let a=0,o=s.length;a<o;a++)i=s[a],(n=Tn(i,e))!==i&&(s[a]=n)}else{Object.isFrozen(s)?s=Object.assign({},s):e.add(s);const a=Object.keys(s),o=Object.getOwnPropertyDescriptors(s);for(let c=0,l=a.length;c<l;c++)r=a[c],!o[r].get&&(i=s[r],(n=Tn(i,e))!==i&&(s[r]=n))}return s}function Ys(s,e){let t=s[e];return t||Object.defineProperty(s,e,{value:t=Object.create(null)}),t}function Jn(s,e,t){if(s[e])return s[e];const[n,i]=Sn(t,{equals:!1,internal:!0});return n.$=i,s[e]=n}function kf(s,e){const t=Reflect.getOwnPropertyDescriptor(s,e);return!t||t.get||!t.configurable||e===Bt||e===hn||(delete t.value,delete t.writable,t.get=()=>s[Bt][e]),t}function Ba(s){yi()&&Jn(Ys(s,hn),Wa)()}function Af(s){return Ba(s),Reflect.ownKeys(s)}const Nf={get(s,e,t){if(e===Hs)return s;if(e===Bt)return t;if(e===_i)return Ba(s),t;const n=Ys(s,hn),i=n[e];let r=i?i():s[e];if(e===hn||e===ut||e==="__proto__")return r;if(!i){const a=Object.getOwnPropertyDescriptor(s,e);yi()&&(typeof r!="function"||s.hasOwnProperty(e))&&!(a&&a.get)&&(r=Jn(n,e,r)())}return bn(r)?ja(r):r},has(s,e){return e===Hs||e===Bt||e===_i||e===hn||e===ut||e==="__proto__"?!0:(yi()&&Jn(Ys(s,ut),e)(),e in s)},set(){return!0},deleteProperty(){return!0},ownKeys:Af,getOwnPropertyDescriptor:kf};function xn(s,e,t,n=!1){if(!n&&s[e]===t)return;const i=s[e],r=s.length;t===void 0?(delete s[e],s[ut]&&s[ut][e]&&i!==void 0&&s[ut][e].$()):(s[e]=t,s[ut]&&s[ut][e]&&i===void 0&&s[ut][e].$());let a=Ys(s,hn),o;if((o=Jn(a,e,i))&&o.$(()=>t),Array.isArray(s)&&s.length!==r){for(let c=s.length;c<r;c++)(o=a[c])&&o.$();(o=Jn(a,"length",r))&&o.$(s.length)}(o=a[Wa])&&o.$()}function $a(s,e){const t=Object.keys(e);for(let n=0;n<t.length;n+=1){const i=t[n];xn(s,i,e[i])}}function Of(s,e){if(typeof e=="function"&&(e=e(s)),e=Tn(e),Array.isArray(e)){if(s===e)return;let t=0,n=e.length;for(;t<n;t++){const i=e[t];s[t]!==i&&xn(s,t,i)}xn(s,"length",n)}else $a(s,e)}function In(s,e,t=[]){let n,i=s;if(e.length>1){n=e.shift();const a=typeof n,o=Array.isArray(s);if(Array.isArray(n)){for(let c=0;c<n.length;c++)In(s,[n[c]].concat(e),t);return}else if(o&&a==="function"){for(let c=0;c<s.length;c++)n(s[c],c)&&In(s,[c].concat(e),t);return}else if(o&&a==="object"){const{from:c=0,to:l=s.length-1,by:u=1}=n;for(let h=c;h<=l;h+=u)In(s,[h].concat(e),t);return}else if(e.length>1){In(s[n],e,[n].concat(t));return}i=s[n],t=[n].concat(t)}let r=e[0];typeof r=="function"&&(r=r(i,t),r===i)||n===void 0&&r==null||(r=Tn(r),n===void 0||bn(i)&&bn(r)&&!Array.isArray(r)?$a(i,r):xn(s,n,r))}function Df(...[s,e]){const t=Tn(s||{}),n=Array.isArray(t),i=ja(t);function r(...a){tc(()=>{n&&a.length===1?Of(t,a[0]):In(t,a)})}return[i,r]}const Qs=new WeakMap,Ua={get(s,e){if(e===Hs)return s;const t=s[e];let n;return bn(t)?Qs.get(t)||(Qs.set(t,n=new Proxy(t,Ua)),n):t},set(s,e,t){return xn(s,e,Tn(t)),!0},deleteProperty(s,e){return xn(s,e,void 0,!0),!0}};function Yt(s){return e=>{if(bn(e)){let t;(t=Qs.get(e))||Qs.set(e,t=new Proxy(e,Ua)),s(t)}return e}}const Ef=Ht.length,Ga=["E","F#","G#","A","B","C","D"],Lr=gf(0,Ht.length-1);let Wr=0;const[ye,ze]=Df({bpm:85,createdWith:Mn,playing:!1,initiated:!1,saved:!0,steps:[0],usedInstruments:[Lr],tracks:[{id:0,instrument:Lr,ticks:[0],muted:!1,note:pr(Ga)}]}),Mf=()=>{na(new Dn({latencyHint:"playback"}))},za=s=>{for(let e=0;e<ye.tracks.length;e++){let t=Wr%(e+1);const n=ye.tracks[e];if(!n.muted&&n.ticks[t]){const i=n.instrument;if(Ht[i]){const r=Ht[i],a=r.engine,o=r.octave||4;a&&(a.name==="NoiseSynth"?a.triggerAttackRelease("32n",s):a.triggerAttackRelease(`${n.note}${o}`,"32n",s))}}lf.schedule(()=>{ye.steps,ze("steps",e,t)},s)}Wr++},Za=()=>{const s=ye.tracks.length,e=new Array(s+1).fill(0),t=_f(0,Ht.length-1,ye.usedInstruments);ze(Yt(n=>{n.tracks.push({id:s,instrument:t,ticks:e,muted:!1,note:pr(Ga)}),n.usedInstruments.push(t)}))},If=async(s,e)=>{s===0&&(ye.initiated||(sa(),mt.bpm.value=ye.bpm,mt.scheduleRepeat(za,"16n"),await mt.start("+0.05"),ze(Yt(t=>{t.initiated=!0,t.playing=!0})))),ze("tracks",t=>t.id===s,Yt(t=>{t.ticks[e]=!t.ticks[e]})),ze("saved",!1),s<Ef-1&&s===ye.tracks.length-1&&Za()},Rf=s=>{ze("tracks",e=>e.id===s,Yt(e=>{e.muted=!e.muted})),ze("saved",!1)},Vf=s=>{mt.bpm.value=s,ze(Yt(e=>{e.bpm=s,e.saved=!1}))},Ff=async()=>{await mt.stop(),ze(Yt(s=>{s.initiated=!1,s.playing=!1,s.saved=!0})),wf(ye),vf()},Pf=async()=>{await sa(),mt.bpm.value=ye.bpm,mt.scheduleRepeat(za,"16n"),await mt.start("+0.1"),ze(Yt(s=>{s.initiated=!0,s.playing=!0}))},qf=()=>{location.href="."},Pt={addTrack:Za,initAndPlay:Pf,initContext:Mf,reset:qf,saveStore:Ff,setBpm:Vf,toggleMute:Rf,toggleTick:If};var Lf=He("<div class=track-info><span class=full>: <!>: </span><span class=tiny>"),Wf=He("<div>");const jf=s=>{const{track:e}=s,t=Ht[e.instrument]||{name:"Missing"},n=String.fromCharCode(e.id+97),i=t.shortName||t.name.replace(" ","");return[(()=>{var r=Lf(),a=r.firstChild,o=a.firstChild,c=o.nextSibling;c.nextSibling;var l=a.nextSibling;return me(a,n,o),me(a,()=>t.name,c),me(a,()=>e.note,null),l.$$click=()=>{Pt.toggleMute(e.id)},me(l,i),r})(),(()=>{var r=Wf();return me(r,()=>s.children),kt(()=>eo(r,s.class)),r})()]};Vi(["click"]);var Bf=He("<button role=button class=secondary>"),$f=He("<dialog class=modal><article><header><button aria-label=Close rel=prev></button><h3></h3></header><footer><button autofocus>OK!");const jr="modal-is-open",Br="modal-is-opening",$r="modal-is-closing",Ur="--pico-scrollbar-width",Gr=400,Uf=()=>window.innerWidth-document.documentElement.clientWidth,zr=()=>{let s;const[e,t]=Sn(!1),n=()=>{const{documentElement:o}=document,c=Uf();c&&o.style.setProperty(Ur,`${c}px`),o.classList.add(jr,Br),setTimeout(()=>{o.classList.remove(Br)},Gr)},i=o=>{const{documentElement:c}=document;c.classList.add($r),setTimeout(()=>{c.classList.remove($r,jr),c.style.removeProperty(Ur),o()},Gr)},r=()=>{e()?i(()=>{t(!1)}):(t(!0),n())};return document.addEventListener("keydown",o=>{o.key==="Escape"&&e()&&i(()=>{t(!1)})}),[o=>Ke(yc,{get children(){var c=$f(),l=c.firstChild,u=l.firstChild,h=u.firstChild,d=h.nextSibling,f=u.nextSibling,p=f.firstChild,m=s;return typeof m=="function"?fc(m,c):s=c,h.$$click=r,me(d,()=>o.title),me(l,()=>o.children,f),me(f,Ke(Kr,{get when(){return o.secondaryButton},get children(){var g=Bf();return vi(g,"click",o.secondaryButton.onClick,!0),me(g,()=>o.secondaryButton.text),g}}),p),p.$$click=r,kt(()=>c.open=e()),c}}),r]};Vi(["click"]);var Gf=He('<div class=container><div class=header>TRK/</div><div class=header></div><div></div><div class="grid toolbar"><button>Save</button><button>Play</button><input disabled type=number step=5><button>Reset</button></div><div>'),zf=He('<p>This project is now saved in the URL. You can copy the URL and share with a friend, or keep it for yourself. Click "Copy" to put the URL in your clipboard.'),Zf=He('<p>To update the URL after you have done some changes, just hit "Save" again.'),Xf=He("<p>Kukjan!"),Hf=He("<input type=checkbox>");function Yf(){const s=async()=>{yf(),et&&et.bpm&&ze(et)},e=()=>{mt.dispose()},t=ff(),[n,i]=zr(),[r,a]=zr();return Ks(()=>{const o=t();if(o&&o.key){const c=o.key.charCodeAt();if(c>96&&c<123){const l=c-97;Pt.toggleMute(l)}else o.key==="ArrowUp"||o.key}}),nc(s),$t(e),[(()=>{var o=Gf(),c=o.firstChild;c.firstChild;var l=c.nextSibling,u=l.nextSibling,h=u.nextSibling,d=h.firstChild,f=d.nextSibling,p=f.nextSibling,m=p.nextSibling;return h.nextSibling,me(c,()=>Ht.length-ye.tracks.length,null),me(o,Ke(mr,{get each(){return ye.tracks},children:(g,y)=>{const{id:T,ticks:x}=g;return Ke(jf,{get class(){return`track ${g.muted?"muted":""}`},track:g,get children(){return Ke(mr,{each:x,children:(C,_)=>(()=>{var w=Hf();return w.addEventListener("change",()=>Pt.toggleTick(g.id,_())),w.checked=C,kt(()=>eo(w,`${ye.steps[y()]===_()?"onstep":"offstep"}`)),w})()})}})}}),u),d.$$click=g=>{Pt.saveStore(),i()},vi(f,"click",Pt.initAndPlay,!0),p.addEventListener("change",g=>{Pt.setBpm(g.target.value)}),vi(m,"click",Pt.reset,!0),me(o,Ke(xf,{}),null),kt(g=>{var y=ye.saved,T=ye.playing||ye.tracks.length===1,x=ye.tracks.length===1;return y!==g.e&&(d.disabled=g.e=y),T!==g.t&&(f.disabled=g.t=T),x!==g.a&&(m.disabled=g.a=x),g},{e:void 0,t:void 0,a:void 0}),kt(()=>p.value=ye.bpm),o})(),Ke(n,{title:"Saved!",secondaryButton:{text:"Copy",onClick:()=>{mf(location.href),i()}},get children(){return[zf(),Zf()]}}),Ke(r,{get children(){return Xf()}})]}Vi(["click"]);const Qf=document.getElementById("root");pc(()=>Ke(Yf,{}),Qf);
